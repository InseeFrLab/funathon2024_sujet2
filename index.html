<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>âœˆï¸ - Un tableau de bord du trafic aÃ©rien avec  ou </title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<link href="site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="site_libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="site_libs/leaflet-1.3.1/leaflet.js"></script>
<link href="site_libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="site_libs/proj4-2.6.2/proj4.min.js"></script>
<script src="site_libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="site_libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="site_libs/leaflet-binding-2.2.2/leaflet.js"></script>
<script src="site_libs/plotly-binding-4.10.4/plotly.js"></script>
<script src="site_libs/typedarray-0.1/typedarray.min.js"></script>
<link href="site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>
<link href="site_libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="site_libs/plotly-main-2.11.1/plotly-latest.min.js"></script>
<script src="site_libs/core-js-2.5.3/shim.min.js"></script>
<script src="site_libs/react-18.2.0/react.min.js"></script>
<script src="site_libs/react-18.2.0/react-dom.min.js"></script>
<script src="site_libs/reactwidget-1.0.0/react-tools.js"></script>
<link href="site_libs/reactable-0.4.4/reactable.css" rel="stylesheet">
<script src="site_libs/reactable-binding-0.4.4/reactable.js"></script>
<link href="site_libs/leaflet-awesomemarkers-2.0.3/leaflet.awesome-markers.css" rel="stylesheet">
<script src="site_libs/leaflet-awesomemarkers-2.0.3/leaflet.awesome-markers.min.js"></script>
<link href="site_libs/fontawesome-4.7.0/font-awesome.min.css" rel="stylesheet">


</head>

<body class="nav-fixed">


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">âœˆï¸</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./index.html" rel="" target="" aria-current="page">
 <span class="menu-text">Consigne de lâ€™exercice</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://rplane-dashboard.kub.sspcloud.fr/" rel="" target="">
 <span class="menu-text">Tableau de bord (version <i class="fa-brands fa-r-project" aria-label="r-project"></i>)</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://pylot-dashboard.kub.sspcloud.fr/" rel="" target="">
 <span class="menu-text">Tableau de bord (version <i class="fa-brands fa-python" aria-label="python"></i>)</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/inseefrlab/funathon2024_sujet2" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a>
  <ul class="collapse">
  <li><a href="#objectif" id="toc-objectif" class="nav-link" data-scroll-target="#objectif"><span class="header-section-number">1.1</span> Objectif</a></li>
  <li><a href="#pourquoi-dÃ©velopper-une-application-interactive" id="toc-pourquoi-dÃ©velopper-une-application-interactive" class="nav-link" data-scroll-target="#pourquoi-dÃ©velopper-une-application-interactive"><span class="header-section-number">1.2</span> Pourquoi dÃ©velopper une application interactive ?</a>
  <ul class="collapse">
  <li><a href="#une-valorisation-de-donnÃ©es-rapide-et-attractive" id="toc-une-valorisation-de-donnÃ©es-rapide-et-attractive" class="nav-link" data-scroll-target="#une-valorisation-de-donnÃ©es-rapide-et-attractive"><span class="header-section-number">1.2.1</span> Une valorisation de donnÃ©es rapide et attractive</a></li>
  <li><a href="#une-mise-Ã -disposition-parfois-complexe" id="toc-une-mise-Ã -disposition-parfois-complexe" class="nav-link" data-scroll-target="#une-mise-Ã -disposition-parfois-complexe"><span class="header-section-number">1.2.2</span> Une mise Ã  disposition parfois complexe</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#exploration-des-donnÃ©es-de-trafic-aÃ©rien" id="toc-exploration-des-donnÃ©es-de-trafic-aÃ©rien" class="nav-link" data-scroll-target="#exploration-des-donnÃ©es-de-trafic-aÃ©rien"><span class="header-section-number">2</span> Exploration des donnÃ©es de trafic aÃ©rien</a>
  <ul class="collapse">
  <li><a href="#prÃ©liminaire-rÃ©cupÃ©rer-le-projet-squelette-avec-git-fa-brands-git-alt" id="toc-prÃ©liminaire-rÃ©cupÃ©rer-le-projet-squelette-avec-git-fa-brands-git-alt" class="nav-link" data-scroll-target="#prÃ©liminaire-rÃ©cupÃ©rer-le-projet-squelette-avec-git-fa-brands-git-alt"><span class="header-section-number">2.1</span> PrÃ©liminaire : rÃ©cupÃ©rer le projet squelette avec <code>Git</code> <i class="fa-brands fa-git-alt" aria-label="git-alt"></i></a></li>
  <li><a href="#se-placer-dans-lenvironnement-du-projet" id="toc-se-placer-dans-lenvironnement-du-projet" class="nav-link" data-scroll-target="#se-placer-dans-lenvironnement-du-projet"><span class="header-section-number">2.2</span> Se placer dans lâ€™environnement du projet</a></li>
  <li><a href="#architecture-du-projet" id="toc-architecture-du-projet" class="nav-link" data-scroll-target="#architecture-du-projet"><span class="header-section-number">2.3</span> Architecture du projet</a></li>
  <li><a href="#installer-les-packages-nÃ©cessaires-pour-ce-tutoriel" id="toc-installer-les-packages-nÃ©cessaires-pour-ce-tutoriel" class="nav-link" data-scroll-target="#installer-les-packages-nÃ©cessaires-pour-ce-tutoriel"><span class="header-section-number">2.4</span> Installer les <em>packages</em> nÃ©cessaires pour ce tutoriel</a>
  <ul class="collapse">
  <li><a href="#principe" id="toc-principe" class="nav-link" data-scroll-target="#principe"><span class="header-section-number">2.4.1</span> Principe</a></li>
  <li><a href="#crÃ©er-lenvironnement" id="toc-crÃ©er-lenvironnement" class="nav-link" data-scroll-target="#crÃ©er-lenvironnement"><span class="header-section-number">2.4.2</span> CrÃ©er lâ€™environnement</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#rÃ©cupÃ©rer-les-donnÃ©es" id="toc-rÃ©cupÃ©rer-les-donnÃ©es" class="nav-link" data-scroll-target="#rÃ©cupÃ©rer-les-donnÃ©es"><span class="header-section-number">3</span> RÃ©cupÃ©rer les donnÃ©es</a>
  <ul class="collapse">
  <li><a href="#objectifs" id="toc-objectifs" class="nav-link" data-scroll-target="#objectifs"><span class="header-section-number">3.1</span> Objectifs</a></li>
  <li><a href="#sources" id="toc-sources" class="nav-link" data-scroll-target="#sources"><span class="header-section-number">3.2</span> Sources</a></li>
  <li><a href="#importer-la-liste-des-sources-disponibles" id="toc-importer-la-liste-des-sources-disponibles" class="nav-link" data-scroll-target="#importer-la-liste-des-sources-disponibles"><span class="header-section-number">3.3</span> Importer la liste des sources disponibles</a></li>
  <li><a href="#importer-les-premiÃ¨res-bases" id="toc-importer-les-premiÃ¨res-bases" class="nav-link" data-scroll-target="#importer-les-premiÃ¨res-bases"><span class="header-section-number">3.4</span> Importer les premiÃ¨res bases</a></li>
  </ul></li>
  <li><a href="#exploration-des-donnÃ©es" id="toc-exploration-des-donnÃ©es" class="nav-link" data-scroll-target="#exploration-des-donnÃ©es"><span class="header-section-number">4</span> Exploration des donnÃ©es</a>
  <ul class="collapse">
  <li><a href="#objectifs-1" id="toc-objectifs-1" class="nav-link" data-scroll-target="#objectifs-1"><span class="header-section-number">4.1</span> Objectifs</a></li>
  <li><a href="#prÃ©requis-crÃ©er-le-script-main" id="toc-prÃ©requis-crÃ©er-le-script-main" class="nav-link" data-scroll-target="#prÃ©requis-crÃ©er-le-script-main"><span class="header-section-number">4.2</span> PrÃ©requis: crÃ©er le script <code>main</code></a></li>
  <li><a href="#valorisation-1-le-trafic-par-aÃ©roport" id="toc-valorisation-1-le-trafic-par-aÃ©roport" class="nav-link" data-scroll-target="#valorisation-1-le-trafic-par-aÃ©roport"><span class="header-section-number">4.3</span> Valorisation 1: Le trafic par aÃ©roport</a></li>
  <li><a href="#valorisation-2-tableau-html-pour-afficher-des-donnÃ©es" id="toc-valorisation-2-tableau-html-pour-afficher-des-donnÃ©es" class="nav-link" data-scroll-target="#valorisation-2-tableau-html-pour-afficher-des-donnÃ©es"><span class="header-section-number">4.4</span> Valorisation 2: Tableau HTML pour afficher des donnÃ©es</a></li>
  <li><a href="#valorisation-3-carte-des-aÃ©roports" id="toc-valorisation-3-carte-des-aÃ©roports" class="nav-link" data-scroll-target="#valorisation-3-carte-des-aÃ©roports"><span class="header-section-number">4.5</span> Valorisation 3: Carte des aÃ©roports</a></li>
  </ul></li>
  <li><a href="#crÃ©ation-de-lapplication" id="toc-crÃ©ation-de-lapplication" class="nav-link" data-scroll-target="#crÃ©ation-de-lapplication"><span class="header-section-number">5</span> CrÃ©ation de lâ€™application</a></li>
  <li><a href="#partager-cette-application-une-ouverture-vers-la-mise-en-production" id="toc-partager-cette-application-une-ouverture-vers-la-mise-en-production" class="nav-link" data-scroll-target="#partager-cette-application-une-ouverture-vers-la-mise-en-production"><span class="header-section-number">6</span> Partager cette application : une ouverture vers la mise en production</a>
  <ul class="collapse">
  <li><a href="#conteneurisation-de-lapplication" id="toc-conteneurisation-de-lapplication" class="nav-link" data-scroll-target="#conteneurisation-de-lapplication"><span class="header-section-number">6.1</span> Conteneurisation de lâ€™application</a></li>
  <li><a href="#utilisation-de-limage-docker-pour-mettre-Ã -disposition-le-shiny-ou-streamlit" id="toc-utilisation-de-limage-docker-pour-mettre-Ã -disposition-le-shiny-ou-streamlit" class="nav-link" data-scroll-target="#utilisation-de-limage-docker-pour-mettre-Ã -disposition-le-shiny-ou-streamlit"><span class="header-section-number">6.2</span> Utilisation de lâ€™image Docker pour mettre Ã  disposition le <code>Shiny</code> ou <code>Streamlit</code></a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/inseefrlab/funathon2024_sujet2/edit/main/index.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/inseefrlab/funathon2024_sujet2/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Un tableau de bord du trafic aÃ©rien avec <i class="fa-brands fa-r-project" aria-label="r-project"></i> ou <i class="fa-brands fa-python" aria-label="python"></i></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<a href="https://datalab.sspcloud.fr/launcher/ide/rstudio?name=Funathon%202024%20-%20Sujet%202&amp;version=1.15.26&amp;autoLaunch=false&amp;networking.user.enabled=true&amp;git.repository=Â«https%3A%2F%2Fgithub.com%2FInseeFrLab%2Ffunathon2024_sujet2.gitÂ»&amp;onyxia.friendlyName=Â«config-funathon2024Â»&amp;kubernetes.role=Â«adminÂ»&amp;git.cache=Â«36000Â»" target="_blank" rel="noopener"><img src="https://img.shields.io/badge/SSP%20Cloud-Ouvrir_dans_RStudio-blue?logo=rstudio&amp;logoColor=blue" alt="Onyxia"></a>
<a href="https://datalab.sspcloud.fr/launcher/ide/vscode-python?version=1.11.35&amp;autoLaunch=false&amp;networking.user.enabled=true&amp;git.repository=Â«https%3A%2F%2Fgithub.com%2Finseefrlab%2Ffunathon2024_sujet2.gitÂ»&amp;git.cache=Â«36000Â»&amp;kubernetes.role=Â«adminÂ»" target="_blank" rel="noopener"><img src="https://img.shields.io/badge/SSP%20Cloud-Ouvrir_dans_VSCode-blue?logo=vscode&amp;logoColor=blue" alt="Onyxia"></a>
<p><br></p>
<table data-quarto-postprocess="true" class="table">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Niveau technique</th>
<th data-quarto-table-cell-role="th">Enjeux</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="level-button level-debutant">DÃ©butant</span></td>
<td>Suivre les consignes, tester les exemples, reprendre et comprendre les corrections. <strong>Ne pas se prÃ©occuper de la fin du tutoriel (l'ouverture vers la mise en production)</strong>.</td>
</tr>
<tr class="even">
<td><span class="level-button level-intermediaire">IntermÃ©diaire</span></td>
<td>Chercher Ã  faire les exercices et ne regarder les aides que si nÃ©cessaire. <strong>Ne pas se prÃ©occuper de la fin du tutoriel (l'ouverture vers la mise en production)</strong>.</td>
</tr>
<tr class="odd">
<td><span class="level-button level-expert">Expert</span></td>
<td>Faire les premiers exercices en autonomie. <strong>L'objectif principal est de faire la partie mise en production</strong>.</td>
</tr>
</tbody>
</table>
<section id="introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<section id="objectif" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="objectif"><span class="header-section-number">1.1</span> Objectif</h2>
<p>Lâ€™objectif de ce tutoriel est dâ€™amener, pas Ã  pas, Ã  la conception voire Ã  la mise Ã  disposition dâ€™un tableau de bord (<em>dashboard</em>) du trafic aÃ©rien avec <i class="fa-brands fa-r-project" aria-label="r-project"></i> ou <i class="fa-brands fa-python" aria-label="python"></i>. Ce tutoriel est Ã©galement lâ€™occasion dâ€™apprendre quelques bonnes pratiques pour les projets <i class="fa-brands fa-r-project" aria-label="r-project"></i> et <i class="fa-brands fa-python" aria-label="python"></i>. Une dÃ©monstration de cette application est disponible sur</p>
<ul>
<li><a href="https://rplane-dashboard.kub.sspcloud.fr/" class="uri">https://rplane-dashboard.kub.sspcloud.fr/</a> (<i class="fa-brands fa-r-project" aria-label="r-project"></i>) ;</li>
<li><a href="https://pylot-dashboard.kub.sspcloud.fr/" class="uri">https://pylot-dashboard.kub.sspcloud.fr/</a> (<i class="fa-brands fa-python" aria-label="python"></i>).</li>
</ul>
<p>Lâ€™objectif est de construire progressivement cette application en suivant les Ã©tapes logiques du dÃ©roulement dâ€™un projet de dÃ©veloppement dâ€™application interactive : dÃ©couverte et exploration des donnÃ©es, crÃ©ation de statistiques descriptives et de visualisations simples sur un jeu de donnÃ©es, extension du nombre de visualisations accessibles par la crÃ©ation dâ€™une application.</p>
<p>Lâ€™objectif secondaire de ce tutoriel est de faire dÃ©couvrir quelques bonnes pratiques de programmation avec <i class="fa-brands fa-r-project" aria-label="r-project"></i> ou <i class="fa-brands fa-python" aria-label="python"></i> afin de rendre les projets plus fiables, Ã©volutifs et lisibles. Comme vous pourrez le faire au cours de celui-ci, la diffÃ©rence entre ces deux langages est assez minime. Lâ€™un des objectifs de ce tutoriel est de vous amener Ã  structurer votre projet selon la norme suivante:</p>
<div id="fig-environment" class="quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-messy" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="https://inseefrlab.github.io/formation-bonnes-pratiques-git-R/slides/img/environment_messy.png" class="img-fluid figure-img" data-ref-parent="fig-environment"></p>
<figcaption class="figure-caption">(a) <em>Environnement mal structurÃ©</em></figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-clean" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="https://inseefrlab.github.io/formation-bonnes-pratiques-git-R/slides/img/environment.png" class="img-fluid figure-img" data-ref-parent="fig-environment"></p>
<figcaption class="figure-caption">(b) Environnement bien structurÃ©</figcaption>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;1: Lâ€™environnement vers lequel on dÃ©sire converger</figcaption><p></p>
</figure>
</div>
<p>Les exercices de conception pas Ã  pas de lâ€™application sâ€™adressent aussi bien Ã  des dÃ©butants quâ€™Ã  des utilisateurs plus avancÃ©s. La mise Ã  disposition, câ€™est-Ã -dire la mise en production de cette application, fait toutefois appel Ã  des concepts et outils plus avancÃ©s et est donc moins accessible Ã  des dÃ©butants.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Afin de se concentrer sur la dÃ©marche, cette application interactive prÃ©sentera un nombre limitÃ© de fonctionnalitÃ©s.</p>
<p>Si vous disposez de temps supplÃ©mentaire, nâ€™hÃ©sitez pas Ã  ajouter des fonctionnalitÃ©s Ã  celle-ci et Ã  les proposer pour un ajout dans la galerie du site web du funathon (<a href="https://inseefrlab.github.io/funathon2024/">inseefrlab.github.io/funathon2024/</a>).</p>
</div>
</div>
</section>
<section id="pourquoi-dÃ©velopper-une-application-interactive" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="pourquoi-dÃ©velopper-une-application-interactive"><span class="header-section-number">1.2</span> Pourquoi dÃ©velopper une application interactive ?</h2>
<p>Cette question peut apparaÃ®tre naÃ¯ve. Pourtant, elle mÃ©rite dâ€™Ãªtre posÃ©e car elle permet de rÃ©flÃ©chir:</p>
<ul>
<li><strong>Ã  lâ€™objectif de lâ€™application</strong> ;</li>
<li><strong>Ã  son public cible</strong>.</li>
</ul>
<p>Cette rÃ©flexion devrait Ãªtre menÃ©e systÃ©matiquement car elle guide les choix techniques ultÃ©rieurs et la rÃ©partition des tÃ¢ches entre les diffÃ©rents profils pouvant intervenir dans la vie du projet sâ€™il est mis en production (statisticien ou <em>data scientist</em>, Ã©quipes informatiquesâ€¦).</p>
<section id="une-valorisation-de-donnÃ©es-rapide-et-attractive" class="level3" data-number="1.2.1">
<h3 data-number="1.2.1" class="anchored" data-anchor-id="une-valorisation-de-donnÃ©es-rapide-et-attractive"><span class="header-section-number">1.2.1</span> Une valorisation de donnÃ©es rapide et attractive</h3>
<p>En gÃ©nÃ©ral, on fait de la visualisation de donnÃ©es car les sources de donnÃ©es exploitÃ©es prÃ©sentent tellement de dimensions pouvant intÃ©resser un utilisateur quâ€™il est plus pertinent de le laisser explorer les donnÃ©es que de dÃ©finir pour lui les statistiques Ã  mettre en avant. Lâ€™interactivitÃ© permise par les sites web est particuliÃ¨rement adaptÃ©e pour cela : le fait dâ€™afficher ou masquer des visualisations en fonction de choix de lâ€™utilisateur Ã©vite de noyer lâ€™information par rapport Ã  des supports figÃ©s.</p>
<p>Les <em>frameworks</em> <code>Shiny</code> (<i class="fa-brands fa-r-project" aria-label="r-project"></i>), <code>Streamlit</code> ou <code>Dash</code> (<i class="fa-brands fa-python" aria-label="python"></i>) permettent de rapidement mettre en oeuvre ce type de site web. Pour une phase de construction dâ€™un prototype, câ€™est un choix technique intÃ©ressant qui peut provoquer lâ€™effet <em>wahou</em> attendu pour lancer le projet Ã  plus grande Ã©chelle. En effet, ces solutions techniques permettent, avec les outils bien connus des praticiens de la donnÃ©e (<i class="fa-brands fa-r-project" aria-label="r-project"></i> ou <i class="fa-brands fa-python" aria-label="python"></i>) de crÃ©er rapidement un site web fonctionnel, ergonomique et effectuant des opÃ©rations en fonction dâ€™actions de lâ€™utilisateur sur la page web. Tout ceci sans avoir Ã  maÃ®triser des notions complexes de dÃ©veloppement web.</p>
</section>
<section id="une-mise-Ã -disposition-parfois-complexe" class="level3" data-number="1.2.2">
<h3 data-number="1.2.2" class="anchored" data-anchor-id="une-mise-Ã -disposition-parfois-complexe"><span class="header-section-number">1.2.2</span> Une mise Ã  disposition parfois complexe</h3>
<p>NÃ©anmoins, passÃ©e cette phase dâ€™expÃ©rimentation, le partage de ces applications, au-delÃ  dâ€™un partage dâ€™Ã©cran pour des dÃ©monstrations, nâ€™est pas toujours Ã©vident (dâ€™oÃ¹ le fait, nous y reviendrons, que la derniÃ¨re partie de ce tutoriel sâ€™adresse plutÃ´t Ã  un niveau expert). Cette difficultÃ© est due au fait quâ€™assurer le bon fonctionnement dâ€™un site web pÃ©renne requiert la maÃ®trise de notions complexes, qui ne sont pas nÃ©cessaires au cours de la phase dâ€™expÃ©rimentation. Celles-ci dÃ©passent nÃ©anmoins le champ de compÃ©tence des statisticiens ou <em>data scientists</em>.</p>
<p>Autrement dit, si le projet a lâ€™ambition dâ€™Ãªtre partagÃ© Ã  une audience large qui nâ€™a pas les compÃ©tences techniques pour faire tourner elle-mÃªme le code, il convient de prendre en compte le fait quâ€™il faudra dans lâ€™Ã©quipe projet des compÃ©tencess spÃ©cifiques de dÃ©veloppement web. Si le projet est expÃ©rimental, câ€™est moins un problÃ¨me : <code>Shiny</code>, <code>Dash</code> ou <code>Streamlit</code> permettront dâ€™avoir rapidement un prototype viable.</p>
<p>Il existe heureusement des solutions techniques plus simples Ã  mettre en oeuvre que <code>Shiny</code>, <code>Streamlit</code> ou <code>Dash</code>. Les <strong>sites web statiques</strong> font partie de cet Ã©ventail des possibles et reprÃ©sentent souvent une alternative pertinente aux applications interactives Ã  condition quâ€™ils soient bien pensÃ©s. Ils sont notamment pertinents pour les applications de visualisation de donnÃ©es oÃ¹ cette derniÃ¨re est dÃ©jÃ  prÃ©parÃ©e en amont. Avoir un serveur <code>R</code> ou <code>Python</code> se justifie en effet si des Ã©tapes complexes de structuration de donnÃ©es interviennent. Inversement, si aucun traitement de donnÃ©es complexe nâ€™est nÃ©cessaire, un simple enrobage avec un constructeur de site comme <code>Quarto</code> peut suffire, Ã  condition que les productions graphiques ne soient pas trop complexes Ã  crÃ©er. Pour des sites faisant intervenir des interactions multiples entre actions dâ€™un utilisateur (bouton, menu dÃ©roulant, etc. ) et affichage, il faudra recourir Ã  du <code>Javascript</code> (technologie utilisÃ©e par les sites spÃ©cialisÃ©s dans la <em>dataviz</em>), ce qui fait, Ã  nouveau, appel Ã  des compÃ©tences qui dÃ©passent celles des <em>data scientists</em> ou statisticiens classiques.</p>
<p>En rÃ©sumÃ©, les Ã©lÃ©ments ci-dessus ont vocation Ã  servir de mise en garde. <code>Shiny</code>, <code>Dash</code> ou <code>Streamlit</code> sont dâ€™excellents outils techniques lorsquâ€™ils sont utilisÃ©s Ã  bon escient. Ceci dit, leur simplicitÃ© dâ€™usage ne dispense pas de se poser des questions cruciales comme celles du cycle de vie du projet, du public cible ou encore de la compÃ©tence des Ã©quipes amenÃ©es Ã  maintenir le projet sâ€™il perdure au-delÃ  dâ€™une phase dâ€™expÃ©rimentation.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Site statique vs application rÃ©active
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>La distinction principale entre ces deux approches est quâ€™elles sâ€™appuient sur des serveurs diffÃ©rents. Un site statique repose sur un serveur web lÃ  oÃ¹ <code>Shiny</code>/<code>Streamlit</code> sâ€™appuient sur des serveurs classiques en <em>backend</em>. La diffÃ©rence principale entre ces deux types de serveurs rÃ©side principalement dans leur fonction et leur utilisation :</p>
<ul>
<li>Un <strong>serveur web</strong> est spÃ©cifiquement conÃ§u pour stocker, traiter et livrer des pages web aux clients. Cela inclut des fichiers HTML, CSS, JavaScript, images, etc. Les serveurs web Ã©coutent les requÃªtes HTTP/HTTPS provenant des navigateurs des utilisateurs et y rÃ©pondent en envoyant les donnÃ©es demandÃ©es.</li>
<li>Un <strong>serveur <em>backend</em></strong> classique est conÃ§u pour effectuer des opÃ©rations en rÃ©ponse Ã  un <em>front</em>, en lâ€™occurrence une page web. Dans le contexte dâ€™une application <code>Streamlit</code> (resp. <code>Shiny</code>), il sâ€™agit dâ€™un serveur avec lâ€™environnement <code>Python</code> (resp. <code>R</code>) <em>ad hoc</em> pour exÃ©cuter le code nÃ©cessaire Ã  rÃ©pondre Ã  toute action dâ€™un utilisateur de lâ€™application.</li>
</ul>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="exploration-des-donnÃ©es-de-trafic-aÃ©rien" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Exploration des donnÃ©es de trafic aÃ©rien</h1>
<p>Pour pouvoir proposer un tableau de bord pertinent, le premier geste Ã  avoir est dâ€™explorer soi-mÃªme les donnÃ©es. Lâ€™objectif de cette partie est de guider le travail exploratoire. Le travail ultÃ©rieur sur lâ€™application visera Ã  consolider et gÃ©nÃ©raliser ces explorations de donnÃ©es.</p>
<section id="prÃ©liminaire-rÃ©cupÃ©rer-le-projet-squelette-avec-git-fa-brands-git-alt" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="prÃ©liminaire-rÃ©cupÃ©rer-le-projet-squelette-avec-git-fa-brands-git-alt"><span class="header-section-number">2.1</span> PrÃ©liminaire : rÃ©cupÃ©rer le projet squelette avec <code>Git</code> <i class="fa-brands fa-git-alt" aria-label="git-alt"></i></h2>
<p>Si vous disposez dâ€™un compte sur le <a href="https://www.sspcloud.fr/"><code>sspcloud</code></a>, la mÃ©thode recommandÃ©e pour se lancer dans ce tutoriel est de cliquer sur le bouton suivant</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true"><i class="fa-brands fa-r-project" aria-label="r-project"></i></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false"><i class="fa-brands fa-python" aria-label="python"></i></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p>La dÃ©marche de rÃ©cupÃ©ration a Ã©tÃ© expliquÃ©e au cours de la prÃ©sentation de lâ€™environnement technique. Voici, en rÃ©sumÃ©, les gestes Ã  faire:</p>
<ul>
<li>Forker le dÃ©pÃ´t <a href="https://github.com/InseeFrLab/funathon2024_sujet2"><i class="fa-brands fa-github" aria-label="github"></i> <code>InseeFrLab/funathon2024_sujet2</code></a></li>
<li>Cliquer sur le bouton ci-dessous:</li>
</ul>
<center>
<a href="https://datalab.sspcloud.fr/launcher/ide/rstudio?name=Funathon%202024%20-%20Sujet%202&amp;version=1.15.26&amp;autoLaunch=false&amp;networking.user.enabled=true&amp;git.repository=Â«https%3A%2F%2Fgithub.com%2FInseeFrLab%2Ffunathon2024_sujet2.gitÂ»&amp;onyxia.friendlyName=Â«config-funathon2024Â»&amp;kubernetes.role=Â«adminÂ»&amp;git.cache=Â«36000Â»" target="_blank" rel="noopener"><img src="https://img.shields.io/badge/SSP%20Cloud-Ouvrir_dans_RStudio-blue?logo=rstudio&amp;logoColor=blue" alt="Onyxia"></a>
</center>
<br>
<ul>
<li>Sur la page <code>SSPCloud</code> qui sâ€™ouvre, changer lâ€™URL indiquÃ© dans lâ€™onglet <code>Git</code> pour mettre celui de votre <em>fork</em></li>
</ul>
<p><em>Revoir la vidÃ©o de prÃ©sentation sur <a href="https://inseefrlab.github.io/funathon2024">https://inseefrlab.github.io/funathon2024</a> (Ã  dÃ©marrer Ã  partir de 1h29mn)</em></p>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p>La dÃ©marche de rÃ©cupÃ©ration est assez similaire Ã  celle expliquÃ©e pour <i class="fa-brands fa-r-project" aria-label="r-project"></i>. Voici, en rÃ©sumÃ©, les gestes Ã  faire:</p>
<ul>
<li>Forker le dÃ©pÃ´t <a href="https://github.com/InseeFrLab/funathon2024_sujet2"><i class="fa-brands fa-github" aria-label="github"></i> <code>InseeFrLab/funathon2024_sujet2</code></a></li>
<li>Cliquer sur le bouton ci-dessous:</li>
</ul>
<center>
<a href="https://datalab.sspcloud.fr/launcher/ide/vscode-python?version=1.11.35&amp;autoLaunch=false&amp;networking.user.enabled=true&amp;git.repository=Â«https%3A%2F%2Fgithub.com%2Finseefrlab%2Ffunathon2024_sujet2.gitÂ»&amp;git.cache=Â«36000Â»&amp;kubernetes.role=Â«adminÂ»" target="_blank" rel="noopener"><img src="https://img.shields.io/badge/SSP%20Cloud-Ouvrir_dans_VSCode-blue?logo=vscode&amp;logoColor=blue" alt="Onyxia"></a>
</center>
<br>
<ul>
<li>Sur la page <code>SSPCloud</code> qui sâ€™ouvre, changer lâ€™URL indiquÃ© dans lâ€™onglet <code>Git</code> pour mettre celui de votre <em>fork</em></li>
</ul>
<p><em>Revoir la vidÃ©o de prÃ©sentation sur <a href="https://inseefrlab.github.io/funathon2024">https://inseefrlab.github.io/funathon2024</a> (Ã  dÃ©marrer Ã  partir de 1h29mn)</em></p>
</div>
</div>
</div>
<p>Si vous avez utilisÃ© le lien de lancement rapide mis Ã  disposition sur la page <a href="https://inseefrlab.github.io/funathon2024/">inseefrlab.github.io/funathon2024/</a> ou ci-dessus â˜ï¸, vous pouvez sauter lâ€™Ã©tape de rÃ©cupÃ©ration du modÃ¨le de projet avec <code>Git</code> <i class="fa-brands fa-git-alt" aria-label="git-alt"></i>, cela a Ã©tÃ© fait automatiquement lors de la crÃ©ation de votre environnement <code>RStudio</code> ou <code>VSCode</code>. <strong>Cela ne vous dispense pas de faire du <code>Git</code> tout au long du tutoriel ğŸ˜º</strong>, câ€™est une bonne pratique, mÃªme sur des projets ponctuels ou vous Ãªtes seuls Ã  travailler.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
RÃ©cupÃ©rer le projet si vous nâ€™avez pas utilisÃ© le bouton proposÃ©
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true"><i class="fa-brands fa-r-project" aria-label="r-project"></i></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false"><i class="fa-brands fa-python" aria-label="python"></i></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">Interface graphique</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Depuis le terminal</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<p>La fiche <code>utilitR</code> sur lâ€™<a href="https://book.utilitr.org/03_Fiches_thematiques/Fiche_git_utilisation.html#recuperer-url">utilisation de <code>Git</code></a> explicite la dÃ©marche gÃ©nÃ©rale pour rÃ©cupÃ©rer du code grÃ¢ce Ã  <code>Git</code>. Il est recommandÃ© de lire celle-ci si vous nâ€™Ãªtes pas familier de <code>Git</code>.</p>
<p>Les Ã©tapes suivantes permettront de rÃ©cupÃ©rer le projet:</p>
<p>1ï¸âƒ£ En premier lieu, dans <code>RStudio</code>, crÃ©er un nouveau projet et sÃ©lectionner <code>Version Control</code>.</p>
<p><img src="https://book.utilitr.org/pics_resized/git/create_project_1.png" class="img-fluid"></p>
<p>2ï¸âƒ£ Choisir <code>Git</code>, ce qui devrait ouvrir une fenÃªtre similaire Ã  celle ci-dessous:</p>
<p><img src="https://book.utilitr.org/pics_resized/git/create_project_2.png" class="img-fluid"></p>
<p>3ï¸âƒ£ Dans la fenÃªtre <code>Repository URL</code>, passer la valeur</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>https<span class="sc">:</span><span class="er">//</span>github.com<span class="sc">/</span>inseefrlab<span class="sc">/</span>funathon2024_sujet2.git</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>laisser les valeurs par dÃ©faut qui viennent ensuite et crÃ©er le projet.</p>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<p>AprÃ¨s avoir ouvert un terminal dans <code>RStudio</code>, faire</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> clone https://github.com/inseefrlab/funathon2024_sujet2.git</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>puis, dans lâ€™explorateur de fichiers (fenÃªtre en bas Ã  droite), cliquer sur le fichier <code>RTraffic.Rproj</code> pour ouvrir le projet.</p>
</div>
</div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<ul>
<li>Ouvrir un terminal depuis <code>VSCode</code> (<code>Terminal</code> &gt; <code>New Terminal</code>).</li>
<li>RÃ©cupÃ©rer, sur la page dâ€™accueil de votre dÃ©pÃ´t, lâ€™url du dÃ©pÃ´t distant. Il prend la forme suivante</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>https:<span class="op">//</span>github.com<span class="op">/&lt;</span>username<span class="op">&gt;/&lt;</span>reponame<span class="op">&gt;</span>.git</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Dans le terminal, taper</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>git clone repo_url</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>oÃ¹ <code>repo_url</code> est lâ€™URL de votre <em>fork</em></p>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="se-placer-dans-lenvironnement-du-projet" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="se-placer-dans-lenvironnement-du-projet"><span class="header-section-number">2.2</span> Se placer dans lâ€™environnement du projet</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true"><i class="fa-brands fa-r-project" aria-label="r-project"></i></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false"><i class="fa-brands fa-python" aria-label="python"></i></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<p>A la racine du projet, on trouve notamment le fichier <code>RTraffic.Rproj</code>. Il sâ€™agit dâ€™un fichier de projet <code>RStudio</code>. Lorsquâ€™on travaille sur du code <i class="fa-brands fa-r-project" aria-label="r-project"></i> avec <code>RStudio</code>, il est gÃ©nÃ©ralement prÃ©fÃ©rable de travailler dans le cadre dâ€™un projet.</p>
<p>Entre autres raisons, Ã©voquÃ©es dans la documentation <a href="https://book.utilitr.org/03_Fiches_thematiques/Fiche_rprojects.html"><code>utilitR</code></a>, cela favorise la reproductibilitÃ©: lorsquâ€™on se situe dans un projet <code>RStudio</code>, tous les chemins peuvent Ãªtre dÃ©finis de maniÃ¨re <em>relative</em> (Ã  la racine du projet) plutÃ´t que de maniÃ¨re absolue (Ã  la racine de la machine). Ainsi, le projet sâ€™exÃ©cutera de la mÃªme maniÃ¨re quâ€™il soit exÃ©cutÃ© depuis une machine <em>Windows</em> ou <em>Linux</em> par exemple, avec des noms dâ€™utilisateurs diffÃ©rents ou sâ€™ils se situent dans des dossiers diffÃ©rents au sein de <em>â€œMes Documentsâ€</em>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Plus de dÃ©tails dans <a href="https://book.utilitr.org/03_Fiches_thematiques/Fiche_rprojects.html"><code>utilitR</code></a>
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Pour plus de dÃ©tails sur les bÃ©nÃ©fices dâ€™utiliser les projets <code>RStudio</code> ou leur utilisation en pratique, nâ€™hÃ©sitez pas Ã  consulter la <a href="https://book.utilitr.org/03_Fiches_thematiques/Fiche_rprojects.html">fiche <code>utilitR</code></a> dÃ©diÃ©e.</p>
</div>
</div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<p>Les utilisateurs de <i class="fa-brands fa-python" aria-label="python"></i> connaissent deux environnements de travail trÃ¨s diffÃ©rents: la ligne de commande pour exÃ©cuter des scripts ou les <em>notebooks</em> <code>Jupyter</code> pour avoir un environnement interactif.</p>
<p>Les seconds sont pratiques pour prototyper et expÃ©rimenter. Mais ils ne sont pas faits pour construire des applications. Nous proposons donc la mÃ©thode de travail suivante:</p>
<ul>
<li>CrÃ©er un <code>Jupyter Notebook</code> Ã  la racine du projet (au mÃªme niveau que le <code>README.md</code>)<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. Celui-ci sera votre espace pour Ã©crire du code expÃ©rimental. Lorsquâ€™il sera fonctionnel, vous pourrez le reporter dans des scripts comme indiquÃ©s dans les consignes.</li>
<li>Dans un terminal, faire <code>cd funathon2024_sujet2</code> (ou remplacer par le nom de dossier diffÃ©rent si vous lâ€™avez changÃ©). Câ€™est dans ce terminal que vous testerez vos scripts. Pour ouvrir un terminal, il suffit de cliquer sur le menu VScode en haut Ã  gauche (les trois petites barres horizontales), puis <code>Terminal &gt; New Terminal</code>.</li>
</ul>
</div>
</div>
</div>
</section>
<section id="architecture-du-projet" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="architecture-du-projet"><span class="header-section-number">2.3</span> Architecture du projet</h2>
<p>Le projet rÃ©cupÃ©rÃ© comporte de nombreux fichiers. Nous allons progressivement les dÃ©couvrir dans ce tutoriel. A lâ€™heure actuelle, on peut se concentrer sur les fichiers suivants:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true"><i class="fa-brands fa-r-project" aria-label="r-project"></i></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false"><i class="fa-brands fa-python" aria-label="python"></i></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<div class="sourceCode" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>funathon_sujet2<span class="sc">/</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>â”œâ”€â”€ renv.lock</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>â”œâ”€â”€ correction<span class="sc">/</span>R<span class="sc">/</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>â”œâ”€â”€ correction<span class="sc">/</span>global.R</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>â”œâ”€â”€ correction<span class="sc">/</span>server.R</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>â””â”€â”€ correction<span class="sc">/</span>ui.R</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Le premier fichier (<code>renv.lock</code>) correspond Ã  la liste des <em>packages</em> nÃ©cessaires pour reproduire lâ€™environnement. Il a Ã©tÃ© gÃ©nÃ©rÃ© automatiquement grÃ¢ce Ã  un Ã©cosystÃ¨me <code>renv</code> particuliÃ¨rement adaptÃ© pour assurer la reproductibilitÃ© de projets <i class="fa-brands fa-r-project" aria-label="r-project"></i> (voir la suite).</p>
<p>Les fichiers <code>server.R</code> et <code>ui.R</code> constituent le coeur de notre application <code>Shiny</code>. Ils reprÃ©sentent, respectivement, le moteur de calcul (le serveur) et lâ€™interface utilisateur de notre application. Nous reviendrons sur ce concept. Le fichier <code>global.R</code> stocke un certain nombre dâ€™objets utiles Ã  lâ€™application mais qui nâ€™ont pas besoin dâ€™Ãªtre recalculÃ©s Ã  chaque action sur lâ€™interface graphique. Nous allons progressivement construire ces fichiers pendant les diffÃ©rents exercices. De nombreuses fonctions sont reportÃ©es dans les fichiers au sein du dossier <code>R/</code>.</p>
<details>
<summary>
Observer la composition de ce fichier (100 premiÃ¨res lignes)
</summary>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>renv.lock</strong></pre>
</div>
<div class="sourceCode" id="cb6"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">"R"</span><span class="kw">:</span><span class="at"> </span><span class="kw">{</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">"Version"</span><span class="kw">:</span><span class="at"> </span><span class="st">"4.3.3"</span><span class="kw">,</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">"Repositories"</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">{</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">"Name"</span><span class="kw">:</span><span class="at"> </span><span class="st">"CRAN"</span><span class="kw">,</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">"URL"</span><span class="kw">:</span><span class="at"> </span><span class="st">"https://packagemanager.posit.co/cran/latest"</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">}</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">]</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">},</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">"Packages"</span><span class="kw">:</span><span class="at"> </span><span class="kw">{</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">"BH"</span><span class="kw">:</span><span class="at"> </span><span class="kw">{</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">"Package"</span><span class="kw">:</span><span class="at"> </span><span class="st">"BH"</span><span class="kw">,</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">"Version"</span><span class="kw">:</span><span class="at"> </span><span class="st">"1.84.0-0"</span><span class="kw">,</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">"Source"</span><span class="kw">:</span><span class="at"> </span><span class="st">"Repository"</span><span class="kw">,</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">"Repository"</span><span class="kw">:</span><span class="at"> </span><span class="st">"CRAN"</span><span class="kw">,</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">"Hash"</span><span class="kw">:</span><span class="at"> </span><span class="st">"a8235afbcd6316e6e91433ea47661013"</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">},</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">"DBI"</span><span class="kw">:</span><span class="at"> </span><span class="kw">{</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">"Package"</span><span class="kw">:</span><span class="at"> </span><span class="st">"DBI"</span><span class="kw">,</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">"Version"</span><span class="kw">:</span><span class="at"> </span><span class="st">"1.2.2"</span><span class="kw">,</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">"Source"</span><span class="kw">:</span><span class="at"> </span><span class="st">"Repository"</span><span class="kw">,</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">"Repository"</span><span class="kw">:</span><span class="at"> </span><span class="st">"CRAN"</span><span class="kw">,</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">"Requirements"</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="st">"R"</span><span class="kw">,</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="st">"methods"</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">],</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">"Hash"</span><span class="kw">:</span><span class="at"> </span><span class="st">"164809cd72e1d5160b4cb3aa57f510fe"</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">},</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">"DT"</span><span class="kw">:</span><span class="at"> </span><span class="kw">{</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">"Package"</span><span class="kw">:</span><span class="at"> </span><span class="st">"DT"</span><span class="kw">,</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">"Version"</span><span class="kw">:</span><span class="at"> </span><span class="st">"0.33"</span><span class="kw">,</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">"Source"</span><span class="kw">:</span><span class="at"> </span><span class="st">"Repository"</span><span class="kw">,</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">"Repository"</span><span class="kw">:</span><span class="at"> </span><span class="st">"RSPM"</span><span class="kw">,</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">"Requirements"</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="st">"crosstalk"</span><span class="kw">,</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="st">"htmltools"</span><span class="kw">,</span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="st">"htmlwidgets"</span><span class="kw">,</span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="st">"httpuv"</span><span class="kw">,</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="st">"jquerylib"</span><span class="kw">,</span></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="st">"jsonlite"</span><span class="kw">,</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="st">"magrittr"</span><span class="kw">,</span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="st">"promises"</span></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">],</span></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">"Hash"</span><span class="kw">:</span><span class="at"> </span><span class="st">"64ff3427f559ce3f2597a4fe13255cb6"</span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">},</span></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">"KernSmooth"</span><span class="kw">:</span><span class="at"> </span><span class="kw">{</span></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">"Package"</span><span class="kw">:</span><span class="at"> </span><span class="st">"KernSmooth"</span><span class="kw">,</span></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">"Version"</span><span class="kw">:</span><span class="at"> </span><span class="st">"2.23-22"</span><span class="kw">,</span></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">"Source"</span><span class="kw">:</span><span class="at"> </span><span class="st">"Repository"</span><span class="kw">,</span></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">"Repository"</span><span class="kw">:</span><span class="at"> </span><span class="st">"CRAN"</span><span class="kw">,</span></span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">"Requirements"</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="st">"R"</span><span class="kw">,</span></span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="st">"stats"</span></span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">],</span></span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">"Hash"</span><span class="kw">:</span><span class="at"> </span><span class="st">"2fecebc3047322fa5930f74fae5de70f"</span></span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">},</span></span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">"MASS"</span><span class="kw">:</span><span class="at"> </span><span class="kw">{</span></span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">"Package"</span><span class="kw">:</span><span class="at"> </span><span class="st">"MASS"</span><span class="kw">,</span></span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">"Version"</span><span class="kw">:</span><span class="at"> </span><span class="st">"7.3-60.0.1"</span><span class="kw">,</span></span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">"Source"</span><span class="kw">:</span><span class="at"> </span><span class="st">"Repository"</span><span class="kw">,</span></span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">"Repository"</span><span class="kw">:</span><span class="at"> </span><span class="st">"CRAN"</span><span class="kw">,</span></span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">"Requirements"</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span></span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="st">"R"</span><span class="kw">,</span></span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="st">"grDevices"</span><span class="kw">,</span></span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="st">"graphics"</span><span class="kw">,</span></span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="st">"methods"</span><span class="kw">,</span></span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="st">"stats"</span><span class="kw">,</span></span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="st">"utils"</span></span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">],</span></span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">"Hash"</span><span class="kw">:</span><span class="at"> </span><span class="st">"b765b28387acc8ec9e9c1530713cb19c"</span></span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">},</span></span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">"Matrix"</span><span class="kw">:</span><span class="at"> </span><span class="kw">{</span></span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">"Package"</span><span class="kw">:</span><span class="at"> </span><span class="st">"Matrix"</span><span class="kw">,</span></span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">"Version"</span><span class="kw">:</span><span class="at"> </span><span class="st">"1.6-5"</span><span class="kw">,</span></span>
<span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">"Source"</span><span class="kw">:</span><span class="at"> </span><span class="st">"Repository"</span><span class="kw">,</span></span>
<span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">"Repository"</span><span class="kw">:</span><span class="at"> </span><span class="st">"CRAN"</span><span class="kw">,</span></span>
<span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">"Requirements"</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span></span>
<span id="cb6-79"><a href="#cb6-79" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="st">"R"</span><span class="kw">,</span></span>
<span id="cb6-80"><a href="#cb6-80" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="st">"grDevices"</span><span class="kw">,</span></span>
<span id="cb6-81"><a href="#cb6-81" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="st">"graphics"</span><span class="kw">,</span></span>
<span id="cb6-82"><a href="#cb6-82" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="st">"grid"</span><span class="kw">,</span></span>
<span id="cb6-83"><a href="#cb6-83" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="st">"lattice"</span><span class="kw">,</span></span>
<span id="cb6-84"><a href="#cb6-84" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="st">"methods"</span><span class="kw">,</span></span>
<span id="cb6-85"><a href="#cb6-85" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="st">"stats"</span><span class="kw">,</span></span>
<span id="cb6-86"><a href="#cb6-86" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="st">"utils"</span></span>
<span id="cb6-87"><a href="#cb6-87" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">],</span></span>
<span id="cb6-88"><a href="#cb6-88" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">"Hash"</span><span class="kw">:</span><span class="at"> </span><span class="st">"8c7115cd3a0e048bda2a7cd110549f7a"</span></span>
<span id="cb6-89"><a href="#cb6-89" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">},</span></span>
<span id="cb6-90"><a href="#cb6-90" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">"R6"</span><span class="kw">:</span><span class="at"> </span><span class="kw">{</span></span>
<span id="cb6-91"><a href="#cb6-91" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">"Package"</span><span class="kw">:</span><span class="at"> </span><span class="st">"R6"</span><span class="kw">,</span></span>
<span id="cb6-92"><a href="#cb6-92" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">"Version"</span><span class="kw">:</span><span class="at"> </span><span class="st">"2.5.1"</span><span class="kw">,</span></span>
<span id="cb6-93"><a href="#cb6-93" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">"Source"</span><span class="kw">:</span><span class="at"> </span><span class="st">"Repository"</span><span class="kw">,</span></span>
<span id="cb6-94"><a href="#cb6-94" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">"Repository"</span><span class="kw">:</span><span class="at"> </span><span class="st">"RSPM"</span><span class="kw">,</span></span>
<span id="cb6-95"><a href="#cb6-95" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">"Requirements"</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span></span>
<span id="cb6-96"><a href="#cb6-96" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="st">"R"</span></span>
<span id="cb6-97"><a href="#cb6-97" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="kw">],</span></span>
<span id="cb6-98"><a href="#cb6-98" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">"Hash"</span><span class="kw">:</span><span class="at"> </span><span class="st">"470851b6d5d0ac559e9d01bb352b4021"</span></span>
<span id="cb6-99"><a href="#cb6-99" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="kw">},</span></span>
<span id="cb6-100"><a href="#cb6-100" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">"RColorBrewer"</span><span class="kw">:</span><span class="at"> </span><span class="kw">{</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<div class="sourceCode" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>funathon_sujet2<span class="sc">/</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>â”œâ”€â”€ requirements.txt</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>â”œâ”€â”€ correction<span class="sc">/</span>src<span class="sc">/</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>â””â”€â”€ correction<span class="sc">/</span>app.py</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Le premier fichier (<code>requirements.txt</code>) correspond Ã  la liste des <em>packages</em> nÃ©cessaires pour reproduire lâ€™environnement. Il sâ€™agit dâ€™un outil particuliÃ¨rement adaptÃ© pour assurer la reproductibilitÃ© de projets <i class="fa-brands fa-python" aria-label="python"></i> (voir la suite).</p>
<p>Le fichier <code>app.py</code> constitue le coeur de notre application <code>Streamlit</code>. Ils reprÃ©sentent, respectivement, le moteur de calcul (le serveur) et lâ€™interface utilisateur de notre application. Nous reviendrons sur ce concept. Par ailleurs, de nombreuses fonctions utiles pour lâ€™application sont reportÃ©es dans les fichiers au sein du dossier <code>src/</code> (abrÃ©viation de â€œsourceâ€).</p>
<details>
<summary>
Observer la composition de ce fichier
</summary>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>requirements.txt</strong></pre>
</div>
<div class="sourceCode" id="cb8"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="at">pandas</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="at">geopandas</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="at">pyyaml</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="at">plotly</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="at">plotnine</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="at">great_tables</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="at">folium</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="at">streamlit</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="at">streamlit-folium</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
</div>
</div>
</div>
</section>
<section id="installer-les-packages-nÃ©cessaires-pour-ce-tutoriel" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="installer-les-packages-nÃ©cessaires-pour-ce-tutoriel"><span class="header-section-number">2.4</span> Installer les <em>packages</em> nÃ©cessaires pour ce tutoriel</h2>
<section id="principe" class="level3" data-number="2.4.1">
<h3 data-number="2.4.1" class="anchored" data-anchor-id="principe"><span class="header-section-number">2.4.1</span> Principe</h3>
<p>Pour progresser dans ce tutoriel, un certain nombre de <em>packages</em> doivent Ãªtre installÃ©s. Sans eux, mÃªme avec le code de lâ€™application, vous ne serez pas en mesure de reproduire celle-ci.</p>
<p>Les bonnes pratiques pour la gestion de lâ€™environnement sont assez proches en <i class="fa-brands fa-r-project" aria-label="r-project"></i> et <i class="fa-brands fa-python" aria-label="python"></i>. Le principal gÃ©nÃ©ral est quâ€™il existe des outils qui permettent Ã  un utilisateur de lister lâ€™ensemble des packages dans son environnement avec leur version. GrÃ¢ce Ã  cette liste, dâ€™autres personnes pourront reproduire lâ€™application si elles disposent des mÃªmes <em>inputs</em> (le code, les donnÃ©esâ€¦).</p>
<p>En effet, il est important de voir lâ€™application comme le rÃ©sultat de la combinaison de plusieurs ingrÃ©dients. Dans notre cas, nous en avons trois:</p>
<ul>
<li>Du code <i class="fa-brands fa-r-project" aria-label="r-project"></i> ou <i class="fa-brands fa-python" aria-label="python"></i> : celui-ci a Ã©tÃ© rÃ©cupÃ©rÃ© grÃ¢ce Ã  <code>Git</code> lors du lancement du projet;</li>
<li>Des Ã©lÃ©ments de configuration:
<ul>
<li>le fichier <code>renv.lock</code> (<i class="fa-brands fa-r-project" aria-label="r-project"></i>) ou <code>requirements.txt</code> (<i class="fa-brands fa-python" aria-label="python"></i>) qui permettra de reconstruire notre environnement Ã  lâ€™identique grÃ¢ce Ã  des outils adaptÃ©s<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>;</li>
<li>le fichier <code>sources.yaml</code> qui liste lâ€™emplacement des sources sur le site <a href="https://www.data.gouv.fr/fr/">data.gouv</a>.</li>
</ul></li>
<li>Des donnÃ©es : nous Ã©voquerons celles-ci lors de la prochaine partie.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./img/environment.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Illustration du principe de sÃ©paration du code, des donnÃ©es et de la configuration</figcaption>
</figure>
</div>
<p>De maniÃ¨re gÃ©nÃ©rale, câ€™est une bonne pratique de structurer son projet comme une combinaison de ces facteurs. Cela vous amÃ¨nera Ã  faire des projets plus reproductibles mais aussi Ã  la structure plus lisible.</p>
<p>Pour les utilisateurs de <code>R</code>, la <a href="https://inseefrlab.github.io/formation-bonnes-pratiques-git-R/">formation de lâ€™Insee aux bonnes pratiques</a> consacre une partie aux environnements reproductibles avec <code>renv</code>. Pour les utilisateurs de <code>Python</code>, le <a href="https://ensae-reproductibilite.github.io/website/chapters/portability.html">cours de mise en production de projets <em>data science</em></a> consacre un chapitre au sujet.</p>
</section>
<section id="crÃ©er-lenvironnement" class="level3" data-number="2.4.2">
<h3 data-number="2.4.2" class="anchored" data-anchor-id="crÃ©er-lenvironnement"><span class="header-section-number">2.4.2</span> CrÃ©er lâ€™environnement</h3>
<p>Si vous avez dÃ©jÃ  tentÃ© de partager un code qui fonctionnait chez vous, il est presque certain que la personne ayant voulu le rÃ©utiliser a rencontrÃ© une erreur si elle a tentÃ© de le faire tourner. Câ€™est tout Ã  fait normal car vous avez distribuÃ© votre code, Ã©ventuellement vos donnÃ©es, mais pas le troisiÃ¨me pilier de lâ€™image prÃ©cÃ©dente, Ã  savoir la configuration de lâ€™environnement dans lequel votre code fonctionnait. La solution la plus fiable, mais peu pratique, serait de donner votre ordinateur Ã  la personne qui tente de rÃ©utiliser votre code. En livrant votre ordinateur, vous fournissez votre environnement de travail mais Ã©galement beaucoup dâ€™Ã©lÃ©ments supplÃ©mentaires qui ne sont pas indispensables Ã  lâ€™application.</p>
<p>Une solution plus simple est de fournir les spÃ©cifications qui ont permis Ã  votre code de fonctionner. Dans un monde idÃ©al, il sâ€™agit de fournir la liste des <em>packages</em> et leur version. Si la personne Ã  qui vous partagez votre code et vos donnÃ©es a cette mÃªme liste de versions de <em>packages</em>, et pas de <em>packages</em> supplÃ©mentaires venant polluer lâ€™environnement, les chances dâ€™avoir la mÃªme application que vous sont trÃ¨s Ã©levÃ©es.</p>
<p>Les solutions techniques pour restaurer un environnement <i class="fa-brands fa-r-project" aria-label="r-project"></i> et <i class="fa-brands fa-python" aria-label="python"></i> sont lÃ©gÃ¨rement diffÃ©rentes et sont dÃ©crites ci-dessous.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true"><i class="fa-brands fa-r-project" aria-label="r-project"></i></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false"><i class="fa-brands fa-python" aria-label="python"></i></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-6-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<p><code>renv</code> est un gestionnaire de <em>packages</em> qui permet de faire ces deux opÃ©rations :</p>
<ol type="1">
<li>Enregistrer la liste de <em>packages</em> aprÃ¨s avoir fait tourner un code</li>
<li>Restaurer lâ€™environnement Ã  partir de cette liste</li>
</ol>
<p>En lâ€™occurrence, pour vous, lâ€™important est le second point: pouvoir recrÃ©er lâ€™environnement nÃ©cessaire au bon fonctionnement de lâ€™application. Ceci est trÃ¨s simple grÃ¢ce Ã  la commande</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>A lancer dans la console R</strong></pre>
</div>
<div class="sourceCode" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>renv<span class="sc">::</span><span class="fu">restore</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Cette commande doit Ãªtre lancÃ©e depuis la console <code>R</code> ouverte dans le projet qui a Ã©tÃ© rÃ©cupÃ©rÃ©<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>. Lâ€™environnement crÃ©Ã© nâ€™est pas figÃ©. Il est tout Ã  fait possible, ensuite, dâ€™installer des <em>packages</em> supplÃ©mentaires par le biais de <code>install.packages</code>. Lâ€™environnement proposÃ© par notre fichier <code>renv.lock</code> est le minimum requis pour reproduire lâ€™application mais ce nâ€™est pas un environnement figÃ©. Si vous ajoutez des <em>packages</em> utiles pour votre application, avant la phase de mise en production, nâ€™oubliez pas de faire <code>renv::snapshot()</code> pour mettre Ã  jour le fichier <code>renv.lock</code> (câ€™est le point 1. Ã©voquÃ© prÃ©cÃ©demment).</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Ce que <code>renv</code> Ã©vite
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>On retrouve parfois sur internet un code similaire Ã  celui-ci :</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A ne pas reproduire chez vous ğŸ˜¨</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">"dplyr"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">"dplyr"</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Câ€™est une gestion artisanale de lâ€™environnement qui nâ€™est pas conseillÃ©e. <code>renv</code> sera plus simple et plus fiable. De maniÃ¨re gÃ©nÃ©rale, ce nâ€™est pas une bonne pratique de gÃ©rer lâ€™installation des <em>packages</em> dans le script. En effet, câ€™est un Ã©lÃ©ment de configuration et, comme nous lâ€™avons dit, celle-ci doit se faire en dehors du script.</p>
</div>
</div>
</div>
<p>Maintenant que nous disposons dâ€™un environnement fonctionnel, nous pouvons avancer sur la conception du projet. La premiÃ¨re Ã©tape est dâ€™explorer les jeux de donnÃ©es que nous utiliserons dans lâ€™application.</p>
</div>
<div id="tabset-6-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<p>Pour faire les choses bien, il faudrait repartir dâ€™un environnement vierge et installer toutes les dÃ©pendances du projet (comme le fait la solution <i class="fa-brands fa-r-project" aria-label="r-project"></i>).</p>
<p>NÃ©anmoins, si vous Ãªtes sur le SSPCloud, câ€™est presque de lâ€™excÃ¨s de zÃ¨le de faire cela car lâ€™application a Ã©tÃ© dÃ©veloppÃ© Ã  partir de lâ€™environnement du SSPCloud duquel elle ne diverge que trÃ¨s peu. Il suffit donc dâ€™ajouter Ã  lâ€™environnement existant un nombre restreint de <em>packages</em> qui sont listÃ©s dans <code>requirements.txt</code>.</p>
<p>Dans le terminal, il suffit donc de faire un <code>pip install</code> adÃ©quat:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>pip install <span class="op">-</span>r requirements.txt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Ce que ce fichier <code>requirements.txt</code> Ã©vite
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>On retrouve parfois dans des <em>notebooks</em> partagÃ©s sur internet un code similaire Ã  celui-ci :</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A ne pas reproduire chez vous ğŸ˜¨</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="sc">!</span>pip install geopandas</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>voire parfois dans des scripts, ce type de code:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A ne pas reproduire chez vous ğŸ˜¨</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>import subprocess</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">subprocess.run</span>([<span class="st">"pip install geopandas"</span>]) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Câ€™est une gestion artisanale de lâ€™environnement qui nâ€™est pas conseillÃ©e. De maniÃ¨re gÃ©nÃ©rale, ce nâ€™est pas une bonne pratique de gÃ©rer lâ€™installation des <em>packages</em> dans le script. En effet, câ€™est un Ã©lÃ©ment de configuration et, comme nous lâ€™avons dit, celle-ci doit se faire en dehors du script.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="rÃ©cupÃ©rer-les-donnÃ©es" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> RÃ©cupÃ©rer les donnÃ©es</h1>
<section id="objectifs" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="objectifs"><span class="header-section-number">3.1</span> Objectifs</h2>
<p>Dans cette partie, vous allez explorer les donnÃ©es utilisÃ©es pour construire le tableau de bord, avec trois objectifs:</p>
<ul>
<li>vous familiariser avec les sources statistiques sur le trafic aÃ©rien;</li>
<li>dÃ©velopper des fonctions permettant dâ€™importer automatiquement ces donnÃ©es;</li>
<li>dÃ©couvrir comment vous pouvez organiser ces fonctions pour quâ€™elles puissent Ãªtre facilement utilisÃ©es par lâ€™application web (<em>spoiler alert</em>: câ€™est lÃ  que le dossier <code>R/</code> ou <code>src/</code> va servir).</li>
</ul>
</section>
<section id="sources" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="sources"><span class="header-section-number">3.2</span> Sources</h2>
<p>Les sources statistiques utilisÃ©es dans ce tutoriel sont listÃ©es dans le fichier <code>sources.yaml</code>. Il y a quatre sources diffÃ©rentes:</p>
<ul>
<li>Le trafic au niveau de chaque aÃ©roport (format <em>CSV</em>);</li>
<li>Le nombre de passagers pour diffÃ©rentes liaisons (format <em>CSV</em>);</li>
<li>Le trafic pour diffÃ©rentes compagnies (format <em>CSV</em>);</li>
<li>Les localisations des aÃ©roports (format <em>geojson</em>).</li>
</ul>
<p>Une bonne pratique, lorsquâ€™on utilise plusieurs sources, est de lister celles-ci dans un fichier <code>YAML</code> plutÃ´t que de les inscrire en brut dans le code. Ce dernier sera plus lisible grÃ¢ce Ã  cette approche.</p>
<details>
<summary>
<p>Voir le fichier <code>sources.yml</code></p>
</summary>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>sources.yml</strong></pre>
</div>
<div class="sourceCode" id="cb14"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Jeux de donnÃ©es </span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># https://www.data.gouv.fr/fr/datasets/trafic-aerien-commercial-mensuel-francais-par-paire-daeroports-par-sens-depuis-1990/</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="fu">airports</span><span class="kw">:</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">2018</span><span class="kw">:</span><span class="at"> </span><span class="st">"https://www.data.gouv.fr/fr/datasets/r/3b7646ea-276c-4c9b-8151-1e96af2adbf9"</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">2019</span><span class="kw">:</span><span class="at"> </span><span class="st">"https://www.data.gouv.fr/fr/datasets/r/e8efa154-045e-4f8f-a1d7-76a39fa03b7b"</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">2020</span><span class="kw">:</span><span class="at"> </span><span class="st">"https://www.data.gouv.fr/fr/datasets/r/6717f107-be00-4b4b-9706-fa0e5190fb69"</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">2021</span><span class="kw">:</span><span class="at"> </span><span class="st">"https://www.data.gouv.fr/fr/datasets/r/2f9f6e54-e2d7-4e85-b811-2e5e68fa5bca"</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">2022</span><span class="kw">:</span><span class="at"> </span><span class="st">"https://www.data.gouv.fr/fr/datasets/r/f1bd931e-c99e-41ce-865e-9e9785c903ec"</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="fu">liaisons</span><span class="kw">:</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">2018</span><span class="kw">:</span><span class="at"> </span><span class="st">"https://www.data.gouv.fr/fr/datasets/r/9c5354ad-31cb-4217-bc88-fb7c9be22655"</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">2019</span><span class="kw">:</span><span class="at"> </span><span class="st">"https://www.data.gouv.fr/fr/datasets/r/0c0a451e-983b-4f06-9627-b5ff1bccd2fc"</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">2020</span><span class="kw">:</span><span class="at"> </span><span class="st">"https://www.data.gouv.fr/fr/datasets/r/dad30bed-7276-4a67-a1ab-a856e6e01788"</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">2021</span><span class="kw">:</span><span class="at"> </span><span class="st">"https://www.data.gouv.fr/fr/datasets/r/bbf6492d-86ac-43a0-9260-7df2ffdb5a77"</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">2022</span><span class="kw">:</span><span class="at"> </span><span class="st">"https://www.data.gouv.fr/fr/datasets/r/af8950bc-e90a-4b7e-bb81-70c79d4c3846"</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="fu">compagnies</span><span class="kw">:</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">2018</span><span class="kw">:</span><span class="at"> </span><span class="st">"https://www.data.gouv.fr/fr/datasets/r/ddfea6a0-df7e-4402-99fc-165f573f2e10"</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">2019</span><span class="kw">:</span><span class="at"> </span><span class="st">"https://www.data.gouv.fr/fr/datasets/r/8421e029-c8c7-410d-b38c-54455ac3265d"</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">2020</span><span class="kw">:</span><span class="at"> </span><span class="st">"https://www.data.gouv.fr/fr/datasets/r/818eec10-6122-4788-8233-482e779ab837"</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">2021</span><span class="kw">:</span><span class="at"> </span><span class="st">"https://www.data.gouv.fr/fr/datasets/r/0b954774-ccd1-43ec-9b5a-f958fba03e87"</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">2022</span><span class="kw">:</span><span class="at"> </span><span class="st">"https://www.data.gouv.fr/fr/datasets/r/bcec3e1e-940a-4772-bc28-0d7b2b53c718"</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a><span class="fu">geojson</span><span class="kw">:</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">airport</span><span class="kw">:</span><span class="at"> </span><span class="st">"https://minio.lab.sspcloud.fr/projet-funathon/2024/sujet2/aeroports.geojson"</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
</section>
<section id="importer-la-liste-des-sources-disponibles" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="importer-la-liste-des-sources-disponibles"><span class="header-section-number">3.3</span> Importer la liste des sources disponibles</h2>
<p>Les consignes de cet exercice sont quasiment identiques selon le langage car les librairies <code>R</code> et <code>Python</code> pour lire des fichiers YAML portent le mÃªme nom.</p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<i class="bi bi-book"></i> Exercice 1: lire les sources dans <i class="fa-brands fa-r-project" aria-label="r-project"></i> et <i class="fa-brands fa-python" aria-label="python"></i>
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<ol type="1">
<li><p>Le package <code>R</code> <code>yaml</code> comporte une fonction <code>read_yaml</code> pour transformer un fichier <code>YAML</code> en liste imbriquÃ©e; le package Python <code>yaml</code> comporte une fonction <code>safe_load</code> qui fait la mÃªme chose. Tester cette fonction sur le fichier <code>sources.yml</code>.</p></li>
<li><p>Transformer ce bout de code en une fonction <code>create_data_list</code> prenant un argument <code>source_file</code> et renvoyant cette liste.</p></li>
<li><p>CrÃ©er <strong>Ã  la racine du projet</strong> un dossier <code>R/</code> (<i class="fa-brands fa-r-project" aria-label="r-project"></i>) ou <code>src/</code> (<i class="fa-brands fa-python" aria-label="python"></i>). Attention, ne confondez pas avec le dossier <code>correction/R/</code> ou <code>correction/src/</code> qui contient la correctionâ€¦</p></li>
<li><p>Dans ce nouveau dossier, crÃ©ez un script nommÃ© <code>create_data_list.R</code> (<i class="fa-brands fa-r-project" aria-label="r-project"></i>) ou <code>create_data_list.py</code> (<i class="fa-brands fa-python" aria-label="python"></i>) et reportez-y la fonction que vous avez crÃ©Ã©e. Dans le cas de Python, ce fichier doit commencer par <code>import yaml</code>, car ce package est utilisÃ© dans la fonction.</p></li>
</ol>
</div>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-7-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-1" role="tab" aria-controls="tabset-7-1" aria-selected="true"><i class="fa-brands fa-r-project" aria-label="r-project"></i></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-2" role="tab" aria-controls="tabset-7-2" aria-selected="false"><i class="fa-brands fa-python" aria-label="python"></i></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-7-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-7-1-tab">
<details>
<summary>
Voir la solution Ã  cet exercice
</summary>
<div class="sourceCode" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Creates a 2-levels list of urls, pointing to open source data</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co">#' </span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param source_file yaml file containing data urls </span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return list (level 1 = concepts, level 2 = year).</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co">#' @examples</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co">#'  create_data_list("sources.yml")</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co">#'  </span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>create_data_list <span class="op">&lt;-</span> function(source_file){</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  catalogue <span class="op">&lt;-</span> yaml::read_yaml(source_file)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span>(catalogue)</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<p>La fonction-solution de cet exercice est dans le fichier <code>correction/R/create_data_list.R</code>. Elle peut Ãªtre importÃ©e dans lâ€™environnement global grÃ¢ce Ã  la commande:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"correction/R/create_data_list.R"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-7-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-2-tab">
<details>
<summary>
Voir la solution Ã  cet exercice
</summary>
<div class="sourceCode" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> yaml</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_data_list(source_file):</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Reads a YAML file and returns the contents as a dictionary.</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co">        source_file (str): The path to the YAML file.</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="co">        dict: The contents of the YAML file.</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(source_file, <span class="st">'r'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>        catalogue <span class="op">=</span> yaml.safe_load(<span class="bu">file</span>)</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> catalogue</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<p>La fonction-solution de cet exercice est dans le fichier <code>correction/src/create_data_list.py</code>.</p>
<p>Une fois que vous avez crÃ©Ã© et rempli le fichier <code>src/create_data_list.py</code>, vous pouvez importer la fonction <code>create_data_list</code> dans lâ€™environnement global grÃ¢ce Ã  la commande:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> src.create_data_list <span class="im">import</span> create_data_list</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>Cet exemple simple vous montre ce que sera lâ€™organisation finale de lâ€™application: lâ€™application web qui sera construite plus tard dans les fichiers <code>server.R</code> et <code>ui.R</code> (<i class="fa-brands fa-r-project" aria-label="r-project"></i>) ou <code>app.py</code> (<i class="fa-brands fa-python" aria-label="python"></i>) pourra facilement appeler des fonctions utilitaires stockÃ©es dans <code>R/</code> ou dans <code>src/</code>. Cette organisation est trÃ¨s pratique car elle sÃ©pare lâ€™application web <em>stricto sensu</em> des fonctions gÃ©nÃ©riques de manipulation de donnÃ©es et contribue Ã  rendre les codes faciles Ã  comprendre et Ã  maintenir.</p>
</section>
<section id="importer-les-premiÃ¨res-bases" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="importer-les-premiÃ¨res-bases"><span class="header-section-number">3.4</span> Importer les premiÃ¨res bases</h2>
<p>Nous pouvons maintenant utiliser cette fonction pour lister tous nos URL des sources.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-8-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-1" role="tab" aria-controls="tabset-8-1" aria-selected="true"><i class="fa-brands fa-r-project" aria-label="r-project"></i></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-2" role="tab" aria-controls="tabset-8-2" aria-selected="false"><i class="fa-brands fa-python" aria-label="python"></i></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-8-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-8-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>urls <span class="ot">&lt;-</span> <span class="fu">create_data_list</span>(<span class="st">"sources.yml"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-8-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-2-tab">
<div class="sourceCode" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>urls <span class="op">=</span> create_data_list(<span class="st">"sources.yml"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-9-contents" aria-controls="callout-9" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<i class="bi bi-book"></i> Exercice 2: dÃ©couvrir les diffÃ©rentes sources
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-9" class="callout-9-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Dans cet exercice, vous allez dÃ©couvrir les sources utilisÃ©es dans le tutoriel et dÃ©velopper des fonctions gÃ©nÃ©riques de traitement de donnÃ©es qui seront ensuite utilisÃ©es par lâ€™application web.</p>
<section id="donnÃ©es-aÃ©roports" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="donnÃ©es-aÃ©roports">DonnÃ©es aÃ©roports</h4>
<ul>
<li>Les donnÃ©es sont des CSV europÃ©ens (avec le sÃ©parateur <code>;</code>). Il est donc conseillÃ© dâ€™utiliser la fonction <code>read_csv2</code> du package <code>readr</code> pour lire les donnÃ©es Ã  partir de la liste de fichiers <code>unlist(urls$airports)</code><a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a> si vous utilisez <i class="fa-brands fa-r-project" aria-label="r-project"></i>, et dâ€™utiliser la fonction <code>read_csv</code> du package <code>pandas</code> pour lire les donnÃ©es Ã  partir de la liste de fichiers <code>list(urls['airports'].values())</code> si vous utilisez <i class="fa-brands fa-python" aria-label="python"></i>.</li>
<li>Il est recommandÃ© de ne pas laisser les types par dÃ©faut des colonnes mais de figer ceux-ci avec lâ€™argument suivant:</li>
</ul>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-9-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-1" role="tab" aria-controls="tabset-9-1" aria-selected="true"><i class="fa-brands fa-r-project" aria-label="r-project"></i></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-2" role="tab" aria-controls="tabset-9-2" aria-selected="false"><i class="fa-brands fa-python" aria-label="python"></i></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-9-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-9-1-tab">
<div class="sourceCode" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>col_types <span class="ot">=</span> <span class="fu">cols</span>(</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">ANMOIS =</span> <span class="fu">col_character</span>(),</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">APT =</span> <span class="fu">col_character</span>(),</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">APT_NOM =</span> <span class="fu">col_character</span>(),</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">APT_ZON =</span> <span class="fu">col_character</span>(),</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">.default =</span> <span class="fu">col_double</span>()</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-9-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-2-tab">
<div class="sourceCode" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>dtype <span class="op">=</span> {</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ANMOIS"</span>: <span class="st">"str"</span>,  </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"APT"</span>: <span class="st">"str"</span>,     </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"APT_NOM"</span>: <span class="st">"str"</span>, </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"APT_ZON"</span>: <span class="st">"str"</span>,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<ul>
<li>A partir de la variable <code>ANMOIS</code>, crÃ©er les variables <code>an</code> et <code>mois</code>. Penser Ã  enlever les 0 des mois de janvier Ã  septembre.</li>
</ul>
<details>
<summary>
Aide si vous Ãªtes bloquÃ© sur cette question
</summary>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-10-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-1" role="tab" aria-controls="tabset-10-1" aria-selected="true"><i class="fa-brands fa-r-project" aria-label="r-project"></i></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-2" role="tab" aria-controls="tabset-10-2" aria-selected="false"><i class="fa-brands fa-python" aria-label="python"></i></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-10-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-10-1-tab">
<p>Pour extraire des Ã©lÃ©ments dâ€™une chaine de caractÃ¨re Ã  partir de la position, il est recommandÃ© dâ€™utiliser la fonction <code>str_sub</code> du package <code>stringr</code>. Pour crÃ©er de nouvelles colonnes, il est recommandÃ© dâ€™utiliser la fonction <code>mutate</code> du package dplyr.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Conseil pour se faciliter la vie ultÃ©rieurement
</div>
</div>
<div class="callout-body-container callout-body">
<p>Il est recommandÃ© dâ€™utiliser <code>str_remove</code> pour retirer les zÃ©ros en dÃ©but de mois qui pourront nous crÃ©er des difficultÃ©s ultÃ©rieurement.</p>
</div>
</div>
<p>Si vous Ãªtes toujours bloquÃ©, la solution est donnÃ©e plus bas ğŸ‘‡</p>
</div>
<div id="tabset-10-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-2-tab">
<p>Vous pouvez utiliser les mÃ©thodes de donnÃ©es textuelles <code>str.sub</code> et <code>str.replace</code> de <code>Pandas</code>.</p>
</div>
</div>
</div>
</details>
<ul>
<li>CrÃ©er une fonction <code>clean_dataframe</code> qui prend en entrÃ©e un dataframe, crÃ©e les variables <code>an</code> et <code>mois</code>, ajoute une Ã©tape de passage des noms de colonne en minuscule et renvoie le dataframe en sortie.</li>
</ul>
<details>
<summary>
Solution
</summary>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-11-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-1" role="tab" aria-controls="tabset-11-1" aria-selected="true"><i class="fa-brands fa-r-project" aria-label="r-project"></i></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-11-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-2" role="tab" aria-controls="tabset-11-2" aria-selected="false"><i class="fa-brands fa-python" aria-label="python"></i></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-11-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-11-1-tab">
<div class="sourceCode" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>clean_dataframe <span class="ot">&lt;-</span> <span class="cf">function</span>(df){</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create an et mois columns</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">an =</span> <span class="fu">str_sub</span>(ANMOIS,<span class="dv">1</span>,<span class="dv">4</span>),</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">mois =</span> <span class="fu">str_sub</span>(ANMOIS,<span class="dv">5</span>,<span class="dv">6</span>)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">mois =</span> <span class="fu">str_remove</span>(mois, <span class="st">"^0+"</span>)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># lower case for variable names</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(df) <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">colnames</span>(df))</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-11-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-11-2-tab">
<div class="sourceCode" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> clean_dataframe(df):</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create 'an' and 'mois' columns</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'an'</span>] <span class="op">=</span> df[<span class="st">'ANMOIS'</span>].astype(<span class="bu">str</span>).<span class="bu">str</span>[:<span class="dv">4</span>]</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'mois'</span>] <span class="op">=</span> df[<span class="st">'ANMOIS'</span>].astype(<span class="bu">str</span>).<span class="bu">str</span>[<span class="op">-</span><span class="dv">2</span>:]</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove leading zeros from 'mois' column</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'mois'</span>] <span class="op">=</span> df[<span class="st">'mois'</span>].<span class="bu">str</span>.replace(<span class="vs">r'^0+'</span>, <span class="st">''</span>, regex<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert all column names to lowercase</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    df.columns <span class="op">=</span> df.columns.<span class="bu">str</span>.lower()</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</details>
<ul>
<li>CrÃ©er une fonction <code>import_airport_data</code> qui prend en <em>input</em> <code>list_files</code> et intÃ¨gre les deux Ã©tapes prÃ©cÃ©dentes: la lecture des donnÃ©es, le nettoyage avec <code>clean_dataframe</code>. Dans le cas de Python, ne pas oublier de concatÃ©ner les diffÃ©rentes tables avec <code>pd.concat</code>.</li>
</ul>
<details>
<summary>
Solution
</summary>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-12-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-1" role="tab" aria-controls="tabset-12-1" aria-selected="true"><i class="fa-brands fa-r-project" aria-label="r-project"></i></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-12-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-2" role="tab" aria-controls="tabset-12-2" aria-selected="false"><i class="fa-brands fa-python" aria-label="python"></i></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-12-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-12-1-tab">
<div class="sourceCode" id="cb25" data-startfrom="1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>import_airport_data <span class="ot">&lt;-</span> <span class="cf">function</span>(list_files){</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  pax_apt_all <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv2</span>(</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    list_files, </span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">col_types =</span> <span class="fu">cols</span>(</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">ANMOIS =</span> <span class="fu">col_character</span>(),</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">APT =</span> <span class="fu">col_character</span>(),</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">APT_NOM =</span> <span class="fu">col_character</span>(),</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">APT_ZON =</span> <span class="fu">col_character</span>(),</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">.default =</span> <span class="fu">col_double</span>()</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">clean_dataframe</span>()</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(pax_apt_all)</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Reporter cette fonction dans un fichier <code>R/clean_dataframe.R</code> et faire</li>
</ul>
<div class="sourceCode" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"R/clean_dataframe.R"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-12-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-12-2-tab">
<div class="sourceCode" id="cb27" data-startfrom="1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> .clean_dataframe <span class="im">import</span> clean_dataframe</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> import_airport_data(list_files):</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define the data types for each column</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    col_types <span class="op">=</span> {</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"ANMOIS"</span>: <span class="st">"str"</span>,</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"APT"</span>: <span class="st">"str"</span>,     <span class="co"># equivalent to col_character()</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">"APT_NOM"</span>: <span class="st">"str"</span>, <span class="co"># equivalent to col_character()</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">"APT_ZON"</span>: <span class="st">"str"</span>, <span class="co"># equivalent to col_character()</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Read the CSV file(s) with the specified column types</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>    pax_apt_all <span class="op">=</span> pd.concat([</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>        pd.read_csv(<span class="bu">file</span>, delimiter <span class="op">=</span> <span class="st">';'</span>, dtype <span class="op">=</span> col_types)</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> list_files</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>        ])</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Clean the DataFrame (assuming clean_dataframe is a predefined function)</span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>    pax_apt_all <span class="op">=</span> clean_dataframe(pax_apt_all)</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pax_apt_all</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Reporter cette fonction dans un fichier <code>src/clean_dataframe.py</code> et faire</li>
</ul>
<div class="sourceCode" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> src.clean_dataframe <span class="im">import</span> clean_dataframe</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</details>
</section>
<section id="donnÃ©es-compagnies" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="donnÃ©es-compagnies">DonnÃ©es compagnies</h4>
<p>Sur le mÃªme principe, crÃ©er une fonction <code>import_compagnies_data</code> qui effectue la mÃªme suite dâ€™opÃ©rations. Faire nÃ©anmoins attention aux types des colonnes.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-13-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-1" role="tab" aria-controls="tabset-13-1" aria-selected="true"><i class="fa-brands fa-r-project" aria-label="r-project"></i></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-13-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-2" role="tab" aria-controls="tabset-13-2" aria-selected="false"><i class="fa-brands fa-python" aria-label="python"></i></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-13-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-13-1-tab">
<div class="cell">
<details>
<summary>Recommandation de paramÃ¨tre pour read_csv2 pour lâ€™import de ces fichiers</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>col_types <span class="ot">=</span> <span class="fu">cols</span>(</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">ANMOIS =</span> <span class="fu">col_character</span>(),</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">CIE =</span> <span class="fu">col_character</span>(),</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">CIE_NOM =</span> <span class="fu">col_character</span>(),</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">CIE_NAT =</span> <span class="fu">col_character</span>(),</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">CIE_PAYS =</span> <span class="fu">col_character</span>(),</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">.default =</span> <span class="fu">col_double</span>()</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<details>
<summary>
Solution
</summary>
<div class="sourceCode" id="cb30" data-startfrom="20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r" style="counter-reset: source-line 19;"><span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>import_compagnies_data <span class="ot">&lt;-</span> <span class="cf">function</span>(list_files){</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>  pax_cie_all <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv2</span>(</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">file =</span> list_files,</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">col_types =</span> <span class="fu">cols</span>(</span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">ANMOIS =</span> <span class="fu">col_character</span>(),</span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">CIE =</span> <span class="fu">col_character</span>(),</span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">CIE_NOM =</span> <span class="fu">col_character</span>(),</span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">CIE_NAT =</span> <span class="fu">col_character</span>(),</span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">CIE_PAYS =</span> <span class="fu">col_character</span>(),</span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">.default =</span> <span class="fu">col_double</span>()</span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">clean_dataframe</span>()</span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(pax_cie_all)</span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="tabset-13-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-13-2-tab">
<p>Recommandation de paramÃ¨tre pour read_csv pour lâ€™import de ces fichiers</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>col_types <span class="op">=</span> {</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  ANMOIS <span class="op">=</span> <span class="st">"str"</span>,</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  CIE <span class="op">=</span> <span class="st">"str"</span>,</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  CIE_NOM <span class="op">=</span> <span class="st">"str"</span>,</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  CIE_NAT <span class="op">=</span> <span class="st">"str"</span>,</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  CIE_PAYS <span class="op">=</span> <span class="st">"str"</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<details>
<summary>
Solution
</summary>
<div class="sourceCode" id="cb32" data-startfrom="26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python" style="counter-reset: source-line 25;"><span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> import_compagnies_data(list_files):</span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define the data types for each column</span></span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>    col_types <span class="op">=</span> {</span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>        <span class="st">"ANMOIS"</span>: <span class="st">"str"</span>,</span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a>        <span class="st">"CIE"</span>: <span class="st">"str"</span>,</span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>        <span class="st">"CIE_NOM"</span>: <span class="st">"str"</span>,</span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a>        <span class="st">"CIE_NAT"</span>: <span class="st">"str"</span>,</span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a>        <span class="st">"CIE_PAYS"</span>: <span class="st">"str"</span></span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Read the CSV file(s) with the specified column types</span></span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a>    pax_cie_all <span class="op">=</span> pd.concat([</span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a>        pd.read_csv(<span class="bu">file</span>, delimiter <span class="op">=</span> <span class="st">';'</span>, dtype <span class="op">=</span> col_types)</span>
<span id="cb32-39"><a href="#cb32-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> list_files</span>
<span id="cb32-40"><a href="#cb32-40" aria-hidden="true" tabindex="-1"></a>        ])</span>
<span id="cb32-41"><a href="#cb32-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-42"><a href="#cb32-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Clean the DataFrame (assuming clean_dataframe is a predefined function)</span></span>
<span id="cb32-43"><a href="#cb32-43" aria-hidden="true" tabindex="-1"></a>    pax_cie_all <span class="op">=</span> clean_dataframe(pax_cie_all)</span>
<span id="cb32-44"><a href="#cb32-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-45"><a href="#cb32-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-46"><a href="#cb32-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pax_cie_all</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</section>
<section id="donnÃ©es-liaisons" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="donnÃ©es-liaisons">DonnÃ©es liaisons</h4>
<p>Sur le mÃªme principe, crÃ©er une fonction <code>import_liaisons_data</code> qui effectue la mÃªme suite dâ€™opÃ©rations. Faire nÃ©anmoins attention aux types des colonnes.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-14-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-1" role="tab" aria-controls="tabset-14-1" aria-selected="true"><i class="fa-brands fa-r-project" aria-label="r-project"></i></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-14-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-2" role="tab" aria-controls="tabset-14-2" aria-selected="false"><i class="fa-brands fa-python" aria-label="python"></i></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-14-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-14-1-tab">
<div class="cell">
<details>
<summary>Recommandation de paramÃ¨tre pour read_csv pour lâ€™import de ces fichiers</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>col_types <span class="ot">=</span> <span class="fu">cols</span>(</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">ANMOIS =</span> <span class="fu">col_character</span>(),</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">LSN =</span> <span class="fu">col_character</span>(),</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">LSN_DEP_NOM =</span> <span class="fu">col_character</span>(),</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">LSN_ARR_NOM =</span> <span class="fu">col_character</span>(),</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">LSN_SCT =</span> <span class="fu">col_character</span>(),</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">LSN_FSC =</span> <span class="fu">col_character</span>(),</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">.default =</span> <span class="fu">col_double</span>()</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<details>
<summary>
Solution
</summary>
<div class="sourceCode" id="cb34" data-startfrom="41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r" style="counter-reset: source-line 40;"><span id="cb34-41"><a href="#cb34-41" aria-hidden="true" tabindex="-1"></a>import_liaisons_data <span class="ot">&lt;-</span> <span class="cf">function</span>(list_files){</span>
<span id="cb34-42"><a href="#cb34-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-43"><a href="#cb34-43" aria-hidden="true" tabindex="-1"></a>  pax_lsn_all <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv2</span>(</span>
<span id="cb34-44"><a href="#cb34-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">file =</span> list_files,</span>
<span id="cb34-45"><a href="#cb34-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">col_types =</span> <span class="fu">cols</span>(</span>
<span id="cb34-46"><a href="#cb34-46" aria-hidden="true" tabindex="-1"></a>      <span class="at">ANMOIS =</span> <span class="fu">col_character</span>(),</span>
<span id="cb34-47"><a href="#cb34-47" aria-hidden="true" tabindex="-1"></a>      <span class="at">LSN =</span> <span class="fu">col_character</span>(),</span>
<span id="cb34-48"><a href="#cb34-48" aria-hidden="true" tabindex="-1"></a>      <span class="at">LSN_DEP_NOM =</span> <span class="fu">col_character</span>(),</span>
<span id="cb34-49"><a href="#cb34-49" aria-hidden="true" tabindex="-1"></a>      <span class="at">LSN_ARR_NOM =</span> <span class="fu">col_character</span>(),</span>
<span id="cb34-50"><a href="#cb34-50" aria-hidden="true" tabindex="-1"></a>      <span class="at">LSN_SCT =</span> <span class="fu">col_character</span>(),</span>
<span id="cb34-51"><a href="#cb34-51" aria-hidden="true" tabindex="-1"></a>      <span class="at">LSN_FSC =</span> <span class="fu">col_character</span>(),</span>
<span id="cb34-52"><a href="#cb34-52" aria-hidden="true" tabindex="-1"></a>      <span class="at">.default =</span> <span class="fu">col_double</span>()</span>
<span id="cb34-53"><a href="#cb34-53" aria-hidden="true" tabindex="-1"></a>    ) </span>
<span id="cb34-54"><a href="#cb34-54" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb34-55"><a href="#cb34-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">clean_dataframe</span>()</span>
<span id="cb34-56"><a href="#cb34-56" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-57"><a href="#cb34-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(pax_lsn_all)</span>
<span id="cb34-58"><a href="#cb34-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-59"><a href="#cb34-59" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-60"><a href="#cb34-60" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="tabset-14-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-14-2-tab">
<p>Conseil pour les colonnes:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>col_types <span class="op">=</span> {</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ANMOIS"</span>: <span class="st">"str"</span>,</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"LSN"</span>: <span class="st">"str"</span>,</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"LSN_DEP_NOM"</span>: <span class="st">"str"</span>,</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"LSN_ARR_NOM"</span>: <span class="st">"str"</span>,</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"LSN_SCT"</span>: <span class="st">"str"</span>,</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"LSN_FSC"</span>: <span class="st">"str"</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<details>
<summary>
Solution
</summary>
<div class="sourceCode" id="cb36" data-startfrom="49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python" style="counter-reset: source-line 48;"><span id="cb36-49"><a href="#cb36-49" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> import_liaisons_data(list_files):</span>
<span id="cb36-50"><a href="#cb36-50" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define the data types for each column</span></span>
<span id="cb36-51"><a href="#cb36-51" aria-hidden="true" tabindex="-1"></a>    col_types <span class="op">=</span> {</span>
<span id="cb36-52"><a href="#cb36-52" aria-hidden="true" tabindex="-1"></a>        <span class="st">"ANMOIS"</span>: <span class="st">"str"</span>,</span>
<span id="cb36-53"><a href="#cb36-53" aria-hidden="true" tabindex="-1"></a>        <span class="st">"LSN"</span>: <span class="st">"str"</span>,</span>
<span id="cb36-54"><a href="#cb36-54" aria-hidden="true" tabindex="-1"></a>        <span class="st">"LSN_DEP_NOM"</span>: <span class="st">"str"</span>,</span>
<span id="cb36-55"><a href="#cb36-55" aria-hidden="true" tabindex="-1"></a>        <span class="st">"LSN_ARR_NOM"</span>: <span class="st">"str"</span>,</span>
<span id="cb36-56"><a href="#cb36-56" aria-hidden="true" tabindex="-1"></a>        <span class="st">"LSN_SCT"</span>: <span class="st">"str"</span>,</span>
<span id="cb36-57"><a href="#cb36-57" aria-hidden="true" tabindex="-1"></a>        <span class="st">"LSN_FSC"</span>: <span class="st">"str"</span></span>
<span id="cb36-58"><a href="#cb36-58" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb36-59"><a href="#cb36-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-60"><a href="#cb36-60" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Read the CSV file(s) with the specified column types</span></span>
<span id="cb36-61"><a href="#cb36-61" aria-hidden="true" tabindex="-1"></a>    pax_lsn_all <span class="op">=</span> pd.concat([</span>
<span id="cb36-62"><a href="#cb36-62" aria-hidden="true" tabindex="-1"></a>        pd.read_csv(<span class="bu">file</span>, delimiter <span class="op">=</span> <span class="st">';'</span>, dtype <span class="op">=</span> col_types)</span>
<span id="cb36-63"><a href="#cb36-63" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> list_files</span>
<span id="cb36-64"><a href="#cb36-64" aria-hidden="true" tabindex="-1"></a>        ])</span>
<span id="cb36-65"><a href="#cb36-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-66"><a href="#cb36-66" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Clean the DataFrame</span></span>
<span id="cb36-67"><a href="#cb36-67" aria-hidden="true" tabindex="-1"></a>    pax_lsn_all <span class="op">=</span> clean_dataframe(pax_lsn_all)</span>
<span id="cb36-68"><a href="#cb36-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-69"><a href="#cb36-69" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pax_lsn_all</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</section>
<section id="construction-de-fichiers-de-fonctions" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="construction-de-fichiers-de-fonctions">Construction de fichiers de fonctions</h4>
<ol type="1">
<li><p>Reporter la fonction <code>clean_dataframe</code> dans un fichier <code>R/clean_dataframe.R</code> (<i class="fa-brands fa-r-project" aria-label="r-project"></i>) ou <code>topinambour/clean_dataframe.py</code> (<i class="fa-brands fa-python" aria-label="python"></i>).</p></li>
<li><p>Reporter les fonctions <code>import_airport_data</code>, <code>import_compagnies_data</code> et <code>import_liaisons_data</code> dans un fichier <code>R/import_data.R</code> (<i class="fa-brands fa-r-project" aria-label="r-project"></i>) ou <code>scr/import_data.py</code> (<i class="fa-brands fa-python" aria-label="python"></i>). Dans le cas de Python, le fichier devra commencer par ceci:</p></li>
</ol>
<pre><code>import pandas as pd
from .clean_dataframe import clean_dataframe</code></pre>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-15-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-1" role="tab" aria-controls="tabset-15-1" aria-selected="true"><i class="fa-brands fa-r-project" aria-label="r-project"></i></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-15-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-15-2" role="tab" aria-controls="tabset-15-2" aria-selected="false"><i class="fa-brands fa-python" aria-label="python"></i></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-15-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-15-1-tab">
<p>A lâ€™issue de cette partie, vous devriez avoir le fichier <code>R/import_data.R</code> suivant</p>
<details>
<summary>
Le fichier <code>R/import_data.R</code> attendu
</summary>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R/import_data.R</strong></pre>
</div>
<div class="sourceCode" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>import_airport_data <span class="ot">&lt;-</span> <span class="cf">function</span>(list_files){</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  pax_apt_all <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv2</span>(</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    list_files, </span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">col_types =</span> <span class="fu">cols</span>(</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">ANMOIS =</span> <span class="fu">col_character</span>(),</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">APT =</span> <span class="fu">col_character</span>(),</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">APT_NOM =</span> <span class="fu">col_character</span>(),</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">APT_ZON =</span> <span class="fu">col_character</span>(),</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">.default =</span> <span class="fu">col_double</span>()</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">clean_dataframe</span>()</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(pax_apt_all)</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>import_compagnies_data <span class="ot">&lt;-</span> <span class="cf">function</span>(list_files){</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>  pax_cie_all <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv2</span>(</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">file =</span> list_files,</span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">col_types =</span> <span class="fu">cols</span>(</span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">ANMOIS =</span> <span class="fu">col_character</span>(),</span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">CIE =</span> <span class="fu">col_character</span>(),</span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">CIE_NOM =</span> <span class="fu">col_character</span>(),</span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">CIE_NAT =</span> <span class="fu">col_character</span>(),</span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">CIE_PAYS =</span> <span class="fu">col_character</span>(),</span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">.default =</span> <span class="fu">col_double</span>()</span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">clean_dataframe</span>()</span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(pax_cie_all)</span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-37"><a href="#cb38-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-38"><a href="#cb38-38" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-39"><a href="#cb38-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-40"><a href="#cb38-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-41"><a href="#cb38-41" aria-hidden="true" tabindex="-1"></a>import_liaisons_data <span class="ot">&lt;-</span> <span class="cf">function</span>(list_files){</span>
<span id="cb38-42"><a href="#cb38-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-43"><a href="#cb38-43" aria-hidden="true" tabindex="-1"></a>  pax_lsn_all <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv2</span>(</span>
<span id="cb38-44"><a href="#cb38-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">file =</span> list_files,</span>
<span id="cb38-45"><a href="#cb38-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">col_types =</span> <span class="fu">cols</span>(</span>
<span id="cb38-46"><a href="#cb38-46" aria-hidden="true" tabindex="-1"></a>      <span class="at">ANMOIS =</span> <span class="fu">col_character</span>(),</span>
<span id="cb38-47"><a href="#cb38-47" aria-hidden="true" tabindex="-1"></a>      <span class="at">LSN =</span> <span class="fu">col_character</span>(),</span>
<span id="cb38-48"><a href="#cb38-48" aria-hidden="true" tabindex="-1"></a>      <span class="at">LSN_DEP_NOM =</span> <span class="fu">col_character</span>(),</span>
<span id="cb38-49"><a href="#cb38-49" aria-hidden="true" tabindex="-1"></a>      <span class="at">LSN_ARR_NOM =</span> <span class="fu">col_character</span>(),</span>
<span id="cb38-50"><a href="#cb38-50" aria-hidden="true" tabindex="-1"></a>      <span class="at">LSN_SCT =</span> <span class="fu">col_character</span>(),</span>
<span id="cb38-51"><a href="#cb38-51" aria-hidden="true" tabindex="-1"></a>      <span class="at">LSN_FSC =</span> <span class="fu">col_character</span>(),</span>
<span id="cb38-52"><a href="#cb38-52" aria-hidden="true" tabindex="-1"></a>      <span class="at">.default =</span> <span class="fu">col_double</span>()</span>
<span id="cb38-53"><a href="#cb38-53" aria-hidden="true" tabindex="-1"></a>    ) </span>
<span id="cb38-54"><a href="#cb38-54" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb38-55"><a href="#cb38-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">clean_dataframe</span>()</span>
<span id="cb38-56"><a href="#cb38-56" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-57"><a href="#cb38-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(pax_lsn_all)</span>
<span id="cb38-58"><a href="#cb38-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-59"><a href="#cb38-59" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-60"><a href="#cb38-60" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
</div>
<div id="tabset-15-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-15-2-tab">
<p>A lâ€™issue de cette partie, vous devriez avoir le fichier <code>src/import_data.py</code> suivant</p>
<details>
<summary>
Le fichier <code>src/import_data.py</code> attendu
</summary>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>src/import_data.py</strong></pre>
</div>
<div class="sourceCode" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> .clean_dataframe <span class="im">import</span> clean_dataframe</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> import_airport_data(list_files):</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define the data types for each column</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    col_types <span class="op">=</span> {</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"ANMOIS"</span>: <span class="st">"str"</span>,</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"APT"</span>: <span class="st">"str"</span>,     <span class="co"># equivalent to col_character()</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">"APT_NOM"</span>: <span class="st">"str"</span>, <span class="co"># equivalent to col_character()</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">"APT_ZON"</span>: <span class="st">"str"</span>, <span class="co"># equivalent to col_character()</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Read the CSV file(s) with the specified column types</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>    pax_apt_all <span class="op">=</span> pd.concat([</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>        pd.read_csv(<span class="bu">file</span>, delimiter <span class="op">=</span> <span class="st">';'</span>, dtype <span class="op">=</span> col_types)</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> list_files</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>        ])</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Clean the DataFrame (assuming clean_dataframe is a predefined function)</span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>    pax_apt_all <span class="op">=</span> clean_dataframe(pax_apt_all)</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pax_apt_all</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> import_compagnies_data(list_files):</span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define the data types for each column</span></span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>    col_types <span class="op">=</span> {</span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>        <span class="st">"ANMOIS"</span>: <span class="st">"str"</span>,</span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a>        <span class="st">"CIE"</span>: <span class="st">"str"</span>,</span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a>        <span class="st">"CIE_NOM"</span>: <span class="st">"str"</span>,</span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a>        <span class="st">"CIE_NAT"</span>: <span class="st">"str"</span>,</span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a>        <span class="st">"CIE_PAYS"</span>: <span class="st">"str"</span></span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Read the CSV file(s) with the specified column types</span></span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a>    pax_cie_all <span class="op">=</span> pd.concat([</span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a>        pd.read_csv(<span class="bu">file</span>, delimiter <span class="op">=</span> <span class="st">';'</span>, dtype <span class="op">=</span> col_types)</span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> list_files</span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a>        ])</span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Clean the DataFrame (assuming clean_dataframe is a predefined function)</span></span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true" tabindex="-1"></a>    pax_cie_all <span class="op">=</span> clean_dataframe(pax_cie_all)</span>
<span id="cb39-44"><a href="#cb39-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-45"><a href="#cb39-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-46"><a href="#cb39-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pax_cie_all</span>
<span id="cb39-47"><a href="#cb39-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-48"><a href="#cb39-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-49"><a href="#cb39-49" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> import_liaisons_data(list_files):</span>
<span id="cb39-50"><a href="#cb39-50" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define the data types for each column</span></span>
<span id="cb39-51"><a href="#cb39-51" aria-hidden="true" tabindex="-1"></a>    col_types <span class="op">=</span> {</span>
<span id="cb39-52"><a href="#cb39-52" aria-hidden="true" tabindex="-1"></a>        <span class="st">"ANMOIS"</span>: <span class="st">"str"</span>,</span>
<span id="cb39-53"><a href="#cb39-53" aria-hidden="true" tabindex="-1"></a>        <span class="st">"LSN"</span>: <span class="st">"str"</span>,</span>
<span id="cb39-54"><a href="#cb39-54" aria-hidden="true" tabindex="-1"></a>        <span class="st">"LSN_DEP_NOM"</span>: <span class="st">"str"</span>,</span>
<span id="cb39-55"><a href="#cb39-55" aria-hidden="true" tabindex="-1"></a>        <span class="st">"LSN_ARR_NOM"</span>: <span class="st">"str"</span>,</span>
<span id="cb39-56"><a href="#cb39-56" aria-hidden="true" tabindex="-1"></a>        <span class="st">"LSN_SCT"</span>: <span class="st">"str"</span>,</span>
<span id="cb39-57"><a href="#cb39-57" aria-hidden="true" tabindex="-1"></a>        <span class="st">"LSN_FSC"</span>: <span class="st">"str"</span></span>
<span id="cb39-58"><a href="#cb39-58" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb39-59"><a href="#cb39-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-60"><a href="#cb39-60" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Read the CSV file(s) with the specified column types</span></span>
<span id="cb39-61"><a href="#cb39-61" aria-hidden="true" tabindex="-1"></a>    pax_lsn_all <span class="op">=</span> pd.concat([</span>
<span id="cb39-62"><a href="#cb39-62" aria-hidden="true" tabindex="-1"></a>        pd.read_csv(<span class="bu">file</span>, delimiter <span class="op">=</span> <span class="st">';'</span>, dtype <span class="op">=</span> col_types)</span>
<span id="cb39-63"><a href="#cb39-63" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> list_files</span>
<span id="cb39-64"><a href="#cb39-64" aria-hidden="true" tabindex="-1"></a>        ])</span>
<span id="cb39-65"><a href="#cb39-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-66"><a href="#cb39-66" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Clean the DataFrame</span></span>
<span id="cb39-67"><a href="#cb39-67" aria-hidden="true" tabindex="-1"></a>    pax_lsn_all <span class="op">=</span> clean_dataframe(pax_lsn_all)</span>
<span id="cb39-68"><a href="#cb39-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-69"><a href="#cb39-69" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pax_lsn_all</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
</div>
</div>
</div>
</section>
<section id="localisations-des-aÃ©roports" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="localisations-des-aÃ©roports">Localisations des aÃ©roports</h4>
<p>Il sâ€™agit dâ€™un jeu de donnÃ©es spatial. Pour en savoir plus sur ce type de donnÃ©es, il est recommandÃ© de consulter :</p>
<ul>
<li>Pour les utilisateurs de <i class="fa-brands fa-r-project" aria-label="r-project"></i>: la <a href="https://book.utilitr.org/03_Fiches_thematiques/Fiche_donnees_spatiales.html">fiche <code>utilitR</code></a> sur le sujet ou <a href="https://rgeo.linogaliana.fr/exercises/geospatial-wrangling.html">ce cours introductif</a>.</li>
<li>Pour les utilisateurs de <i class="fa-brands fa-python" aria-label="python"></i>: ce chapitre du <a href="https://pythonds.linogaliana.fr/content/manipulation/03_geopandas_intro.html">cours de <code>Python</code> de lâ€™ENSAE</a>.</li>
</ul>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-16-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-16-1" role="tab" aria-controls="tabset-16-1" aria-selected="true"><i class="fa-brands fa-r-project" aria-label="r-project"></i></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-16-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-16-2" role="tab" aria-controls="tabset-16-2" aria-selected="false"><i class="fa-brands fa-python" aria-label="python"></i></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-16-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-16-1-tab">
<ol type="1">
<li>Utiliser la fonction <code>st_read</code> du package <code>sf</code> pour lire ces donnÃ©es (dont la localisation est stockÃ©e dans la variable <code>urls$geojson$airport</code>). Stocker lâ€™objet obtenu sous le nom <code>airports_location</code></li>
</ol>
</div>
<div id="tabset-16-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-16-2-tab">
<ol type="1">
<li>Utiliser la fonction <code>read_file</code> du package <code>geopandas</code> pour lire ces donnÃ©es (dont la localisation est stockÃ©e dans la variable <code>urls['geojson']['airport']</code>). Stocker lâ€™objet obtenu sous le nom <code>airports_location</code></li>
</ol>
</div>
</div>
</div>
<ol start="2" type="1">
<li>VÃ©rifier que les donnÃ©es sont bien dans le systÃ¨me de reprÃ©sentation <code>WGS 84</code><a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a></li>
</ol>
<details>
<summary>
Aide
</summary>
La fonction Ã  utiliser est <code>st_crs</code> <i class="fa-brands fa-r-project" aria-label="r-project"></i> ou lâ€™attribut <code>crs</code> pour <i class="fa-brands fa-python" aria-label="python"></i>
</details>
<ol start="3" type="1">
<li>Il est toujours utile de vÃ©rifier que nos donnÃ©es sont bien localisÃ©es oÃ¹ on les attend. Pour cela, il est pertinent de faire une carte avec un fond de carte contextuel, mÃªme si celle-ci nâ€™est pas trÃ¨s soignÃ©e. Pour faire ceci, le plus simple est dâ€™utiliser la librairie Javascript Leaflet. Lâ€™usage nâ€™est pas exactement le mÃªme en <code>R</code> et en Python:</li>
</ol>
<ul>
<li>la <a href="https://rstudio.github.io/leaflet/articles/markers.html">fonction <code>addMarkers</code></a> du package <code>leaflet</code> (<i class="fa-brands fa-r-project" aria-label="r-project"></i>);</li>
<li>les fonctions <a href="https://python-visualization.github.io/folium/latest/getting_started.html#GeoJSON/TopoJSON-overlays"><code>Map</code> et <code>add_to</code></a> du package <code>folium</code> (<i class="fa-brands fa-python" aria-label="python"></i>).</li>
</ul>
<p>Essayez de faire cette carte vous-mÃªmes ou consultez lâ€™aide ci-dessous</p>
<details>
<summary>
Code pour faire une carte <code>leaflet</code> minimale
</summary>
<div class="sourceCode" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># En R</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">leaflet</span>(airports_location) <span class="sc">%&gt;%</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addTiles</span>() <span class="sc">%&gt;%</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addMarkers</span>(<span class="at">popup =</span> <span class="sc">~</span>Nom)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># En Python</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> folium </span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> folium.Map()</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>folium.GeoJson(airports_location).add_to(m)</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>m</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</section>
</div>
</div>
</div>
<p>La carte <code>leaflet</code> que vous devriez avoir obtenue Ã  la fin de lâ€™exercice est la suivante:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">leaflet</span>(airports_location) <span class="sc">%&gt;%</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addTiles</span>() <span class="sc">%&gt;%</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addMarkers</span>(<span class="at">popup =</span> <span class="sc">~</span>Nom)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="leaflet html-widget html-fill-item" id="htmlwidget-42f7ad7d059e0372a084" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-42f7ad7d059e0372a084">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"https://openstreetmap.org/copyright/\">OpenStreetMap<\/a>,  <a href=\"https://opendatacommons.org/licenses/odbl/\">ODbL<\/a>"}]},{"method":"addMarkers","args":[[-23.37,-22.59,-22.43,-22.26,-22.01,-21.48,-20.89,-20.77,-20.64,-17.55,-17.49,-16.72,-16.69,-16.44,-16.43,-16.05,-15.12,-14.95,-12.81,-9.77,-8.800000000000001,3.66,4.82,14.59,16.27,17.9,18.1,41.5,41.92,42.52,42.55,42.74,43.1,43.19,43.32,43.38,43.44,43.47,43.55,43.56,43.58,43.64,43.67,44.83,44.9,45.04,45.73,45.79,46.76,47.04,47.16,47.31,47.43,47.59,48.07,48.45,48.54,48.72,48.77,48.97,49.01,49.17,49.45,50.56],[-149.52,167.46,-151.36,166.47,166.21,168.04,55.51,167.24,166.57,-149.61,-149.76,-151.47,-151.02,-151.75,-152.24,-145.66,-148.23,-147.66,45.28,-139.01,-140.23,-54.04,-52.36,-61,-61.53,-62.84,-63.05,9.1,8.800000000000001,8.789999999999999,9.48,2.87,6.15,0.01,3.35,-0.42,5.22,-1.53,6.95,2.29,3.96,1.37,7.22,-0.72,2.42,1.49,5.08,3.16,-56.17,5.44,-1.61,-2.16,0.72,7.53,-1.73,-4.42,7.63,2.38,4.21,2.44,2.55,-0.45,2.11,3.09],null,null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},["TUBUAI MATAURA","ILE DES PINS","RURUTU","NOUMEA MAGENTA","NOUMEA LA TONTOUTA","MARE","LA REUNION-ROLAND GARROS","LIFOU","OUVEA","TAHITI FAA'A","MOOREA","RAIATEA","HUAHINE","BORA BORA","MAUPITI","FAKARAVA","TIKEHAU","RANGIROA","MAYOTTE-DZAOUDZI-PAMANDZI","HIVA OA-ATUONA","NUKU HIVA","MARIPASOULA","CAYENNE-FELIX EBOUE","MARTINIQUE-AIME CESAIRE","POINTE-A-PITRE-LE RAIZET","ST-BARTHELEMY","ST-MARTIN-GRAND-CASE","FIGARI-SUD-CORSE","AJACCIO-NAPOLEON-BONAPARTE","CALVI-STE-CATHERINE","BASTIA-PORETTA","PERPIGNAN-RIVESALTES","TOULON-HYERES","TARBES-LOURDES-PYRENEES","BEZIERS-VIAS","PAU-PYRENEES","MARSEILLE-PROVENCE","BIARRITZ-PAYS-BASQUE","CANNES-MANDELIEU","CASTRES-MAZAMET","MONTPELLIER-MEDITERRANEE","TOULOUSE-BLAGNAC","NICE-COTE D'AZUR","BORDEAUX-MERIGNAC","AURILLAC","BRIVE-SOUILLAC","LYON-ST-EXUPERY","CLERMONT-FERRAND-AUVERGNE","ST-PIERRE-POINTE BLANCHE","DOLE-TAVAUX","NANTES-ATLANTIQUE","ST-NAZAIRE-MONTOIR","TOURS-VAL DE LOIRE","BALE-MULHOUSE","RENNES-ST-JACQUES","BREST-BRETAGNE","STRASBOURG-ENTZHEIM","PARIS-ORLY","CHALONS-VATRY","PARIS-LE BOURGET","PARIS-CHARLES DE GAULLE","CAEN-CARPIQUET","BEAUVAIS-TILLE","LILLE-LESQUIN"],null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[-23.37,50.56],"lng":[-152.24,168.04]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-17-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-17-1" role="tab" aria-controls="tabset-17-1" aria-selected="true"><i class="fa-brands fa-r-project" aria-label="r-project"></i></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-17-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-17-2" role="tab" aria-controls="tabset-17-2" aria-selected="false"><i class="fa-brands fa-python" aria-label="python"></i></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-17-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-17-1-tab">
<p>A lâ€™issue de lâ€™exercice, le code centralisÃ© dans le script <code>R/import_data.R</code> peut Ãªtre importÃ© via le code suivant</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"R/import_data.R"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Vous pouvez initier un script nommÃ© <code>main.R</code> avec les lignes suivante:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>main.R</strong></pre>
</div>
<div class="sourceCode" id="cb44" data-startfrom="24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r" style="counter-reset: source-line 23;"><span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>MONTHS_LIST <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span></span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data ----------------------------------</span></span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a>urls <span class="ot">&lt;-</span> <span class="fu">create_data_list</span>(<span class="st">"./sources.yml"</span>)</span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-30"><a href="#cb44-30" aria-hidden="true" tabindex="-1"></a>pax_apt_all <span class="ot">&lt;-</span> <span class="fu">import_airport_data</span>(<span class="fu">unlist</span>(urls<span class="sc">$</span>airports))</span>
<span id="cb44-31"><a href="#cb44-31" aria-hidden="true" tabindex="-1"></a>pax_cie_all <span class="ot">&lt;-</span> <span class="fu">import_compagnies_data</span>(<span class="fu">unlist</span>(urls<span class="sc">$</span>compagnies))</span>
<span id="cb44-32"><a href="#cb44-32" aria-hidden="true" tabindex="-1"></a>pax_lsn_all <span class="ot">&lt;-</span> <span class="fu">import_liaisons_data</span>(<span class="fu">unlist</span>(urls<span class="sc">$</span>liaisons))</span>
<span id="cb44-33"><a href="#cb44-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-34"><a href="#cb44-34" aria-hidden="true" tabindex="-1"></a>airports_location <span class="ot">&lt;-</span> <span class="fu">st_read</span>(urls<span class="sc">$</span>geojson<span class="sc">$</span>airport)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>en les faisant prÃ©cÃ©der de lâ€™import des scripts que nous avons dÃ©jÃ  crÃ©Ã©s dans le dossier <code>R</code>:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"R/create_data_list.R"</span>)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"R/import_data.R"</span>)  </span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"R/clean_dataframe.R"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Une bonne pratique est de tester son script dans une session vierge. Cela amÃ¨ne Ã  construire pas Ã  pas une chaine plus reproductible. Pour cela,</p>
<ul>
<li>Aller dans les options de <i class="fa-brands fa-r-project" aria-label="r-project"></i> via <code>Tools &gt; Global Options</code> et dÃ©cocher la case <code>Restore .RData into workspace at setup</code></li>
<li>RedÃ©marrer votre session <i class="fa-brands fa-r-project" aria-label="r-project"></i> via le menu <code>Session &gt; Restart R</code> ou le raccourci <kbd>CTRL</kbd>+<kbd>SHIFT</kbd>+<kbd>F10</kbd></li>
<li>ExÃ©cuter votre fichier <code>main.R</code>. Vous devriez rencontrer des erreurs car nous nâ€™avons pas gÃ©rÃ© les import de librairies dans ce script puisque notre session actuelle ne bÃ©nÃ©ficie plus des import antÃ©rieurs.</li>
</ul>
<p>Une bonne pratique pour comprendre cette exigence de reproductibilitÃ© est dâ€™itÃ©rativement ajouter les librairies utiles Ã  mesure quâ€™on rencontre des erreurs (notre code Ã©tant trÃ¨s rapide Ã  tourner, cette logique dâ€™essai-erreur nâ€™est pas trÃ¨s coÃ»teuse). Si vous ne dÃ©sirez pas faire ceci (dommage, câ€™est un bon exercice), vous pouvez trouver les imports de packages Ã  faire pour que notre script soit reproductible.</p>
<details>
<summary>
Lâ€™environnement minimal de reproductibilitÃ© pour que le script <code>main.R</code> fonctionne
</summary>
<div class="sourceCode" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<p>Ces librairies sont Ã  Ã©crire au dÃ©but de <code>main.R</code>.</p>
</div>
<div id="tabset-17-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-17-2-tab">
<p>A lâ€™issue de lâ€™exercice, le code centralisÃ© dans le script <code>src/import_data.py</code> peut Ãªtre importÃ© via le code suivant</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> src.import_data <span class="im">as</span> sid</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="exploration-des-donnÃ©es" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Exploration des donnÃ©es</h1>
<section id="objectifs-1" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="objectifs-1"><span class="header-section-number">4.1</span> Objectifs</h2>
<p>Dans cette partie, vous allez exploiter les donnÃ©es pour produire trois valorisations qui seront ensuite intÃ©grÃ©es dans lâ€™application web:</p>
<ol type="1">
<li>un graphique dynamique prÃ©sentant le trafic pour un aÃ©roport donnÃ©;</li>
<li>un tableau HTML affichant des donnÃ©es sur le trafic;</li>
<li>une carte des aÃ©roports.</li>
</ol>
<p>Une fois que ces valorisations seront prÃªtes, nous pourrons nous pencher sur leur intÃ©gration dans une application interactive.</p>
</section>
<section id="prÃ©requis-crÃ©er-le-script-main" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="prÃ©requis-crÃ©er-le-script-main"><span class="header-section-number">4.2</span> PrÃ©requis: crÃ©er le script <code>main</code></h2>
<p>Pour commencer, vous allez crÃ©er un fichier fichier <code>main.R</code> (<i class="fa-brands fa-r-project" aria-label="r-project"></i>) ou <code>main.py</code> (<i class="fa-brands fa-python" aria-label="python"></i>) Ã  la racine du dÃ©pÃ´t. Ensuite, vous pouvez y copier le code suivant.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-18-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-18-1" role="tab" aria-controls="tabset-18-1" aria-selected="true"><i class="fa-brands fa-r-project" aria-label="r-project"></i></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-18-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-18-2" role="tab" aria-controls="tabset-18-2" aria-selected="false"><i class="fa-brands fa-python" aria-label="python"></i></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-18-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-18-1-tab">
<div class="sourceCode" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"correction/R/import_data.R"</span>)</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"correction/R/create_data_list.R"</span>)</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"correction/R/clean_dataframe.R"</span>)</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"correction/R/figures.R"</span>)</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data ----------------------------------</span></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>urls <span class="ot">&lt;-</span> <span class="fu">create_data_list</span>(<span class="st">"./sources.yml"</span>)</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>pax_apt_all <span class="ot">&lt;-</span> <span class="fu">import_airport_data</span>(<span class="fu">unlist</span>(urls<span class="sc">$</span>airports))</span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>pax_cie_all <span class="ot">&lt;-</span> <span class="fu">import_compagnies_data</span>(<span class="fu">unlist</span>(urls<span class="sc">$</span>compagnies))</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>pax_lsn_all <span class="ot">&lt;-</span> <span class="fu">import_liaisons_data</span>(<span class="fu">unlist</span>(urls<span class="sc">$</span>liaisons))</span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a>airports_location <span class="ot">&lt;-</span> <span class="fu">st_read</span>(urls<span class="sc">$</span>geojson<span class="sc">$</span>airport)</span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>liste_aeroports <span class="ot">&lt;-</span> <span class="fu">unique</span>(pax_apt_all<span class="sc">$</span>apt)</span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a>default_airport <span class="ot">&lt;-</span> liste_aeroports[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-18-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-18-2-tab">
<div class="sourceCode" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> ggplot, geom_line, aes</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> src.import_data <span class="im">as</span> sid</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> src.create_data_list <span class="im">import</span> create_data_list</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data ----------------------------------</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>urls <span class="op">=</span> create_data_list(<span class="st">"./sources.yml"</span>)</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>pax_apt_all <span class="op">=</span> sid.import_airport_data(urls[<span class="st">'airports'</span>].values())</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>pax_cie_all <span class="op">=</span> sid.import_airport_data(urls[<span class="st">'compagnies'</span>].values())</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>pax_lsn_all <span class="op">=</span> sid.import_airport_data(urls[<span class="st">'liaisons'</span>].values())</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>airports_location <span class="op">=</span> gpd.read_file(</span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>    urls[<span class="st">'geojson'</span>][<span class="st">'airport'</span>]</span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a>liste_aeroports <span class="op">=</span> pax_apt_all[<span class="st">'apt'</span>].unique()</span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a>default_airport <span class="op">=</span> liste_aeroports[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="valorisation-1-le-trafic-par-aÃ©roport" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="valorisation-1-le-trafic-par-aÃ©roport"><span class="header-section-number">4.3</span> Valorisation 1: Le trafic par aÃ©roport</h2>
<p>La premiÃ¨re valorisation qui sera intÃ©grÃ©e dans lâ€™application web est un graphique dÃ©crivant le trafic aÃ©rien au niveau dâ€™un aÃ©roport. Nous allon dâ€™abord crÃ©er une figure minimale (avec <code>ggplot</code> <i class="fa-brands fa-r-project" aria-label="r-project"></i> ou son Ã©quivalent <i class="fa-brands fa-python" aria-label="python"></i> <code>plotnine</code>) pour vÃ©rifier que nos donnÃ©es ont bien la dimension temporelle attendue. Cependant, comme <code>Shiny</code> est un systÃ¨me interactif, nous allons ensuite utiliser la librairie <a href="https://plotly.com/r/"><code>Plotly</code></a> pour faire des figures dynamiques: il sâ€™agit dâ€™une librairie <code>Javascript</code> qui peut Ãªtre appelÃ©e grÃ¢ce Ã  des librairies clientes en <i class="fa-brands fa-r-project" aria-label="r-project"></i> ou <i class="fa-brands fa-python" aria-label="python"></i>.</p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<i class="bi bi-book"></i> Exercice 3: Produire un graphique de frÃ©quentation des aÃ©roports
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Dans le script <code>main.R</code> ou <code>main.py</code>:</p>
<ol type="1">
<li>CrÃ©er une variable <code>trafic</code> Ã©gale <code>apt_pax_dep + apt_pax_tr + apt_pax_arr</code>;</li>
<li>Ne conserver que les donnÃ©es relatives Ã  lâ€™aÃ©roport <code>default_airport</code>;</li>
<li>CrÃ©er une variable <code>date</code> qui utilise les colonnes <code>an</code> et <code>mois</code>. Cette variable de date doit Ãªtre au format <code>date</code>, pas au format <code>chr</code>.</li>
</ol>
<details>
<summary>
EnchaÃ®nement des opÃ©rations attendues Ã  cette Ã©tape
</summary>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-19-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-19-1" role="tab" aria-controls="tabset-19-1" aria-selected="true"><i class="fa-brands fa-r-project" aria-label="r-project"></i></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-19-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-19-2" role="tab" aria-controls="tabset-19-2" aria-selected="false"><i class="fa-brands fa-python" aria-label="python"></i></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-19-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-19-1-tab">
<div class="sourceCode" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"correction/R/import_data.R"</span>)</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"correction/R/create_data_list.R"</span>)</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"correction/R/clean_dataframe.R"</span>)</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"correction/R/figures.R"</span>)</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data ----------------------------------</span></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>urls <span class="ot">&lt;-</span> <span class="fu">create_data_list</span>(<span class="st">"./sources.yml"</span>)</span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>pax_apt_all <span class="ot">&lt;-</span> <span class="fu">import_airport_data</span>(<span class="fu">unlist</span>(urls<span class="sc">$</span>airports))</span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>pax_cie_all <span class="ot">&lt;-</span> <span class="fu">import_compagnies_data</span>(<span class="fu">unlist</span>(urls<span class="sc">$</span>compagnies))</span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>pax_lsn_all <span class="ot">&lt;-</span> <span class="fu">import_liaisons_data</span>(<span class="fu">unlist</span>(urls<span class="sc">$</span>liaisons))</span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>airports_location <span class="ot">&lt;-</span> <span class="fu">st_read</span>(urls<span class="sc">$</span>geojson<span class="sc">$</span>airport)</span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a>liste_aeroports <span class="ot">&lt;-</span> <span class="fu">unique</span>(pax_apt_all<span class="sc">$</span>apt)</span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a>default_airport <span class="ot">&lt;-</span> liste_aeroports[<span class="dv">1</span>]</span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a>trafic_aeroports <span class="ot">&lt;-</span> pax_apt_all <span class="sc">%&gt;%</span></span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">trafic =</span> apt_pax_dep <span class="sc">+</span> apt_pax_tr <span class="sc">+</span> apt_pax_arr) <span class="sc">%&gt;%</span></span>
<span id="cb50-29"><a href="#cb50-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(apt <span class="sc">%in%</span> default_airport) <span class="sc">%&gt;%</span></span>
<span id="cb50-30"><a href="#cb50-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb50-31"><a href="#cb50-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">as.Date</span>(<span class="fu">paste</span>(anmois, <span class="st">"01"</span>, <span class="at">sep=</span><span class="st">""</span>), <span class="at">format =</span> <span class="st">"%Y%m%d"</span>)</span>
<span id="cb50-32"><a href="#cb50-32" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-19-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-19-2-tab">
<div class="sourceCode" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> ggplot, geom_line, aes</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> src.import_data <span class="im">as</span> sid</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> src.create_data_list <span class="im">import</span> create_data_list</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data ----------------------------------</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>urls <span class="op">=</span> create_data_list(<span class="st">"./sources.yml"</span>)</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>pax_apt_all <span class="op">=</span> sid.import_airport_data(urls[<span class="st">'airports'</span>].values())</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>pax_cie_all <span class="op">=</span> sid.import_airport_data(urls[<span class="st">'compagnies'</span>].values())</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>pax_lsn_all <span class="op">=</span> sid.import_airport_data(urls[<span class="st">'liaisons'</span>].values())</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>airports_location <span class="op">=</span> gpd.read_file(</span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>    urls[<span class="st">'geojson'</span>][<span class="st">'airport'</span>]</span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a>liste_aeroports <span class="op">=</span> pax_apt_all[<span class="st">'apt'</span>].unique()</span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a>default_airport <span class="op">=</span> liste_aeroports[<span class="dv">0</span>]</span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true" tabindex="-1"></a>pax_apt_all[<span class="st">'trafic'</span>] <span class="op">=</span> pax_apt_all[<span class="st">'apt_pax_dep'</span>] <span class="op">+</span> <span class="op">\</span></span>
<span id="cb51-28"><a href="#cb51-28" aria-hidden="true" tabindex="-1"></a>  pax_apt_all[<span class="st">'apt_pax_tr'</span>] <span class="op">+</span> <span class="op">\</span></span>
<span id="cb51-29"><a href="#cb51-29" aria-hidden="true" tabindex="-1"></a>  pax_apt_all[<span class="st">'apt_pax_arr'</span>]</span>
<span id="cb51-30"><a href="#cb51-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-31"><a href="#cb51-31" aria-hidden="true" tabindex="-1"></a>trafic_aeroports <span class="op">=</span> (</span>
<span id="cb51-32"><a href="#cb51-32" aria-hidden="true" tabindex="-1"></a>  pax_apt_all</span>
<span id="cb51-33"><a href="#cb51-33" aria-hidden="true" tabindex="-1"></a>  .loc[pax_apt_all[<span class="st">'apt'</span>] <span class="op">==</span> default_airport]</span>
<span id="cb51-34"><a href="#cb51-34" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-35"><a href="#cb51-35" aria-hidden="true" tabindex="-1"></a>trafic_aeroports[<span class="st">'date'</span>] <span class="op">=</span> pd.to_datetime(</span>
<span id="cb51-36"><a href="#cb51-36" aria-hidden="true" tabindex="-1"></a>  trafic_aeroports[<span class="st">'anmois'</span>] <span class="op">+</span> <span class="st">'01'</span>, <span class="bu">format</span><span class="op">=</span><span class="st">'%Y%m</span><span class="sc">%d</span><span class="st">'</span></span>
<span id="cb51-37"><a href="#cb51-37" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</details>
<ol start="4" type="1">
<li>Faire une <strong>figure statique</strong> pour observer la dynamique des donnÃ©es:</li>
</ol>
<ul>
<li>Pour les utilisateurs de <i class="fa-brands fa-r-project" aria-label="r-project"></i>, ce sera bien sÃ»r avec <code>ggplot</code> ;</li>
<li>Pour les utilisateurs de <i class="fa-brands fa-python" aria-label="python"></i>, vous pouvez utiliser le module graphique de votre choix: <code>matplotlib</code>, <code>seaborn</code> ou <code>plotnine</code>. Nous recommandons nÃ©anmoins <a href="https://plotnine.org/"><code>plotnine</code></a>, la transposition en <i class="fa-brands fa-python" aria-label="python"></i> de la grammaire des graphiques <code>ggplot</code>.</li>
</ul>
<p>Vous devriez obtenir une figure similaire Ã  celle-ci:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="index_files/figure-html/figure-ggplot-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Il est inutile dâ€™aller plus loin sur la mise en forme de cette figure, car lâ€™application interactive comportera <em>in fine</em> des figures dynamiques (qui se modifient en fonction des demandes de lâ€™utilisateur) plutÃ´t que des figures statiques comme celle que vous venez de produire.</p>
<ol start="5" type="1">
<li>Nous allons maintenant faire une <strong>figure dynamique</strong> avec la librairie <code>Plotly</code>. Pour cela, vous pouvez vous inspirer de <a href="https://plotly.com/r/line-charts/">cette page</a> (<i class="fa-brands fa-r-project" aria-label="r-project"></i>) ou <a href="https://plotly.com/python/line-charts/">celle-ci</a> (<i class="fa-brands fa-python" aria-label="python"></i>). La figure que vous devriez avoir est la suivante:</li>
</ol>
<div class="cell">
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-37ad41e3fc9db872fdb5" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-37ad41e3fc9db872fdb5">{"x":{"visdat":{"23f91fb43547":["function () ","plotlyVisDat"]},"cur_data":"23f91fb43547","attrs":{"23f91fb43547":{"x":{},"y":{},"text":{},"hovertemplate":"<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","mode":"lines+markers","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"xaxis":{"domain":[0,1],"automargin":true,"title":"date"},"yaxis":{"domain":[0,1],"automargin":true,"title":"trafic"},"hovermode":"closest","showlegend":false},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":["2018-01-01","2018-02-01","2018-03-01","2018-04-01","2018-05-01","2018-06-01","2018-07-01","2018-08-01","2018-09-01","2018-10-01","2018-11-01","2018-12-01","2019-01-01","2019-02-01","2019-03-01","2019-04-01","2019-05-01","2019-06-01","2019-07-01","2019-08-01","2019-09-01","2019-10-01","2019-11-01","2019-12-01","2020-01-01","2020-02-01","2020-03-01","2020-04-01","2020-05-01","2020-06-01","2020-07-01","2020-08-01","2020-09-01","2020-10-01","2020-11-01","2020-12-01","2021-01-01","2021-02-01","2021-03-01","2021-04-01","2021-05-01","2021-06-01","2021-07-01","2021-08-01","2021-09-01","2021-10-01","2021-11-01","2021-12-01","2022-01-01","2022-02-01","2022-03-01","2022-04-01","2022-05-01","2022-06-01","2022-07-01","2022-08-01","2022-09-01","2022-10-01","2022-11-01","2022-12-01"],"y":[33287,24714,26961,26224,30432,31595,49489,51680,29485,33197,22810,37085,31356,23307,29516,27718,24752,31779,45422,45361,29509,32017,24739,39382,34512,23982,21577,636,1396,4228,14969,17913,12227,15812,11596,28325,24765,7009,5029,5993,9618,16516,36841,38763,24106,25236,20873,34227,29441,19869,25972,19815,28922,31479,50968,50499,31330,34781,26573,43846],"text":["MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY","MAYOTTE-MARCEL HENRY"],"hovertemplate":["<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}","<i>AÃ©roport:<\/i> %{text}<br>Trafic: %{y}"],"mode":"lines+markers","type":"scatter","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<details>
<summary>
Aide: le code pour gÃ©nÃ©rer la figure
</summary>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-20-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-20-1" role="tab" aria-controls="tabset-20-1" aria-selected="true"><i class="fa-brands fa-r-project" aria-label="r-project"></i></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-20-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-20-2" role="tab" aria-controls="tabset-20-2" aria-selected="false"><i class="fa-brands fa-python" aria-label="python"></i></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-20-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-20-1-tab">
<div class="sourceCode" id="cb52" data-startfrom="37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r" style="counter-reset: source-line 36;"><span id="cb52-37"><a href="#cb52-37" aria-hidden="true" tabindex="-1"></a>figure_ggplot <span class="ot">&lt;-</span> trafic_aeroports <span class="sc">%&gt;%</span></span>
<span id="cb52-38"><a href="#cb52-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(.) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> trafic))</span>
<span id="cb52-39"><a href="#cb52-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-40"><a href="#cb52-40" aria-hidden="true" tabindex="-1"></a>figure_plotly <span class="ot">&lt;-</span> <span class="fu">plot_airport_line</span>(trafic_aeroports, default_airport)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-20-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-20-2-tab">
<div class="sourceCode" id="cb53" data-startfrom="48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python" style="counter-reset: source-line 47;"><span id="cb53-48"><a href="#cb53-48" aria-hidden="true" tabindex="-1"></a>figure_plotly <span class="op">=</span> px.line(</span>
<span id="cb53-49"><a href="#cb53-49" aria-hidden="true" tabindex="-1"></a>  trafic_aeroports, x<span class="op">=</span><span class="st">"date"</span>, y<span class="op">=</span><span class="st">"trafic"</span>,</span>
<span id="cb53-50"><a href="#cb53-50" aria-hidden="true" tabindex="-1"></a>  text<span class="op">=</span><span class="st">"apt_nom"</span></span>
<span id="cb53-51"><a href="#cb53-51" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb53-52"><a href="#cb53-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-53"><a href="#cb53-53" aria-hidden="true" tabindex="-1"></a>figure_plotly.update_traces(</span>
<span id="cb53-54"><a href="#cb53-54" aria-hidden="true" tabindex="-1"></a>  mode<span class="op">=</span><span class="st">"markers+lines"</span>, <span class="bu">type</span> <span class="op">=</span> <span class="st">"scatter"</span>,</span>
<span id="cb53-55"><a href="#cb53-55" aria-hidden="true" tabindex="-1"></a>  hovertemplate<span class="op">=</span><span class="st">"&lt;i&gt;AÃ©roport:&lt;/i&gt; %</span><span class="sc">{text}</span><span class="st">&lt;br&gt;Trafic: %</span><span class="sc">{y}</span><span class="st">"</span></span>
<span id="cb53-56"><a href="#cb53-56" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</details>
</div>
</div>
</div>
<p>Le code complet pour rÃ©pliquer cet exercice est donnÃ© ci-dessous.</p>
<details>
<summary>
Code de lâ€™exercice
</summary>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-21-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-21-1" role="tab" aria-controls="tabset-21-1" aria-selected="true"><i class="fa-brands fa-r-project" aria-label="r-project"></i></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-21-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-21-2" role="tab" aria-controls="tabset-21-2" aria-selected="false"><i class="fa-brands fa-python" aria-label="python"></i></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-21-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-21-1-tab">
<div class="sourceCode" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"correction/R/import_data.R"</span>)</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"correction/R/create_data_list.R"</span>)</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"correction/R/clean_dataframe.R"</span>)</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"correction/R/figures.R"</span>)</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data ----------------------------------</span></span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>urls <span class="ot">&lt;-</span> <span class="fu">create_data_list</span>(<span class="st">"./sources.yml"</span>)</span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>pax_apt_all <span class="ot">&lt;-</span> <span class="fu">import_airport_data</span>(<span class="fu">unlist</span>(urls<span class="sc">$</span>airports))</span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>pax_cie_all <span class="ot">&lt;-</span> <span class="fu">import_compagnies_data</span>(<span class="fu">unlist</span>(urls<span class="sc">$</span>compagnies))</span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>pax_lsn_all <span class="ot">&lt;-</span> <span class="fu">import_liaisons_data</span>(<span class="fu">unlist</span>(urls<span class="sc">$</span>liaisons))</span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a>airports_location <span class="ot">&lt;-</span> <span class="fu">st_read</span>(urls<span class="sc">$</span>geojson<span class="sc">$</span>airport)</span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a>liste_aeroports <span class="ot">&lt;-</span> <span class="fu">unique</span>(pax_apt_all<span class="sc">$</span>apt)</span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a>default_airport <span class="ot">&lt;-</span> liste_aeroports[<span class="dv">1</span>]</span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-26"><a href="#cb54-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-27"><a href="#cb54-27" aria-hidden="true" tabindex="-1"></a>trafic_aeroports <span class="ot">&lt;-</span> pax_apt_all <span class="sc">%&gt;%</span></span>
<span id="cb54-28"><a href="#cb54-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">trafic =</span> apt_pax_dep <span class="sc">+</span> apt_pax_tr <span class="sc">+</span> apt_pax_arr) <span class="sc">%&gt;%</span></span>
<span id="cb54-29"><a href="#cb54-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(apt <span class="sc">%in%</span> default_airport) <span class="sc">%&gt;%</span></span>
<span id="cb54-30"><a href="#cb54-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb54-31"><a href="#cb54-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">as.Date</span>(<span class="fu">paste</span>(anmois, <span class="st">"01"</span>, <span class="at">sep=</span><span class="st">""</span>), <span class="at">format =</span> <span class="st">"%Y%m%d"</span>)</span>
<span id="cb54-32"><a href="#cb54-32" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb54-33"><a href="#cb54-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-34"><a href="#cb54-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-35"><a href="#cb54-35" aria-hidden="true" tabindex="-1"></a><span class="co"># VALORISATIONS ----------------------------------------------</span></span>
<span id="cb54-36"><a href="#cb54-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-37"><a href="#cb54-37" aria-hidden="true" tabindex="-1"></a>figure_ggplot <span class="ot">&lt;-</span> trafic_aeroports <span class="sc">%&gt;%</span></span>
<span id="cb54-38"><a href="#cb54-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(.) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> trafic))</span>
<span id="cb54-39"><a href="#cb54-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-40"><a href="#cb54-40" aria-hidden="true" tabindex="-1"></a>figure_plotly <span class="ot">&lt;-</span> <span class="fu">plot_airport_line</span>(trafic_aeroports, default_airport)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="tabset-21-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-21-2-tab">
<div class="sourceCode" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> ggplot, geom_line, aes</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> src.import_data <span class="im">as</span> sid</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> src.create_data_list <span class="im">import</span> create_data_list</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data ----------------------------------</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>urls <span class="op">=</span> create_data_list(<span class="st">"./sources.yml"</span>)</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>pax_apt_all <span class="op">=</span> sid.import_airport_data(urls[<span class="st">'airports'</span>].values())</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>pax_cie_all <span class="op">=</span> sid.import_airport_data(urls[<span class="st">'compagnies'</span>].values())</span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>pax_lsn_all <span class="op">=</span> sid.import_airport_data(urls[<span class="st">'liaisons'</span>].values())</span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>airports_location <span class="op">=</span> gpd.read_file(</span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>    urls[<span class="st">'geojson'</span>][<span class="st">'airport'</span>]</span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a>liste_aeroports <span class="op">=</span> pax_apt_all[<span class="st">'apt'</span>].unique()</span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a>default_airport <span class="op">=</span> liste_aeroports[<span class="dv">0</span>]</span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a>pax_apt_all[<span class="st">'trafic'</span>] <span class="op">=</span> pax_apt_all[<span class="st">'apt_pax_dep'</span>] <span class="op">+</span> <span class="op">\</span></span>
<span id="cb55-28"><a href="#cb55-28" aria-hidden="true" tabindex="-1"></a>  pax_apt_all[<span class="st">'apt_pax_tr'</span>] <span class="op">+</span> <span class="op">\</span></span>
<span id="cb55-29"><a href="#cb55-29" aria-hidden="true" tabindex="-1"></a>  pax_apt_all[<span class="st">'apt_pax_arr'</span>]</span>
<span id="cb55-30"><a href="#cb55-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-31"><a href="#cb55-31" aria-hidden="true" tabindex="-1"></a>trafic_aeroports <span class="op">=</span> (</span>
<span id="cb55-32"><a href="#cb55-32" aria-hidden="true" tabindex="-1"></a>  pax_apt_all</span>
<span id="cb55-33"><a href="#cb55-33" aria-hidden="true" tabindex="-1"></a>  .loc[pax_apt_all[<span class="st">'apt'</span>] <span class="op">==</span> default_airport]</span>
<span id="cb55-34"><a href="#cb55-34" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-35"><a href="#cb55-35" aria-hidden="true" tabindex="-1"></a>trafic_aeroports[<span class="st">'date'</span>] <span class="op">=</span> pd.to_datetime(</span>
<span id="cb55-36"><a href="#cb55-36" aria-hidden="true" tabindex="-1"></a>  trafic_aeroports[<span class="st">'anmois'</span>] <span class="op">+</span> <span class="st">'01'</span>, <span class="bu">format</span><span class="op">=</span><span class="st">'%Y%m</span><span class="sc">%d</span><span class="st">'</span></span>
<span id="cb55-37"><a href="#cb55-37" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-38"><a href="#cb55-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-39"><a href="#cb55-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-40"><a href="#cb55-40" aria-hidden="true" tabindex="-1"></a><span class="co"># VALORISATIONS ----------------------------------------------</span></span>
<span id="cb55-41"><a href="#cb55-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-42"><a href="#cb55-42" aria-hidden="true" tabindex="-1"></a>figure_ggplot <span class="op">=</span> (</span>
<span id="cb55-43"><a href="#cb55-43" aria-hidden="true" tabindex="-1"></a>    ggplot(trafic_aeroports) <span class="op">+</span></span>
<span id="cb55-44"><a href="#cb55-44" aria-hidden="true" tabindex="-1"></a>    geom_line(aes(x <span class="op">=</span> <span class="st">"date"</span>, y <span class="op">=</span> <span class="st">"trafic"</span>))</span>
<span id="cb55-45"><a href="#cb55-45" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-46"><a href="#cb55-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-47"><a href="#cb55-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-48"><a href="#cb55-48" aria-hidden="true" tabindex="-1"></a>figure_plotly <span class="op">=</span> px.line(</span>
<span id="cb55-49"><a href="#cb55-49" aria-hidden="true" tabindex="-1"></a>  trafic_aeroports, x<span class="op">=</span><span class="st">"date"</span>, y<span class="op">=</span><span class="st">"trafic"</span>,</span>
<span id="cb55-50"><a href="#cb55-50" aria-hidden="true" tabindex="-1"></a>  text<span class="op">=</span><span class="st">"apt_nom"</span></span>
<span id="cb55-51"><a href="#cb55-51" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-52"><a href="#cb55-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-53"><a href="#cb55-53" aria-hidden="true" tabindex="-1"></a>figure_plotly.update_traces(</span>
<span id="cb55-54"><a href="#cb55-54" aria-hidden="true" tabindex="-1"></a>  mode<span class="op">=</span><span class="st">"markers+lines"</span>, <span class="bu">type</span> <span class="op">=</span> <span class="st">"scatter"</span>,</span>
<span id="cb55-55"><a href="#cb55-55" aria-hidden="true" tabindex="-1"></a>  hovertemplate<span class="op">=</span><span class="st">"&lt;i&gt;AÃ©roport:&lt;/i&gt; %</span><span class="sc">{text}</span><span class="st">&lt;br&gt;Trafic: %</span><span class="sc">{y}</span><span class="st">"</span></span>
<span id="cb55-56"><a href="#cb55-56" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</details>
<p>Nous proposons de le transformer en fonction, ce sera plus simple Ã  intÃ©grer ultÃ©rieurement dans notre application</p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-11-contents" aria-controls="callout-11" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<i class="bi bi-book"></i> Exercice 3b: une fonction de production graphique
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-11" class="callout-11-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Transformer le code ci-dessus en une fonction nommÃ©e <code>plot_airport_line</code> afin que:</p>
<ul>
<li>les <em>inputs</em> soient les suivants: un <em>dataframe</em> et un aÃ©roport Ã  sÃ©lectionner;</li>
<li>la sortie soit notre figure <code>plotly</code>.</li>
</ul>
<p>Tester la fonction sur dâ€™autres aÃ©roports de la liste. Quand vous Ãªtes satisfaits de celle-ci, dÃ©placer la dÃ©finition de cette fonction dans <code>R/figures.R</code> (<i class="fa-brands fa-r-project" aria-label="r-project"></i>) ou <code>src/figures.py</code> (<i class="fa-brands fa-python" aria-label="python"></i>). Dans le cas de Python, le fichier devra commencer par ceci:</p>
<pre><code>import pandas as pd
import plotly.express as px</code></pre>
</div>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-22-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-22-1" role="tab" aria-controls="tabset-22-1" aria-selected="true"><i class="fa-brands fa-r-project" aria-label="r-project"></i></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-22-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-22-2" role="tab" aria-controls="tabset-22-2" aria-selected="false"><i class="fa-brands fa-python" aria-label="python"></i></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-22-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-22-1-tab">
<details>
<summary>
Fichier <code>R/figures.R</code> Ã  lâ€™issue de cet exercice
</summary>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R/figures.R</strong></pre>
</div>
<div class="sourceCode" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>plot_airport_line <span class="ot">&lt;-</span> <span class="cf">function</span>(df, selected_airport){</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  trafic_aeroports <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">trafic =</span> apt_pax_dep <span class="sc">+</span> apt_pax_tr <span class="sc">+</span> apt_pax_arr) <span class="sc">%&gt;%</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(apt <span class="sc">%in%</span> selected_airport) <span class="sc">%&gt;%</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">date =</span> <span class="fu">as.Date</span>(<span class="fu">paste</span>(anmois, <span class="st">"01"</span>, <span class="at">sep=</span><span class="st">""</span>), <span class="at">format =</span> <span class="st">"%Y%m%d"</span>)</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>  figure_plotly <span class="ot">&lt;-</span> trafic_aeroports <span class="sc">%&gt;%</span></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_ly</span>(</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="sc">~</span>date, <span class="at">y =</span> <span class="sc">~</span>trafic,</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">text =</span> <span class="sc">~</span>apt_nom,</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">hovertemplate =</span> <span class="fu">paste</span>(<span class="st">"&lt;i&gt;AÃ©roport:&lt;/i&gt; %{text}&lt;br&gt;Trafic: %{y}"</span>) ,</span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">type =</span> <span class="st">'scatter'</span>, <span class="at">mode =</span> <span class="st">'lines+markers'</span>)</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(figure_plotly)</span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<p>Par la suite, nous pouvons ajouter la ligne suivante au dÃ©but de notre fichier <code>main.R</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"R/figures.R"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>et utiliser cette fonction Ã  la fin du fichier.</p>
</div>
<div id="tabset-22-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-22-2-tab">
<p>Par la suite, nous pouvons ajouter la ligne suivante au dÃ©but de notre fichier <code>main.py</code>:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> src.figures <span class="im">import</span> plot_airport_line</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>et utiliser cette fonction Ã  la fin du fichier.</p>
<details>
<summary>
Fichier <code>main.py</code> Ã  lâ€™issue de cet exercice
</summary>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>main.py</strong></pre>
</div>
<div class="sourceCode" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> ggplot, geom_line, aes</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> src.import_data <span class="im">as</span> sid</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> src.create_data_list <span class="im">import</span> create_data_list</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data ----------------------------------</span></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>urls <span class="op">=</span> create_data_list(<span class="st">"./sources.yml"</span>)</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>pax_apt_all <span class="op">=</span> sid.import_airport_data(urls[<span class="st">'airports'</span>].values())</span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>pax_cie_all <span class="op">=</span> sid.import_airport_data(urls[<span class="st">'compagnies'</span>].values())</span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>pax_lsn_all <span class="op">=</span> sid.import_airport_data(urls[<span class="st">'liaisons'</span>].values())</span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a>airports_location <span class="op">=</span> gpd.read_file(</span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a>    urls[<span class="st">'geojson'</span>][<span class="st">'airport'</span>]</span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-22"><a href="#cb60-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-23"><a href="#cb60-23" aria-hidden="true" tabindex="-1"></a>liste_aeroports <span class="op">=</span> pax_apt_all[<span class="st">'apt'</span>].unique()</span>
<span id="cb60-24"><a href="#cb60-24" aria-hidden="true" tabindex="-1"></a>default_airport <span class="op">=</span> liste_aeroports[<span class="dv">0</span>]</span>
<span id="cb60-25"><a href="#cb60-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-26"><a href="#cb60-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-27"><a href="#cb60-27" aria-hidden="true" tabindex="-1"></a><span class="co"># OBJETS NECESSAIRES A L'APPLICATION ------------------------</span></span>
<span id="cb60-28"><a href="#cb60-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-29"><a href="#cb60-29" aria-hidden="true" tabindex="-1"></a>pax_apt_all[<span class="st">'trafic'</span>] <span class="op">=</span> pax_apt_all[<span class="st">'apt_pax_dep'</span>] <span class="op">+</span> <span class="op">\</span></span>
<span id="cb60-30"><a href="#cb60-30" aria-hidden="true" tabindex="-1"></a>  pax_apt_all[<span class="st">'apt_pax_tr'</span>] <span class="op">+</span> <span class="op">\</span></span>
<span id="cb60-31"><a href="#cb60-31" aria-hidden="true" tabindex="-1"></a>  pax_apt_all[<span class="st">'apt_pax_arr'</span>]</span>
<span id="cb60-32"><a href="#cb60-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-33"><a href="#cb60-33" aria-hidden="true" tabindex="-1"></a>trafic_aeroports <span class="op">=</span> (</span>
<span id="cb60-34"><a href="#cb60-34" aria-hidden="true" tabindex="-1"></a>  pax_apt_all</span>
<span id="cb60-35"><a href="#cb60-35" aria-hidden="true" tabindex="-1"></a>  .loc[pax_apt_all[<span class="st">'apt'</span>] <span class="op">==</span> default_airport]</span>
<span id="cb60-36"><a href="#cb60-36" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb60-37"><a href="#cb60-37" aria-hidden="true" tabindex="-1"></a>trafic_aeroports[<span class="st">'date'</span>] <span class="op">=</span> pd.to_datetime(</span>
<span id="cb60-38"><a href="#cb60-38" aria-hidden="true" tabindex="-1"></a>  trafic_aeroports[<span class="st">'anmois'</span>] <span class="op">+</span> <span class="st">'01'</span>, <span class="bu">format</span><span class="op">=</span><span class="st">'%Y%m</span><span class="sc">%d</span><span class="st">'</span></span>
<span id="cb60-39"><a href="#cb60-39" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb60-40"><a href="#cb60-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-41"><a href="#cb60-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-42"><a href="#cb60-42" aria-hidden="true" tabindex="-1"></a><span class="co"># VALORISATIONS ----------------------------------------------</span></span>
<span id="cb60-43"><a href="#cb60-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-44"><a href="#cb60-44" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> src.figures <span class="im">import</span> plot_airport_line</span>
<span id="cb60-45"><a href="#cb60-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-46"><a href="#cb60-46" aria-hidden="true" tabindex="-1"></a>figure_plotly <span class="op">=</span> plot_airport_line(trafic_aeroports, default_airport)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
</div>
</div>
</div>
</section>
<section id="valorisation-2-tableau-html-pour-afficher-des-donnÃ©es" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="valorisation-2-tableau-html-pour-afficher-des-donnÃ©es"><span class="header-section-number">4.4</span> Valorisation 2: Tableau HTML pour afficher des donnÃ©es</h2>
<p>La deuxiÃ¨me valorisation qui sera intÃ©grÃ©e dans lâ€™application web est un tableau permettant de visualiser certaines donnÃ©es directement dans le <em>dashboard</em>. Il existe plusieurs <em>packages</em> pour faire cela, que ce soit en <i class="fa-brands fa-r-project" aria-label="r-project"></i> ou <i class="fa-brands fa-python" aria-label="python"></i>.</p>
<p>Lâ€™Ã©cosystÃ¨me le plus complet pour construire ce tableau est dÃ©veloppÃ© par <code>Posit</code> et est quasi Ã©quivalent quâ€™on fasse du <i class="fa-brands fa-r-project" aria-label="r-project"></i> ou du <i class="fa-brands fa-python" aria-label="python"></i> (il est plus complet en <i class="fa-brands fa-r-project" aria-label="r-project"></i> car plus ancien dans ce langage). Il sâ€™agit du <em>package</em> <a href="https://gt.rstudio.com/"><code>GT</code></a> (<i class="fa-brands fa-r-project" aria-label="r-project"></i>) ou <a href="https://posit-dev.github.io/great-tables/articles/intro.html"><code>Great Tables</code></a> (<i class="fa-brands fa-python" aria-label="python"></i>). En peu de temps, ces <em>packages</em> sont devenus incontournables et proposent des fonctionnalitÃ©s bien plus complÃ¨tes que les solutions qui existaient par le passÃ©, notamment <a href="https://rstudio.github.io/DT/"><code>DT</code></a>.</p>
<p>Pour le prochain exercice, vous pourrez utiliser les objets suivants. Copiez-les Ã  la fin de votre script <code>main</code>.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-23-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-23-1" role="tab" aria-controls="tabset-23-1" aria-selected="true"><i class="fa-brands fa-r-project" aria-label="r-project"></i></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-23-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-23-2" role="tab" aria-controls="tabset-23-2" aria-selected="false"><i class="fa-brands fa-python" aria-label="python"></i></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-23-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-23-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>YEARS_LIST  <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="dv">2018</span><span class="sc">:</span><span class="dv">2022</span>)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>MONTHS_LIST <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-23-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-23-2-tab">
<div class="sourceCode" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>YEARS_LIST <span class="op">=</span> [<span class="bu">str</span>(year) <span class="cf">for</span> year <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2018</span>, <span class="dv">2023</span>)]</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>MONTHS_LIST <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">13</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-12-contents" aria-controls="callout-12" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<i class="bi bi-book"></i> Exercice 4a: prÃ©parer les donnÃ©es avant de faire un beau tableau
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-12" class="callout-12-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Nous allons intÃ©grer dans notre application deux tableaux de statistiques descriptives.</p>
<ol type="1">
<li>Choisir un mois et une annÃ©e Ã  partir des objets <code>YEARS_LIST</code> et <code>MONTHS_LIST</code> pour faire un filtre sur le <em>dataframe</em> <code>pax_apt_all</code>. Une fois que vous Ãªtes satisfaits, transformer cela en une fonction <code>create_data_from_input</code> prenant en argument un <em>dataframe</em>, une annÃ©e et un mois, et renvoyant un <em>dataframe</em>.</li>
</ol>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-24-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-24-1" role="tab" aria-controls="tabset-24-1" aria-selected="true"><i class="fa-brands fa-r-project" aria-label="r-project"></i></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-24-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-24-2" role="tab" aria-controls="tabset-24-2" aria-selected="false"><i class="fa-brands fa-python" aria-label="python"></i></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-24-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-24-1-tab">
<details>
<summary>
Code de lâ€™exercice
</summary>
<div class="sourceCode" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>create_data_from_input <span class="ot">&lt;-</span> <span class="cf">function</span>(data, year, month){</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(mois <span class="sc">%in%</span> month, an <span class="sc">%in%</span> year)</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(data)</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="tabset-24-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-24-2-tab">
<details>
<summary>
Code de lâ€™exercice
</summary>
<div class="sourceCode" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_data_from_input(data, year, month):</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  data <span class="op">=</span> (</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>    data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
<ol start="2" type="1">
<li>Pour chaque aÃ©roport (dÃ©fini par son nom et par son code), calculer le nombre total de passagers au dÃ©part, Ã  lâ€™arrivÃ©e, en transit, et total, puis classer les aÃ©roports du plus frÃ©quentÃ© au moins frÃ©quentÃ© (en nombre total de passagers). Stocker le rÃ©sultat dans lâ€™objet <code>stats_aeroports</code>. Une fois que vous Ãªtes satisfaits de votre chaine dâ€™opÃ©ration, crÃ©er une fonction <code>summary_stat_airport</code> qui prend en entrÃ©e un <em>dataframe</em> et renvoie un <em>dataframe</em>.</li>
</ol>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-25-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-25-1" role="tab" aria-controls="tabset-25-1" aria-selected="true"><i class="fa-brands fa-r-project" aria-label="r-project"></i></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-25-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-25-2" role="tab" aria-controls="tabset-25-2" aria-selected="false"><i class="fa-brands fa-python" aria-label="python"></i></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-25-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-25-1-tab">
<details>
<summary>
Code de lâ€™exercice
</summary>
<div class="sourceCode" id="cb65" data-startfrom="8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r" style="counter-reset: source-line 7;"><span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>  table2 <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(apt, apt_nom) <span class="sc">%&gt;%</span></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">paxdep =</span> <span class="fu">round</span>(<span class="fu">sum</span>(apt_pax_dep, <span class="at">na.rm =</span> T),<span class="dv">3</span>),</span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">paxarr =</span> <span class="fu">round</span>(<span class="fu">sum</span>(apt_pax_arr, <span class="at">na.rm =</span> T),<span class="dv">3</span>),</span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">paxtra =</span> <span class="fu">round</span>(<span class="fu">sum</span>(apt_pax_tr, <span class="at">na.rm =</span> T),<span class="dv">3</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(paxdep)) <span class="sc">%&gt;%</span></span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(table2)</span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a>summary_stat_liaisons <span class="ot">&lt;-</span> <span class="cf">function</span>(data){</span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a>  agg_data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb65-22"><a href="#cb65-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(lsn_fsc) <span class="sc">%&gt;%</span></span>
<span id="cb65-23"><a href="#cb65-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb65-24"><a href="#cb65-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">paxloc =</span> <span class="fu">round</span>(<span class="fu">sum</span>(lsn_pax_loc, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)<span class="sc">*</span><span class="fl">1e-6</span>,<span class="dv">3</span>)</span>
<span id="cb65-25"><a href="#cb65-25" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb65-26"><a href="#cb65-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb65-27"><a href="#cb65-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(agg_data)</span>
<span id="cb65-28"><a href="#cb65-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb65-29"><a href="#cb65-29" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="tabset-25-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-25-2-tab">
<details>
<summary>
Code de lâ€™exercice
</summary>
<div class="sourceCode" id="cb66" data-startfrom="9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python" style="counter-reset: source-line 8;"><span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> data</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> summary_stat_airport(data):</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>    table2 <span class="op">=</span> (</span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>        data</span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a>        .groupby([<span class="st">"apt"</span>, <span class="st">"apt_nom"</span>])</span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>        .agg({<span class="st">"apt_pax_dep"</span>: <span class="st">"sum"</span>, <span class="st">"apt_pax_arr"</span>: <span class="st">"sum"</span>, <span class="st">"apt_pax_tr"</span>: <span class="st">"sum"</span>, <span class="st">"trafic"</span>: <span class="st">"sum"</span>})</span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>        .sort_values(<span class="st">"trafic"</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a>        .reset_index()</span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a>    table2.columns <span class="op">=</span> table2.columns.<span class="bu">str</span>.replace(<span class="st">"apt_pax_"</span>, <span class="st">"pax"</span>)</span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> table2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
<ol start="3" type="1">
<li><p>Reporter les fonctions crÃ©Ã©es dans cet exercice dans un script <code>R/divers_functions.R</code> (<i class="fa-brands fa-r-project" aria-label="r-project"></i>) ou <code>src/divers_functions.py</code> (<i class="fa-brands fa-python" aria-label="python"></i>). Dans le cas de Python, ce fichier doit commencer par <code>import pandas as pd</code>, car ce package est utilisÃ© dans la fonction.</p></li>
<li><p>Enrichir le script <code>main.R</code> (resp. <code>main.py</code>) pour utiliser celles-ci en crÃ©ant les <em>dataframes</em> adÃ©quats (correction ci-dessous).</p></li>
</ol>
</div>
</div>
</div>
<p>Voici une proposition de script <code>main.R</code> (resp. <code>main.py</code>) Ã  lâ€™issue de cet exercice</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-26-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-26-1" role="tab" aria-controls="tabset-26-1" aria-selected="true"><i class="fa-brands fa-r-project" aria-label="r-project"></i></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-26-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-26-2" role="tab" aria-controls="tabset-26-2" aria-selected="false"><i class="fa-brands fa-python" aria-label="python"></i></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-26-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-26-1-tab">
<details>
<summary>
Code de lâ€™exercice
</summary>
<div class="sourceCode" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"correction/R/import_data.R"</span>)</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"correction/R/create_data_list.R"</span>)</span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"correction/R/clean_dataframe.R"</span>)</span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"correction/R/divers_functions.R"</span>)</span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"correction/R/figures.R"</span>)</span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>YEARS_LIST  <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="dv">2018</span><span class="sc">:</span><span class="dv">2022</span>)</span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>MONTHS_LIST <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span></span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a>year <span class="ot">&lt;-</span> YEARS_LIST[<span class="dv">1</span>]</span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a>month <span class="ot">&lt;-</span> MONTHS_LIST[<span class="dv">1</span>]</span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-21"><a href="#cb67-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data ----------------------------------</span></span>
<span id="cb67-22"><a href="#cb67-22" aria-hidden="true" tabindex="-1"></a>urls <span class="ot">&lt;-</span> <span class="fu">create_data_list</span>(<span class="st">"./sources.yml"</span>)</span>
<span id="cb67-23"><a href="#cb67-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-24"><a href="#cb67-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-25"><a href="#cb67-25" aria-hidden="true" tabindex="-1"></a>pax_apt_all <span class="ot">&lt;-</span> <span class="fu">import_airport_data</span>(<span class="fu">unlist</span>(urls<span class="sc">$</span>airports))</span>
<span id="cb67-26"><a href="#cb67-26" aria-hidden="true" tabindex="-1"></a>pax_cie_all <span class="ot">&lt;-</span> <span class="fu">import_compagnies_data</span>(<span class="fu">unlist</span>(urls<span class="sc">$</span>compagnies))</span>
<span id="cb67-27"><a href="#cb67-27" aria-hidden="true" tabindex="-1"></a>pax_lsn_all <span class="ot">&lt;-</span> <span class="fu">import_liaisons_data</span>(<span class="fu">unlist</span>(urls<span class="sc">$</span>liaisons))</span>
<span id="cb67-28"><a href="#cb67-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-29"><a href="#cb67-29" aria-hidden="true" tabindex="-1"></a>airports_location <span class="ot">&lt;-</span> <span class="fu">st_read</span>(urls<span class="sc">$</span>geojson<span class="sc">$</span>airport)</span>
<span id="cb67-30"><a href="#cb67-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-31"><a href="#cb67-31" aria-hidden="true" tabindex="-1"></a>liste_aeroports <span class="ot">&lt;-</span> <span class="fu">unique</span>(pax_apt_all<span class="sc">$</span>apt)</span>
<span id="cb67-32"><a href="#cb67-32" aria-hidden="true" tabindex="-1"></a>default_airport <span class="ot">&lt;-</span> liste_aeroports[<span class="dv">1</span>]</span>
<span id="cb67-33"><a href="#cb67-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-34"><a href="#cb67-34" aria-hidden="true" tabindex="-1"></a><span class="co"># OBJETS NECESSAIRES A L'APPLICATION ------------------------</span></span>
<span id="cb67-35"><a href="#cb67-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-36"><a href="#cb67-36" aria-hidden="true" tabindex="-1"></a>trafic_aeroports <span class="ot">&lt;-</span> pax_apt_all <span class="sc">%&gt;%</span></span>
<span id="cb67-37"><a href="#cb67-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">trafic =</span> apt_pax_dep <span class="sc">+</span> apt_pax_tr <span class="sc">+</span> apt_pax_arr) <span class="sc">%&gt;%</span></span>
<span id="cb67-38"><a href="#cb67-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(apt <span class="sc">%in%</span> default_airport) <span class="sc">%&gt;%</span></span>
<span id="cb67-39"><a href="#cb67-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb67-40"><a href="#cb67-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">as.Date</span>(<span class="fu">paste</span>(anmois, <span class="st">"01"</span>, <span class="at">sep=</span><span class="st">""</span>), <span class="at">format =</span> <span class="st">"%Y%m%d"</span>)</span>
<span id="cb67-41"><a href="#cb67-41" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb67-42"><a href="#cb67-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-43"><a href="#cb67-43" aria-hidden="true" tabindex="-1"></a>stats_aeroports <span class="ot">&lt;-</span> <span class="fu">summary_stat_airport</span>(</span>
<span id="cb67-44"><a href="#cb67-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">create_data_from_input</span>(pax_apt_all, year, month)</span>
<span id="cb67-45"><a href="#cb67-45" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb67-46"><a href="#cb67-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-47"><a href="#cb67-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-48"><a href="#cb67-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-49"><a href="#cb67-49" aria-hidden="true" tabindex="-1"></a><span class="co"># VALORISATIONS ----------------------------------------------</span></span>
<span id="cb67-50"><a href="#cb67-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-51"><a href="#cb67-51" aria-hidden="true" tabindex="-1"></a>figure_plotly <span class="ot">&lt;-</span> <span class="fu">plot_airport_line</span>(trafic_aeroports,default_airport)</span>
<span id="cb67-52"><a href="#cb67-52" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="tabset-26-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-26-2-tab">
<details>
<summary>
Code de lâ€™exercice
</summary>
<div class="sourceCode" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> ggplot, geom_line, aes</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> src.import_data <span class="im">as</span> sid</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> src.create_data_list <span class="im">import</span> create_data_list</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> src.divers_functions <span class="im">import</span> (</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>  create_data_from_input,</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>  summary_stat_airport</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a>YEARS_LIST <span class="op">=</span> [<span class="bu">str</span>(year) <span class="cf">for</span> year <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2018</span>, <span class="dv">2023</span>)]</span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a>MONTHS_LIST <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">13</span>))</span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a>year <span class="op">=</span> YEARS_LIST[<span class="dv">0</span>]</span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a>month <span class="op">=</span> MONTHS_LIST[<span class="dv">0</span>]</span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data ----------------------------------</span></span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a>urls <span class="op">=</span> create_data_list(<span class="st">"./sources.yml"</span>)</span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true" tabindex="-1"></a>pax_apt_all <span class="op">=</span> sid.import_airport_data(urls[<span class="st">'airports'</span>].values())</span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true" tabindex="-1"></a>pax_cie_all <span class="op">=</span> sid.import_airport_data(urls[<span class="st">'compagnies'</span>].values())</span>
<span id="cb68-24"><a href="#cb68-24" aria-hidden="true" tabindex="-1"></a>pax_lsn_all <span class="op">=</span> sid.import_airport_data(urls[<span class="st">'liaisons'</span>].values())</span>
<span id="cb68-25"><a href="#cb68-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-26"><a href="#cb68-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-27"><a href="#cb68-27" aria-hidden="true" tabindex="-1"></a>airports_location <span class="op">=</span> gpd.read_file(</span>
<span id="cb68-28"><a href="#cb68-28" aria-hidden="true" tabindex="-1"></a>    urls[<span class="st">'geojson'</span>][<span class="st">'airport'</span>]</span>
<span id="cb68-29"><a href="#cb68-29" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb68-30"><a href="#cb68-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-31"><a href="#cb68-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-32"><a href="#cb68-32" aria-hidden="true" tabindex="-1"></a>liste_aeroports <span class="op">=</span> pax_apt_all[<span class="st">'apt'</span>].unique()</span>
<span id="cb68-33"><a href="#cb68-33" aria-hidden="true" tabindex="-1"></a>default_airport <span class="op">=</span> liste_aeroports[<span class="dv">0</span>]</span>
<span id="cb68-34"><a href="#cb68-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-35"><a href="#cb68-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-36"><a href="#cb68-36" aria-hidden="true" tabindex="-1"></a><span class="co"># OBJETS NECESSAIRES A L'APPLICATION ------------------------</span></span>
<span id="cb68-37"><a href="#cb68-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-38"><a href="#cb68-38" aria-hidden="true" tabindex="-1"></a>pax_apt_all[<span class="st">'trafic'</span>] <span class="op">=</span> pax_apt_all[<span class="st">'apt_pax_dep'</span>] <span class="op">+</span> <span class="op">\</span></span>
<span id="cb68-39"><a href="#cb68-39" aria-hidden="true" tabindex="-1"></a>  pax_apt_all[<span class="st">'apt_pax_tr'</span>] <span class="op">+</span> <span class="op">\</span></span>
<span id="cb68-40"><a href="#cb68-40" aria-hidden="true" tabindex="-1"></a>  pax_apt_all[<span class="st">'apt_pax_arr'</span>]</span>
<span id="cb68-41"><a href="#cb68-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-42"><a href="#cb68-42" aria-hidden="true" tabindex="-1"></a>trafic_aeroports <span class="op">=</span> (</span>
<span id="cb68-43"><a href="#cb68-43" aria-hidden="true" tabindex="-1"></a>  pax_apt_all</span>
<span id="cb68-44"><a href="#cb68-44" aria-hidden="true" tabindex="-1"></a>  .loc[pax_apt_all[<span class="st">'apt'</span>] <span class="op">==</span> default_airport]</span>
<span id="cb68-45"><a href="#cb68-45" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb68-46"><a href="#cb68-46" aria-hidden="true" tabindex="-1"></a>trafic_aeroports[<span class="st">'date'</span>] <span class="op">=</span> pd.to_datetime(</span>
<span id="cb68-47"><a href="#cb68-47" aria-hidden="true" tabindex="-1"></a>  trafic_aeroports[<span class="st">'anmois'</span>] <span class="op">+</span> <span class="st">'01'</span>, <span class="bu">format</span><span class="op">=</span><span class="st">'%Y%m</span><span class="sc">%d</span><span class="st">'</span></span>
<span id="cb68-48"><a href="#cb68-48" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb68-49"><a href="#cb68-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-50"><a href="#cb68-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-51"><a href="#cb68-51" aria-hidden="true" tabindex="-1"></a><span class="co"># VALORISATIONS ----------------------------------------------</span></span>
<span id="cb68-52"><a href="#cb68-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-53"><a href="#cb68-53" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> src.figures <span class="im">import</span> plot_airport_line</span>
<span id="cb68-54"><a href="#cb68-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-55"><a href="#cb68-55" aria-hidden="true" tabindex="-1"></a>figure_plotly <span class="op">=</span> plot_airport_line(trafic_aeroports, default_airport)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
<p>Nous avons maintenant tous les ingrÃ©dients pour faire un tableau de statistiques descriptives lisibles et esthÃ©tiques. Avant de crÃ©er cette table, nous allons crÃ©er une colonne supplÃ©mentaire:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-27-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-27-1" role="tab" aria-controls="tabset-27-1" aria-selected="true"><i class="fa-brands fa-r-project" aria-label="r-project"></i></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-27-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-27-2" role="tab" aria-controls="tabset-27-2" aria-selected="false"><i class="fa-brands fa-python" aria-label="python"></i></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-27-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-27-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>stats_aeroports_table <span class="ot">&lt;-</span> stats_aeroports <span class="sc">%&gt;%</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name_clean =</span> <span class="fu">paste0</span>(<span class="fu">str_to_sentence</span>(apt_nom), <span class="st">" _("</span>, apt, <span class="st">")_"</span>)</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(name_clean, <span class="fu">everything</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-27-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-27-2-tab">
<div class="sourceCode" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>stats_aeroports[<span class="st">'name_clean'</span>] <span class="op">=</span> stats_aeroports[<span class="st">'apt_nom'</span>].<span class="bu">str</span>.title() <span class="op">+</span> <span class="st">" _("</span> <span class="op">+</span> stats_aeroports[<span class="st">'apt'</span>] <span class="op">+</span> <span class="st">")_"</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>stats_aeroports <span class="op">=</span> stats_aeroports[ [<span class="st">'name_clean'</span>] <span class="op">+</span> [ col <span class="cf">for</span> col <span class="kw">in</span> stats_aeroports.columns <span class="cf">if</span> col <span class="op">!=</span> <span class="st">'name_clean'</span> ] ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>Celle-ci nous permettra, une fois mise en forme, dâ€™avoir une colonne plus esthÃ©tique.</p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-13-contents" aria-controls="callout-13" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<i class="bi bi-book"></i> Exercice 4b: un beau tableau (enfin !)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-13" class="callout-13-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Les diffÃ©rentes questions vont permettre de construire et formatter progressivement notre tableau. Si vous Ãªtes bloquÃ©s, les rÃ©ponses sont ci-dessous dans des menus dÃ©roulants.</p>
<ol type="1">
<li><p>En premier lieu, utiliser <code>GT</code> pour faire un tableau basique sur le <em>dataframe</em> <code>stats_aeroports</code> (pour les utilisateurs de <i class="fa-brands fa-python" aria-label="python"></i>, le faire sur <code>stats_aeroports.head(15)</code> car il nâ€™est pas encore possible de limiter la taille de la page). Nâ€™utiliser aucune option, celles-ci vont Ãªtre progressivement ajoutÃ©es.</p></li>
<li><p>Retirer les colonnes <code>apt</code> et <code>apt_nom</code> de notre table.</p>
<details>
<summary>
<p>Il y a plusieurs maniÃ¨res de faire, voici un indice sur la â€œmeilleureâ€</p>
</summary>
<ul>
<li>En <i class="fa-brands fa-r-project" aria-label="r-project"></i>, il est possible dâ€™utiliser des fonctions de sÃ©lection de colonnes issues du <em>tidyverse</em> dans <code>GT</code>, notamment la fonction <code>starts_with</code> (Ã  ne pas confondre avec celle de <code>stringr</code>)</li>
<li>En <i class="fa-brands fa-python" aria-label="python"></i>, quand on fournit un <em>DataFrame</em> <code>Polars</code>, on peut utiliser les fonctions de sÃ©lection qui ressemblent Ã  celles du <code>tidyverse</code>. NÃ©anmoins, lÃ  nous avons un <em>DataFrame</em> <code>Pandas</code>. Il faudra donc utiliser des mÃ©thodes <code>Pandas</code>, un peu plus verbeuses, du type</li>
</ul>
<div class="sourceCode" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a> stats_aeroports.<span class="bu">filter</span>(like <span class="op">=</span> <span class="st">"&lt;debut_de_string&gt;"</span>).columns.tolist()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details></li>
<li><p>Formatter les colonnes numÃ©riques (pour la sÃ©lection des colonnes numÃ©riques, voir lâ€™indice ci-dessus). En consultant la documentation de <code>gt</code>, appliquer lâ€™option qui permet de rendre plus concise la notation des milliers (K) et millions (M).</p></li>
<li><p>Utiliser <code>fmt_markdown</code> pour appliquer une mise en forme adaptÃ©e Ã  la colonne <code>name_clean</code></p></li>
<li><p>Mettre en forme les noms de colonne (<code>cols_label</code>), le titre (<code>tab_header</code>), les notes (<code>tab_source_note</code>) pour avoir un tableau esthÃ©thique et informatif. Pour les utilisateurs de <i class="fa-brands fa-r-project" aria-label="r-project"></i>, vous pouvez aussi modifier la couleur de la partie supÃ©rieure du tableau (<code>tab_style</code>).</p></li>
<li><p>Pour les utilisateurs de <i class="fa-brands fa-r-project" aria-label="r-project"></i>, transformer la table en tableau interactif avec <code>opt_interactive</code><a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a>.</p></li>
</ol>
</div>
</div>
</div>
<p>Les rÃ©ponses aux diffÃ©rentes questions sont donnÃ©es de maniÃ¨re successives ci-dessous. La table finale, obtenue Ã  lâ€™issue de lâ€™exercice est la suivante:</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-28-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-28-1" role="tab" aria-controls="tabset-28-1" aria-selected="true"><i class="fa-brands fa-r-project" aria-label="r-project"></i></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-28-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-28-2" role="tab" aria-controls="tabset-28-2" aria-selected="false"><i class="fa-brands fa-python" aria-label="python"></i></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-28-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-28-1-tab">
<div class="cell">
<details>
<summary>RÃ©ponse question 1</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>table_aeroports <span class="ot">&lt;-</span> <span class="fu">gt</span>(stats_aeroports_table)</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>table_aeroports</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>RÃ©ponse question 2</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>table_aeroports <span class="ot">&lt;-</span> table_aeroports <span class="sc">%&gt;%</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_hide</span>(<span class="at">columns =</span> <span class="fu">starts_with</span>(<span class="st">"apt"</span>))</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>table_aeroports</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>RÃ©ponse question 3</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>table_aeroports <span class="ot">&lt;-</span> table_aeroports <span class="sc">%&gt;%</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="fu">starts_with</span>(<span class="st">"pax"</span>), <span class="at">suffixing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>table_aeroports</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>RÃ©ponse question 4</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>table_aeroports <span class="ot">&lt;-</span> table_aeroports <span class="sc">%&gt;%</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_markdown</span>(<span class="at">columns =</span> <span class="st">"name_clean"</span>)</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>table_aeroports</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>RÃ©ponse question 5</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>table_aeroports <span class="ot">&lt;-</span> table_aeroports <span class="sc">%&gt;%</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_label</span>(</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">name_clean =</span> <span class="fu">md</span>(<span class="st">"**AÃ©roport**"</span>),</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">paxdep =</span> <span class="fu">md</span>(<span class="st">"**DÃ©parts**"</span>),</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">paxarr =</span> <span class="fu">md</span>(<span class="st">"**ArrivÃ©e**"</span>),</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">paxtra =</span> <span class="fu">md</span>(<span class="st">"**Transit**"</span>)</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_header</span>(</span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">md</span>(<span class="st">"**Statistiques de frÃ©quentation**"</span>),</span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="fu">md</span>(<span class="st">"Classement des aÃ©roports"</span>)</span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_style</span>(</span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="fu">cell_fill</span>(<span class="at">color =</span> <span class="st">"powderblue"</span>),</span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">locations =</span> <span class="fu">cells_title</span>()</span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_source_note</span>(<span class="at">source_note =</span> <span class="fu">md</span>(<span class="st">"_Source: DGAC, Ã  partir des donnÃ©es sur data.gouv.fr_"</span>))</span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb76-18"><a href="#cb76-18" aria-hidden="true" tabindex="-1"></a>table_aeroports</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>RÃ©ponse question 6</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>table_aeroports <span class="ot">&lt;-</span> table_aeroports <span class="sc">%&gt;%</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">opt_interactive</span>()</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>table_aeroports</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div id="ejpsivxdgg" class=".gt_table" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#ejpsivxdgg table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#ejpsivxdgg thead, #ejpsivxdgg tbody, #ejpsivxdgg tfoot, #ejpsivxdgg tr, #ejpsivxdgg td, #ejpsivxdgg th {
  border-style: none;
}

#ejpsivxdgg p {
  margin: 0;
  padding: 0;
}

#ejpsivxdgg .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ejpsivxdgg .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#ejpsivxdgg .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ejpsivxdgg .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ejpsivxdgg .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ejpsivxdgg .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ejpsivxdgg .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ejpsivxdgg .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ejpsivxdgg .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ejpsivxdgg .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ejpsivxdgg .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ejpsivxdgg .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ejpsivxdgg .gt_spanner_row {
  border-bottom-style: hidden;
}

#ejpsivxdgg .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#ejpsivxdgg .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ejpsivxdgg .gt_from_md > :first-child {
  margin-top: 0;
}

#ejpsivxdgg .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ejpsivxdgg .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ejpsivxdgg .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ejpsivxdgg .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ejpsivxdgg .gt_row_group_first td {
  border-top-width: 2px;
}

#ejpsivxdgg .gt_row_group_first th {
  border-top-width: 2px;
}

#ejpsivxdgg .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ejpsivxdgg .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ejpsivxdgg .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ejpsivxdgg .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ejpsivxdgg .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ejpsivxdgg .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ejpsivxdgg .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#ejpsivxdgg .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ejpsivxdgg .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ejpsivxdgg .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ejpsivxdgg .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ejpsivxdgg .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ejpsivxdgg .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ejpsivxdgg .gt_left {
  text-align: left;
}

#ejpsivxdgg .gt_center {
  text-align: center;
}

#ejpsivxdgg .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ejpsivxdgg .gt_font_normal {
  font-weight: normal;
}

#ejpsivxdgg .gt_font_bold {
  font-weight: bold;
}

#ejpsivxdgg .gt_font_italic {
  font-style: italic;
}

#ejpsivxdgg .gt_super {
  font-size: 65%;
}

#ejpsivxdgg .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#ejpsivxdgg .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ejpsivxdgg .gt_indent_1 {
  text-indent: 5px;
}

#ejpsivxdgg .gt_indent_2 {
  text-indent: 10px;
}

#ejpsivxdgg .gt_indent_3 {
  text-indent: 15px;
}

#ejpsivxdgg .gt_indent_4 {
  text-indent: 20px;
}

#ejpsivxdgg .gt_indent_5 {
  text-indent: 25px;
}
</style>
<div style="font-family:system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;border-top-style:solid;border-top-width:2px;border-top-color:#D3D3D3;">
<div class="gt_heading gt_title gt_font_normal" style="text-size:bigger;"><strong>Statistiques de frÃ©quentation</strong></div>
<div class="gt_heading gt_subtitle ">Classement des aÃ©roports</div>
</div>
<div id="ejpsivxdgg" class="reactable html-widget" style="width:auto;height:auto;"></div>
<div style="font-family:system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;border-top-style:solid;border-top-width:2px;border-top-color:#D3D3D3;border-bottom-style:solid;border-bottom-width:2px;border-bottom-color:#D3D3D3;padding-top:6px;padding-bottom:6px;padding-left:10px;padding-right:10px;">
<div>


<em>Source: DGAC, Ã  partir des donnÃ©es sur data.gouv.fr</em>


</div>
<div></div>
</div>
<script type="application/json" data-for="ejpsivxdgg">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"name_clean":["Paris-charles de gaulle _(LFPG)_","Paris-orly _(LFPO)_","Nice-cote d'azur _(LFMN)_","Lyon-st-exupery _(LFLL)_","Toulouse-blagnac _(LFBO)_","Marseille-provence _(LFML)_","Bale-mulhouse _(LFSB)_","Bordeaux-merignac _(LFBD)_","Nantes-atlantique _(LFRS)_","Beauvais-tille _(LFOB)_","La reunion-roland garros _(FMEE)_","Pointe-a-pitre-le raizet _(TFFR)_","Martinique-aime cesaire _(TFFF)_","Montpellier-mediterranee _(LFMT)_","Lille-lesquin _(LFQQ)_","Tahiti faa'a _(NTAA)_","Strasbourg-entzheim _(LFST)_","Brest-bretagne _(LFRB)_","Grenoble-alpes-isere _(LFLS)_","Biarritz-pays-basque _(LFBZ)_","Ajaccio-napoleon-bonaparte _(LFKJ)_","Noumea la tontouta _(NWWW)_","Bastia-poretta _(LFKB)_","Chambery-aix-les-bains _(LFLB)_","Rennes-st-jacques _(LFRN)_","Pau-pyrenees _(LFBP)_","Cayenne-felix eboue _(SOCA)_","Noumea magenta _(NWWM)_","Clermont-ferrand-auvergne _(LFLC)_","Toulon-hyeres _(LFTH)_","Perpignan-rivesaltes _(LFMP)_","Mayotte-marcel henry _(FMCZ)_","Carcassonne-salvaza _(LFMK)_","Bora bora _(NTTB)_","Lifou _(NWWL)_","Raiatea _(NTTR)_","Limoges-bellegarde _(LFBL)_","Nimes-garons _(LFTW)_","Autres apt (om) _(ZZOM)_","Figari-sud-corse _(LFKF)_","Tarbes-lourdes-pyrenees _(LFBT)_","St-martin-grand-case _(TFFG)_","St-pierre-pierrefonds _(FMEP)_","St-barthelemy _(TFFJ)_","Metz-nancy-lorraine _(LFJL)_","Caen-carpiquet _(LFRK)_","Ile des pins _(NWWE)_","Tours-val de loire _(LFOT)_","Lorient-lann-bihoue _(LFRH)_","Paris-le bourget _(LFPB)_","Ouvea _(NWWV)_","Mare _(NWWR)_","Autres apt (mt) _(ZZMT)_","Calvi-ste-catherine _(LFKC)_","Huahine _(NTTH)_","Dole-tavaux _(LFGJ)_","Bergerac-dordogne-perigord _(LFBE)_","Beziers-vias _(LFMU)_","Dinard-pleurtuit-st-malo _(LFRD)_","Rangiroa _(NTTG)_","Rodez-aveyron _(LFCR)_","Quimper-pluguffan _(LFRQ)_","Poitiers-biard _(LFBI)_","La rochelle-ile de re _(LFBH)_","Wallis-hihifo _(NLWW)_","Chalons-vatry _(LFOK)_","Brive-souillac _(LFSL)_","Moorea _(NTTM)_","Castres-mazamet _(LFCK)_","Nuku hiva _(NTMD)_","Maripasoula _(SOOA)_","Aurillac _(LFLW)_","Agen-la garenne _(LFBA)_","Deauville-normandie _(LFRG)_","Hiva oa-atuona _(NTMN)_","St-pierre-pointe blanche _(LFVP)_","Maupiti _(NTTP)_","Tubuai mataura _(NTAT)_","Tikehau _(NTGC)_","Fakarava _(NTGF)_","Rurutu _(NTAR)_","Courchevel _(LFLJ)_","St-nazaire-montoir _(LFRZ)_","Futuna _(NLWF)_","Raivavae _(NTAV)_","Hao _(NTTO)_","Chateauroux-deols _(LFLX)_","Albert-bray _(LFAQ)_"],"paxdep":[2597751,1161426,367646,355363,340036,293834,222750,195048,170975,128104,112430,111998,91004,63071,54976,43348,39338,38435,35543,34386,30024,29353,29165,26015,24407,24068,19266,18437,15513,15004,13408,13108,10148,9986,8498,7813,7493,7114,6791,6606,6135,6089,6034,5949,5569,5459,5185,5138,4837,4416,4051,3971,3910,3881,3842,3685,3476,3066,2566,2379,2375,2366,2327,2245,2142,2109,2081,1859,1841,1768,1404,1389,1335,1270,1232,1102,1098,1062,1056,1024,1021,596,586,516,493,381,166,119],"paxarr":[2615400,1222901,363372,369899,337295,304546,241617,190208,166728,136452,127167,126329,99705,63662,56499,55449,40479,34913,37206,30939,28119,28587,27115,25320,23858,22375,22073,20461,14817,13973,12783,18977,10011,8632,7489,6972,6798,7021,4781,5597,5610,7609,7181,5160,6060,5241,4635,4927,4083,4603,3955,3573,3445,3260,2943,3954,2924,2995,2137,2055,2051,1848,2225,2125,2123,2269,1788,1092,1497,1548,1247,1209,1178,1275,1030,1031,685,711,789,720,536,804,578,472,222,430,166,124],"paxtra":[2938,54,733,4586,3594,5151,7,4044,2078,83,4768,5137,6007,88,1027,885,137,1848,172,0,0,0,0,11,557,162,1825,0,673,0,0,1202,0,1730,0,3145,24,0,4681,0,0,124,0,0,308,13,0,0,0,0,0,0,70,0,3063,0,0,0,0,1202,0,0,1628,0,0,2,0,1156,0,497,431,0,0,837,488,0,5,535,1192,272,568,0,153,0,277,663,0,0]},"columns":[{"id":"name_clean","name":"<strong>AÃ©roport<\/strong>","type":"character","style":"function(rowInfo, colInfo) {\nconst rowIndex = rowInfo.index + 1\n}","cell":["<div data-qmd=\"Paris-charles de gaulle _(LFPG)_\"><div class='gt_from_md'><p>Paris-charles de gaulle <em>(LFPG)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Paris-orly _(LFPO)_\"><div class='gt_from_md'><p>Paris-orly <em>(LFPO)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Nice-cote d'azur _(LFMN)_\"><div class='gt_from_md'><p>Nice-cote dâ€™azur <em>(LFMN)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Lyon-st-exupery _(LFLL)_\"><div class='gt_from_md'><p>Lyon-st-exupery <em>(LFLL)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Toulouse-blagnac _(LFBO)_\"><div class='gt_from_md'><p>Toulouse-blagnac <em>(LFBO)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Marseille-provence _(LFML)_\"><div class='gt_from_md'><p>Marseille-provence <em>(LFML)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Bale-mulhouse _(LFSB)_\"><div class='gt_from_md'><p>Bale-mulhouse <em>(LFSB)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Bordeaux-merignac _(LFBD)_\"><div class='gt_from_md'><p>Bordeaux-merignac <em>(LFBD)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Nantes-atlantique _(LFRS)_\"><div class='gt_from_md'><p>Nantes-atlantique <em>(LFRS)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Beauvais-tille _(LFOB)_\"><div class='gt_from_md'><p>Beauvais-tille <em>(LFOB)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"La reunion-roland garros _(FMEE)_\"><div class='gt_from_md'><p>La reunion-roland garros <em>(FMEE)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Pointe-a-pitre-le raizet _(TFFR)_\"><div class='gt_from_md'><p>Pointe-a-pitre-le raizet <em>(TFFR)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Martinique-aime cesaire _(TFFF)_\"><div class='gt_from_md'><p>Martinique-aime cesaire <em>(TFFF)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Montpellier-mediterranee _(LFMT)_\"><div class='gt_from_md'><p>Montpellier-mediterranee <em>(LFMT)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Lille-lesquin _(LFQQ)_\"><div class='gt_from_md'><p>Lille-lesquin <em>(LFQQ)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Tahiti faa'a _(NTAA)_\"><div class='gt_from_md'><p>Tahiti faaâ€™a <em>(NTAA)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Strasbourg-entzheim _(LFST)_\"><div class='gt_from_md'><p>Strasbourg-entzheim <em>(LFST)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Brest-bretagne _(LFRB)_\"><div class='gt_from_md'><p>Brest-bretagne <em>(LFRB)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Grenoble-alpes-isere _(LFLS)_\"><div class='gt_from_md'><p>Grenoble-alpes-isere <em>(LFLS)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Biarritz-pays-basque _(LFBZ)_\"><div class='gt_from_md'><p>Biarritz-pays-basque <em>(LFBZ)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Ajaccio-napoleon-bonaparte _(LFKJ)_\"><div class='gt_from_md'><p>Ajaccio-napoleon-bonaparte <em>(LFKJ)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Noumea la tontouta _(NWWW)_\"><div class='gt_from_md'><p>Noumea la tontouta <em>(NWWW)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Bastia-poretta _(LFKB)_\"><div class='gt_from_md'><p>Bastia-poretta <em>(LFKB)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Chambery-aix-les-bains _(LFLB)_\"><div class='gt_from_md'><p>Chambery-aix-les-bains <em>(LFLB)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Rennes-st-jacques _(LFRN)_\"><div class='gt_from_md'><p>Rennes-st-jacques <em>(LFRN)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Pau-pyrenees _(LFBP)_\"><div class='gt_from_md'><p>Pau-pyrenees <em>(LFBP)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Cayenne-felix eboue _(SOCA)_\"><div class='gt_from_md'><p>Cayenne-felix eboue <em>(SOCA)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Noumea magenta _(NWWM)_\"><div class='gt_from_md'><p>Noumea magenta <em>(NWWM)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Clermont-ferrand-auvergne _(LFLC)_\"><div class='gt_from_md'><p>Clermont-ferrand-auvergne <em>(LFLC)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Toulon-hyeres _(LFTH)_\"><div class='gt_from_md'><p>Toulon-hyeres <em>(LFTH)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Perpignan-rivesaltes _(LFMP)_\"><div class='gt_from_md'><p>Perpignan-rivesaltes <em>(LFMP)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Mayotte-marcel henry _(FMCZ)_\"><div class='gt_from_md'><p>Mayotte-marcel henry <em>(FMCZ)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Carcassonne-salvaza _(LFMK)_\"><div class='gt_from_md'><p>Carcassonne-salvaza <em>(LFMK)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Bora bora _(NTTB)_\"><div class='gt_from_md'><p>Bora bora <em>(NTTB)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Lifou _(NWWL)_\"><div class='gt_from_md'><p>Lifou <em>(NWWL)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Raiatea _(NTTR)_\"><div class='gt_from_md'><p>Raiatea <em>(NTTR)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Limoges-bellegarde _(LFBL)_\"><div class='gt_from_md'><p>Limoges-bellegarde <em>(LFBL)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Nimes-garons _(LFTW)_\"><div class='gt_from_md'><p>Nimes-garons <em>(LFTW)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Autres apt (om) _(ZZOM)_\"><div class='gt_from_md'><p>Autres apt (om) <em>(ZZOM)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Figari-sud-corse _(LFKF)_\"><div class='gt_from_md'><p>Figari-sud-corse <em>(LFKF)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Tarbes-lourdes-pyrenees _(LFBT)_\"><div class='gt_from_md'><p>Tarbes-lourdes-pyrenees <em>(LFBT)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"St-martin-grand-case _(TFFG)_\"><div class='gt_from_md'><p>St-martin-grand-case <em>(TFFG)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"St-pierre-pierrefonds _(FMEP)_\"><div class='gt_from_md'><p>St-pierre-pierrefonds <em>(FMEP)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"St-barthelemy _(TFFJ)_\"><div class='gt_from_md'><p>St-barthelemy <em>(TFFJ)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Metz-nancy-lorraine _(LFJL)_\"><div class='gt_from_md'><p>Metz-nancy-lorraine <em>(LFJL)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Caen-carpiquet _(LFRK)_\"><div class='gt_from_md'><p>Caen-carpiquet <em>(LFRK)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Ile des pins _(NWWE)_\"><div class='gt_from_md'><p>Ile des pins <em>(NWWE)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Tours-val de loire _(LFOT)_\"><div class='gt_from_md'><p>Tours-val de loire <em>(LFOT)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Lorient-lann-bihoue _(LFRH)_\"><div class='gt_from_md'><p>Lorient-lann-bihoue <em>(LFRH)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Paris-le bourget _(LFPB)_\"><div class='gt_from_md'><p>Paris-le bourget <em>(LFPB)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Ouvea _(NWWV)_\"><div class='gt_from_md'><p>Ouvea <em>(NWWV)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Mare _(NWWR)_\"><div class='gt_from_md'><p>Mare <em>(NWWR)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Autres apt (mt) _(ZZMT)_\"><div class='gt_from_md'><p>Autres apt (mt) <em>(ZZMT)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Calvi-ste-catherine _(LFKC)_\"><div class='gt_from_md'><p>Calvi-ste-catherine <em>(LFKC)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Huahine _(NTTH)_\"><div class='gt_from_md'><p>Huahine <em>(NTTH)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Dole-tavaux _(LFGJ)_\"><div class='gt_from_md'><p>Dole-tavaux <em>(LFGJ)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Bergerac-dordogne-perigord _(LFBE)_\"><div class='gt_from_md'><p>Bergerac-dordogne-perigord <em>(LFBE)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Beziers-vias _(LFMU)_\"><div class='gt_from_md'><p>Beziers-vias <em>(LFMU)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Dinard-pleurtuit-st-malo _(LFRD)_\"><div class='gt_from_md'><p>Dinard-pleurtuit-st-malo <em>(LFRD)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Rangiroa _(NTTG)_\"><div class='gt_from_md'><p>Rangiroa <em>(NTTG)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Rodez-aveyron _(LFCR)_\"><div class='gt_from_md'><p>Rodez-aveyron <em>(LFCR)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Quimper-pluguffan _(LFRQ)_\"><div class='gt_from_md'><p>Quimper-pluguffan <em>(LFRQ)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Poitiers-biard _(LFBI)_\"><div class='gt_from_md'><p>Poitiers-biard <em>(LFBI)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"La rochelle-ile de re _(LFBH)_\"><div class='gt_from_md'><p>La rochelle-ile de re <em>(LFBH)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Wallis-hihifo _(NLWW)_\"><div class='gt_from_md'><p>Wallis-hihifo <em>(NLWW)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Chalons-vatry _(LFOK)_\"><div class='gt_from_md'><p>Chalons-vatry <em>(LFOK)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Brive-souillac _(LFSL)_\"><div class='gt_from_md'><p>Brive-souillac <em>(LFSL)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Moorea _(NTTM)_\"><div class='gt_from_md'><p>Moorea <em>(NTTM)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Castres-mazamet _(LFCK)_\"><div class='gt_from_md'><p>Castres-mazamet <em>(LFCK)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Nuku hiva _(NTMD)_\"><div class='gt_from_md'><p>Nuku hiva <em>(NTMD)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Maripasoula _(SOOA)_\"><div class='gt_from_md'><p>Maripasoula <em>(SOOA)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Aurillac _(LFLW)_\"><div class='gt_from_md'><p>Aurillac <em>(LFLW)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Agen-la garenne _(LFBA)_\"><div class='gt_from_md'><p>Agen-la garenne <em>(LFBA)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Deauville-normandie _(LFRG)_\"><div class='gt_from_md'><p>Deauville-normandie <em>(LFRG)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Hiva oa-atuona _(NTMN)_\"><div class='gt_from_md'><p>Hiva oa-atuona <em>(NTMN)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"St-pierre-pointe blanche _(LFVP)_\"><div class='gt_from_md'><p>St-pierre-pointe blanche <em>(LFVP)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Maupiti _(NTTP)_\"><div class='gt_from_md'><p>Maupiti <em>(NTTP)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Tubuai mataura _(NTAT)_\"><div class='gt_from_md'><p>Tubuai mataura <em>(NTAT)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Tikehau _(NTGC)_\"><div class='gt_from_md'><p>Tikehau <em>(NTGC)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Fakarava _(NTGF)_\"><div class='gt_from_md'><p>Fakarava <em>(NTGF)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Rurutu _(NTAR)_\"><div class='gt_from_md'><p>Rurutu <em>(NTAR)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Courchevel _(LFLJ)_\"><div class='gt_from_md'><p>Courchevel <em>(LFLJ)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"St-nazaire-montoir _(LFRZ)_\"><div class='gt_from_md'><p>St-nazaire-montoir <em>(LFRZ)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Futuna _(NLWF)_\"><div class='gt_from_md'><p>Futuna <em>(NLWF)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Raivavae _(NTAV)_\"><div class='gt_from_md'><p>Raivavae <em>(NTAV)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Hao _(NTTO)_\"><div class='gt_from_md'><p>Hao <em>(NTTO)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Chateauroux-deols _(LFLX)_\"><div class='gt_from_md'><p>Chateauroux-deols <em>(LFLX)<\/em><\/p>\n<\/div><\/div>","<div data-qmd=\"Albert-bray _(LFAQ)_\"><div class='gt_from_md'><p>Albert-bray <em>(LFAQ)<\/em><\/p>\n<\/div><\/div>"],"html":true,"align":"left","headerStyle":{"font-weight":"normal"}},{"id":"paxdep","name":"<strong>DÃ©parts<\/strong>","type":"numeric","style":"function(rowInfo, colInfo) {\nconst rowIndex = rowInfo.index + 1\n}","cell":["2.60M","1.16M","367.65K","355.36K","340.04K","293.83K","222.75K","195.05K","170.97K","128.10K","112.43K","112.00K","91.00K","63.07K","54.98K","43.35K","39.34K","38.44K","35.54K","34.39K","30.02K","29.35K","29.16K","26.02K","24.41K","24.07K","19.27K","18.44K","15.51K","15.00K","13.41K","13.11K","10.15K","9.99K","8.50K","7.81K","7.49K","7.11K","6.79K","6.61K","6.13K","6.09K","6.03K","5.95K","5.57K","5.46K","5.19K","5.14K","4.84K","4.42K","4.05K","3.97K","3.91K","3.88K","3.84K","3.69K","3.48K","3.07K","2.57K","2.38K","2.38K","2.37K","2.33K","2.25K","2.14K","2.11K","2.08K","1.86K","1.84K","1.77K","1.40K","1.39K","1.33K","1.27K","1.23K","1.10K","1.10K","1.06K","1.06K","1.02K","1.02K","596.00","586.00","516.00","493.00","381.00","166.00","119.00"],"html":true,"align":"right","headerStyle":{"font-weight":"normal"}},{"id":"paxarr","name":"<strong>ArrivÃ©e<\/strong>","type":"numeric","style":"function(rowInfo, colInfo) {\nconst rowIndex = rowInfo.index + 1\n}","cell":["2.62M","1.22M","363.37K","369.90K","337.30K","304.55K","241.62K","190.21K","166.73K","136.45K","127.17K","126.33K","99.70K","63.66K","56.50K","55.45K","40.48K","34.91K","37.21K","30.94K","28.12K","28.59K","27.12K","25.32K","23.86K","22.38K","22.07K","20.46K","14.82K","13.97K","12.78K","18.98K","10.01K","8.63K","7.49K","6.97K","6.80K","7.02K","4.78K","5.60K","5.61K","7.61K","7.18K","5.16K","6.06K","5.24K","4.63K","4.93K","4.08K","4.60K","3.96K","3.57K","3.45K","3.26K","2.94K","3.95K","2.92K","3.00K","2.14K","2.06K","2.05K","1.85K","2.23K","2.12K","2.12K","2.27K","1.79K","1.09K","1.50K","1.55K","1.25K","1.21K","1.18K","1.28K","1.03K","1.03K","685.00","711.00","789.00","720.00","536.00","804.00","578.00","472.00","222.00","430.00","166.00","124.00"],"html":true,"align":"right","headerStyle":{"font-weight":"normal"}},{"id":"paxtra","name":"<strong>Transit<\/strong>","type":"numeric","style":"function(rowInfo, colInfo) {\nconst rowIndex = rowInfo.index + 1\n}","cell":["2.94K","54.00","733.00","4.59K","3.59K","5.15K","7.00","4.04K","2.08K","83.00","4.77K","5.14K","6.01K","88.00","1.03K","885.00","137.00","1.85K","172.00","0.00","0.00","0.00","0.00","11.00","557.00","162.00","1.82K","0.00","673.00","0.00","0.00","1.20K","0.00","1.73K","0.00","3.15K","24.00","0.00","4.68K","0.00","0.00","124.00","0.00","0.00","308.00","13.00","0.00","0.00","0.00","0.00","0.00","0.00","70.00","0.00","3.06K","0.00","0.00","0.00","0.00","1.20K","0.00","0.00","1.63K","0.00","0.00","2.00","0.00","1.16K","0.00","497.00","431.00","0.00","0.00","837.00","488.00","0.00","5.00","535.00","1.19K","272.00","568.00","0.00","153.00","0.00","277.00","663.00","0.00","0.00"],"html":true,"align":"right","headerStyle":{"font-weight":"normal"}}],"defaultPageSize":10,"showPageSizeOptions":false,"pageSizeOptions":[10,25,50,100],"paginationType":"numbers","showPagination":true,"showPageInfo":true,"minRows":1,"showSortable":true,"height":"auto","theme":{"color":"#333333","backgroundColor":"#FFFFFF","stripedColor":"rgba(128,128,128,0.05)","style":{"fontFamily":"system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif"},"headerStyle":{"borderTopStyle":"solid","borderTopWidth":"2px","borderTopColor":"#D3D3D3","borderBottomStyle":"solid","borderBottomWidth":"2px","borderBottomColor":"#D3D3D3"}},"elementId":"ejpsivxdgg","dataKey":"311275f30a10f35b729f971f7eabd324"},"children":[]},"class":"reactR_markup"},"evals":["tag.attribs.columns.0.style","tag.attribs.columns.1.style","tag.attribs.columns.2.style","tag.attribs.columns.3.style"],"jsHooks":[]}</script>
</div>
</div>
</div>
</div>
<div id="tabset-28-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-28-2-tab">
<details>
<summary>
Solution suggÃ©rÃ©e pour lâ€™exercice ci-dessus
</summary>
<div class="sourceCode" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>table_gt <span class="op">=</span> (</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>  GT(stats_aeroports.head(<span class="dv">15</span>))</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  .cols_hide(columns <span class="op">=</span> stats_aeroports.<span class="bu">filter</span>(like <span class="op">=</span> <span class="st">"apt"</span>).columns.tolist())</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>  .fmt_number(columns <span class="op">=</span> stats_aeroports.<span class="bu">filter</span>(like <span class="op">=</span> <span class="st">"pax"</span>).columns.tolist(), compact <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>  .fmt_markdown(columns <span class="op">=</span> <span class="st">"name_clean"</span>)</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>  .cols_label(</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>    name_clean <span class="op">=</span> md(<span class="st">"**AÃ©roport**"</span>),</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>    paxdep <span class="op">=</span> md(<span class="st">"**DÃ©parts**"</span>),</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>    paxarr <span class="op">=</span> md(<span class="st">"**ArrivÃ©e**"</span>),</span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>    paxtr <span class="op">=</span> md(<span class="st">"**Transit**"</span>)</span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a>  .tab_header(</span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a>    title <span class="op">=</span> md(<span class="st">"**Statistiques de frÃ©quentation**"</span>),</span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a>    subtitle <span class="op">=</span> md(<span class="st">"Classement des aÃ©roports"</span>)</span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a>  .tab_source_note(</span>
<span id="cb78-17"><a href="#cb78-17" aria-hidden="true" tabindex="-1"></a>    source_note <span class="op">=</span> md(<span class="st">"_Source: DGAC, Ã  partir des donnÃ©es sur data.gouv.fr_"</span>)</span>
<span id="cb78-18"><a href="#cb78-18" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb78-19"><a href="#cb78-19" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
<p>Nous proposons de transformer ce code en fonction, cela facilitera lâ€™utilisation ultÃ©rieure de celui-ci dans notre application.</p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-14-contents" aria-controls="callout-14" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<i class="bi bi-book"></i> Exercice 4c (optionnel): transformer en fonction notre chaÃ®ne <code>gt</code>
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-14" class="callout-14-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Cet exercice est optionnel. Transformer le code ci-dessus en fonction qui sera enregistrÃ©e dans <code>R/tables.R</code> (<i class="fa-brands fa-r-project" aria-label="r-project"></i>) ou <code>src/tables.py</code> (<i class="fa-brands fa-python" aria-label="python"></i>). Mettre Ã  jour <code>main.R</code> ou <code>main.py</code> pour utiliser ceci dans votre application.</p>
</div>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-29-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-29-1" role="tab" aria-controls="tabset-29-1" aria-selected="true"><i class="fa-brands fa-r-project" aria-label="r-project"></i></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-29-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-29-2" role="tab" aria-controls="tabset-29-2" aria-selected="false"><i class="fa-brands fa-python" aria-label="python"></i></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-29-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-29-1-tab">
<details>
<summary>
Code de <code>R/tables.R</code>
</summary>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R/tables.R</strong></pre>
</div>
<div class="sourceCode" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>create_table_airports <span class="ot">&lt;-</span> <span class="cf">function</span>(stats_aeroports){</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>  stats_aeroports_table <span class="ot">&lt;-</span> stats_aeroports <span class="sc">%&gt;%</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">name_clean =</span> <span class="fu">paste0</span>(<span class="fu">str_to_sentence</span>(apt_nom), <span class="st">" _("</span>, apt, <span class="st">")_"</span>)</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(name_clean, <span class="fu">everything</span>())</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>  table_aeroports <span class="ot">&lt;-</span> <span class="fu">gt</span>(stats_aeroports_table)</span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>  table_aeroports <span class="ot">&lt;-</span> table_aeroports <span class="sc">%&gt;%</span></span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cols_hide</span>(<span class="at">columns =</span> <span class="fu">starts_with</span>(<span class="st">"apt"</span>))</span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a>  table_aeroports <span class="ot">&lt;-</span> table_aeroports <span class="sc">%&gt;%</span></span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="fu">starts_with</span>(<span class="st">"pax"</span>), <span class="at">suffixing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a>  table_aeroports <span class="ot">&lt;-</span> table_aeroports <span class="sc">%&gt;%</span></span>
<span id="cb79-17"><a href="#cb79-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fmt_markdown</span>(<span class="at">columns =</span> <span class="st">"name_clean"</span>)</span>
<span id="cb79-18"><a href="#cb79-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb79-19"><a href="#cb79-19" aria-hidden="true" tabindex="-1"></a>  table_aeroports <span class="ot">&lt;-</span> table_aeroports <span class="sc">%&gt;%</span></span>
<span id="cb79-20"><a href="#cb79-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cols_label</span>(</span>
<span id="cb79-21"><a href="#cb79-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">name_clean =</span> <span class="fu">md</span>(<span class="st">"**AÃ©roport**"</span>),</span>
<span id="cb79-22"><a href="#cb79-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">paxdep =</span> <span class="fu">md</span>(<span class="st">"**DÃ©parts**"</span>),</span>
<span id="cb79-23"><a href="#cb79-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">paxarr =</span> <span class="fu">md</span>(<span class="st">"**ArrivÃ©e**"</span>),</span>
<span id="cb79-24"><a href="#cb79-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">paxtra =</span> <span class="fu">md</span>(<span class="st">"**Transit**"</span>)</span>
<span id="cb79-25"><a href="#cb79-25" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb79-26"><a href="#cb79-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tab_header</span>(</span>
<span id="cb79-27"><a href="#cb79-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">md</span>(<span class="st">"**Statistiques de frÃ©quentation**"</span>),</span>
<span id="cb79-28"><a href="#cb79-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="fu">md</span>(<span class="st">"Classement des aÃ©roports"</span>)</span>
<span id="cb79-29"><a href="#cb79-29" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb79-30"><a href="#cb79-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tab_style</span>(</span>
<span id="cb79-31"><a href="#cb79-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">style =</span> <span class="fu">cell_fill</span>(<span class="at">color =</span> <span class="st">"powderblue"</span>),</span>
<span id="cb79-32"><a href="#cb79-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">locations =</span> <span class="fu">cells_title</span>()</span>
<span id="cb79-33"><a href="#cb79-33" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb79-34"><a href="#cb79-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tab_source_note</span>(<span class="at">source_note =</span> <span class="fu">md</span>(<span class="st">"_Source: DGAC, Ã  partir des donnÃ©es sur data.gouv.fr_"</span>))</span>
<span id="cb79-35"><a href="#cb79-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb79-36"><a href="#cb79-36" aria-hidden="true" tabindex="-1"></a>  table_aeroports <span class="ot">&lt;-</span> table_aeroports <span class="sc">%&gt;%</span></span>
<span id="cb79-37"><a href="#cb79-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">opt_interactive</span>()</span>
<span id="cb79-38"><a href="#cb79-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb79-39"><a href="#cb79-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(table_aeroports)</span>
<span id="cb79-40"><a href="#cb79-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-41"><a href="#cb79-41" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<details>
<summary>
Code de <code>main.R</code>
</summary>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>main.R</strong></pre>
</div>
<div class="sourceCode" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"correction/R/import_data.R"</span>)</span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"correction/R/create_data_list.R"</span>)</span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"correction/R/clean_dataframe.R"</span>)</span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"correction/R/divers_functions.R"</span>)</span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"correction/R/tables.R"</span>)</span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"correction/R/figures.R"</span>)</span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a>YEARS_LIST  <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="dv">2018</span><span class="sc">:</span><span class="dv">2022</span>)</span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a>MONTHS_LIST <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span></span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a>year <span class="ot">&lt;-</span> YEARS_LIST[<span class="dv">1</span>]</span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a>month <span class="ot">&lt;-</span> MONTHS_LIST[<span class="dv">1</span>]</span>
<span id="cb80-21"><a href="#cb80-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-22"><a href="#cb80-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-23"><a href="#cb80-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data ----------------------------------</span></span>
<span id="cb80-24"><a href="#cb80-24" aria-hidden="true" tabindex="-1"></a>urls <span class="ot">&lt;-</span> <span class="fu">create_data_list</span>(<span class="st">"./sources.yml"</span>)</span>
<span id="cb80-25"><a href="#cb80-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-26"><a href="#cb80-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-27"><a href="#cb80-27" aria-hidden="true" tabindex="-1"></a>pax_apt_all <span class="ot">&lt;-</span> <span class="fu">import_airport_data</span>(<span class="fu">unlist</span>(urls<span class="sc">$</span>airports))</span>
<span id="cb80-28"><a href="#cb80-28" aria-hidden="true" tabindex="-1"></a>pax_cie_all <span class="ot">&lt;-</span> <span class="fu">import_compagnies_data</span>(<span class="fu">unlist</span>(urls<span class="sc">$</span>compagnies))</span>
<span id="cb80-29"><a href="#cb80-29" aria-hidden="true" tabindex="-1"></a>pax_lsn_all <span class="ot">&lt;-</span> <span class="fu">import_liaisons_data</span>(<span class="fu">unlist</span>(urls<span class="sc">$</span>liaisons))</span>
<span id="cb80-30"><a href="#cb80-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-31"><a href="#cb80-31" aria-hidden="true" tabindex="-1"></a>airports_location <span class="ot">&lt;-</span> <span class="fu">st_read</span>(urls<span class="sc">$</span>geojson<span class="sc">$</span>airport)</span>
<span id="cb80-32"><a href="#cb80-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-33"><a href="#cb80-33" aria-hidden="true" tabindex="-1"></a>liste_aeroports <span class="ot">&lt;-</span> <span class="fu">unique</span>(pax_apt_all<span class="sc">$</span>apt)</span>
<span id="cb80-34"><a href="#cb80-34" aria-hidden="true" tabindex="-1"></a>default_airport <span class="ot">&lt;-</span> liste_aeroports[<span class="dv">1</span>]</span>
<span id="cb80-35"><a href="#cb80-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-36"><a href="#cb80-36" aria-hidden="true" tabindex="-1"></a><span class="co"># OBJETS NECESSAIRES A L'APPLICATION ------------------------</span></span>
<span id="cb80-37"><a href="#cb80-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-38"><a href="#cb80-38" aria-hidden="true" tabindex="-1"></a>trafic_aeroports <span class="ot">&lt;-</span> pax_apt_all <span class="sc">%&gt;%</span></span>
<span id="cb80-39"><a href="#cb80-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">trafic =</span> apt_pax_dep <span class="sc">+</span> apt_pax_tr <span class="sc">+</span> apt_pax_arr) <span class="sc">%&gt;%</span></span>
<span id="cb80-40"><a href="#cb80-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(apt <span class="sc">%in%</span> default_airport) <span class="sc">%&gt;%</span></span>
<span id="cb80-41"><a href="#cb80-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb80-42"><a href="#cb80-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">as.Date</span>(<span class="fu">paste</span>(anmois, <span class="st">"01"</span>, <span class="at">sep=</span><span class="st">""</span>), <span class="at">format =</span> <span class="st">"%Y%m%d"</span>)</span>
<span id="cb80-43"><a href="#cb80-43" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb80-44"><a href="#cb80-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-45"><a href="#cb80-45" aria-hidden="true" tabindex="-1"></a>stats_aeroports <span class="ot">&lt;-</span> <span class="fu">summary_stat_airport</span>(</span>
<span id="cb80-46"><a href="#cb80-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">create_data_from_input</span>(pax_apt_all, year, month)</span>
<span id="cb80-47"><a href="#cb80-47" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb80-48"><a href="#cb80-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-49"><a href="#cb80-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-50"><a href="#cb80-50" aria-hidden="true" tabindex="-1"></a><span class="co"># VALORISATIONS ----------------------------------------------</span></span>
<span id="cb80-51"><a href="#cb80-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-52"><a href="#cb80-52" aria-hidden="true" tabindex="-1"></a>figure_plotly <span class="ot">&lt;-</span> <span class="fu">plot_airport_line</span>(trafic_aeroports,default_airport)</span>
<span id="cb80-53"><a href="#cb80-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-54"><a href="#cb80-54" aria-hidden="true" tabindex="-1"></a>table_airports <span class="ot">&lt;-</span> <span class="fu">create_table_airports</span>(stats_aeroports)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
</div>
<div id="tabset-29-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-29-2-tab">
<details>
<summary>
Code de <code>src/tables.py</code>
</summary>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>stc/tables.py</strong></pre>
</div>
<div class="sourceCode" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> great_tables <span class="im">import</span> GT, md</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_table_airports(stats_aeroports):</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>    stats_aeroports[<span class="st">'name_clean'</span>] <span class="op">=</span> stats_aeroports[<span class="st">'apt_nom'</span>].<span class="bu">str</span>.title() <span class="op">+</span> <span class="st">" _("</span> <span class="op">+</span> stats_aeroports[<span class="st">'apt'</span>] <span class="op">+</span> <span class="st">")_"</span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>    stats_aeroports <span class="op">=</span> stats_aeroports[ [<span class="st">'name_clean'</span>] <span class="op">+</span> [ col <span class="cf">for</span> col <span class="kw">in</span> stats_aeroports.columns <span class="cf">if</span> col <span class="op">!=</span> <span class="st">'name_clean'</span> ] ]</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>    table_gt <span class="op">=</span> (</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>        GT(stats_aeroports.head(<span class="dv">15</span>))</span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>        .cols_hide(columns <span class="op">=</span> stats_aeroports.<span class="bu">filter</span>(like <span class="op">=</span> <span class="st">"apt"</span>).columns.tolist())</span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>        .fmt_number(columns <span class="op">=</span> stats_aeroports.<span class="bu">filter</span>(like <span class="op">=</span> <span class="st">"pax"</span>).columns.tolist(), compact <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>        .fmt_markdown(columns <span class="op">=</span> <span class="st">"name_clean"</span>)</span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>        .cols_label(</span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a>            name_clean <span class="op">=</span> md(<span class="st">"**AÃ©roport**"</span>),</span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a>            paxdep <span class="op">=</span> md(<span class="st">"**DÃ©parts**"</span>),</span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a>            paxarr <span class="op">=</span> md(<span class="st">"**ArrivÃ©e**"</span>),</span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a>            paxtr <span class="op">=</span> md(<span class="st">"**Transit**"</span>)</span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a>        ) </span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a>        .tab_header(</span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a>            title <span class="op">=</span> md(<span class="st">"**Statistiques de frÃ©quentation**"</span>),</span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a>            subtitle <span class="op">=</span> md(<span class="st">"Classement des aÃ©roports"</span>)</span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb81-23"><a href="#cb81-23" aria-hidden="true" tabindex="-1"></a>        .tab_source_note(source_note <span class="op">=</span> md(<span class="st">"_Source: DGAC, Ã  partir des donnÃ©es sur data.gouv.fr_"</span>))</span>
<span id="cb81-24"><a href="#cb81-24" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb81-25"><a href="#cb81-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-26"><a href="#cb81-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> table_gt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<details>
<summary>
Code de <code>main.py</code>
</summary>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>main.py</strong></pre>
</div>
<div class="sourceCode" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> src.import_data <span class="im">as</span> sid</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> src.create_data_list <span class="im">import</span> create_data_list</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> src.divers_functions <span class="im">import</span> (</span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>  create_data_from_input,</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>  summary_stat_airport</span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> src.tables <span class="im">import</span> create_table_airports</span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a>YEARS_LIST <span class="op">=</span> [<span class="bu">str</span>(year) <span class="cf">for</span> year <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2018</span>, <span class="dv">2023</span>)]</span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a>MONTHS_LIST <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">13</span>))</span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a>year <span class="op">=</span> YEARS_LIST[<span class="dv">0</span>]</span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a>month <span class="op">=</span> MONTHS_LIST[<span class="dv">0</span>]</span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data ----------------------------------</span></span>
<span id="cb82-20"><a href="#cb82-20" aria-hidden="true" tabindex="-1"></a>urls <span class="op">=</span> create_data_list(<span class="st">"./sources.yml"</span>)</span>
<span id="cb82-21"><a href="#cb82-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-22"><a href="#cb82-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-23"><a href="#cb82-23" aria-hidden="true" tabindex="-1"></a>pax_apt_all <span class="op">=</span> sid.import_airport_data(urls[<span class="st">'airports'</span>].values())</span>
<span id="cb82-24"><a href="#cb82-24" aria-hidden="true" tabindex="-1"></a>pax_cie_all <span class="op">=</span> sid.import_airport_data(urls[<span class="st">'compagnies'</span>].values())</span>
<span id="cb82-25"><a href="#cb82-25" aria-hidden="true" tabindex="-1"></a>pax_lsn_all <span class="op">=</span> sid.import_airport_data(urls[<span class="st">'liaisons'</span>].values())</span>
<span id="cb82-26"><a href="#cb82-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-27"><a href="#cb82-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-28"><a href="#cb82-28" aria-hidden="true" tabindex="-1"></a>airports_location <span class="op">=</span> gpd.read_file(</span>
<span id="cb82-29"><a href="#cb82-29" aria-hidden="true" tabindex="-1"></a>    urls[<span class="st">'geojson'</span>][<span class="st">'airport'</span>]</span>
<span id="cb82-30"><a href="#cb82-30" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb82-31"><a href="#cb82-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-32"><a href="#cb82-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-33"><a href="#cb82-33" aria-hidden="true" tabindex="-1"></a>liste_aeroports <span class="op">=</span> pax_apt_all[<span class="st">'apt'</span>].unique()</span>
<span id="cb82-34"><a href="#cb82-34" aria-hidden="true" tabindex="-1"></a>default_airport <span class="op">=</span> liste_aeroports[<span class="dv">0</span>]</span>
<span id="cb82-35"><a href="#cb82-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-36"><a href="#cb82-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-37"><a href="#cb82-37" aria-hidden="true" tabindex="-1"></a><span class="co"># OBJETS NECESSAIRES A L'APPLICATION ------------------------</span></span>
<span id="cb82-38"><a href="#cb82-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-39"><a href="#cb82-39" aria-hidden="true" tabindex="-1"></a>pax_apt_all[<span class="st">'trafic'</span>] <span class="op">=</span> pax_apt_all[<span class="st">'apt_pax_dep'</span>] <span class="op">+</span> <span class="op">\</span></span>
<span id="cb82-40"><a href="#cb82-40" aria-hidden="true" tabindex="-1"></a>  pax_apt_all[<span class="st">'apt_pax_tr'</span>] <span class="op">+</span> <span class="op">\</span></span>
<span id="cb82-41"><a href="#cb82-41" aria-hidden="true" tabindex="-1"></a>  pax_apt_all[<span class="st">'apt_pax_arr'</span>]</span>
<span id="cb82-42"><a href="#cb82-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-43"><a href="#cb82-43" aria-hidden="true" tabindex="-1"></a>trafic_aeroports <span class="op">=</span> (</span>
<span id="cb82-44"><a href="#cb82-44" aria-hidden="true" tabindex="-1"></a>  pax_apt_all</span>
<span id="cb82-45"><a href="#cb82-45" aria-hidden="true" tabindex="-1"></a>  .loc[pax_apt_all[<span class="st">'apt'</span>] <span class="op">==</span> default_airport]</span>
<span id="cb82-46"><a href="#cb82-46" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb82-47"><a href="#cb82-47" aria-hidden="true" tabindex="-1"></a>trafic_aeroports[<span class="st">'date'</span>] <span class="op">=</span> pd.to_datetime(</span>
<span id="cb82-48"><a href="#cb82-48" aria-hidden="true" tabindex="-1"></a>  trafic_aeroports[<span class="st">'anmois'</span>] <span class="op">+</span> <span class="st">'01'</span>, <span class="bu">format</span><span class="op">=</span><span class="st">'%Y%m</span><span class="sc">%d</span><span class="st">'</span></span>
<span id="cb82-49"><a href="#cb82-49" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb82-50"><a href="#cb82-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-51"><a href="#cb82-51" aria-hidden="true" tabindex="-1"></a>stats_aeroports <span class="op">=</span> summary_stat_airport(</span>
<span id="cb82-52"><a href="#cb82-52" aria-hidden="true" tabindex="-1"></a>  create_data_from_input(pax_apt_all, year, month)</span>
<span id="cb82-53"><a href="#cb82-53" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb82-54"><a href="#cb82-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-55"><a href="#cb82-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-56"><a href="#cb82-56" aria-hidden="true" tabindex="-1"></a><span class="co"># VALORISATIONS ----------------------------------------------</span></span>
<span id="cb82-57"><a href="#cb82-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-58"><a href="#cb82-58" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> src.figures <span class="im">import</span> plot_airport_line</span>
<span id="cb82-59"><a href="#cb82-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-60"><a href="#cb82-60" aria-hidden="true" tabindex="-1"></a>figure_plotly <span class="op">=</span> plot_airport_line(trafic_aeroports, default_airport)</span>
<span id="cb82-61"><a href="#cb82-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-62"><a href="#cb82-62" aria-hidden="true" tabindex="-1"></a>table_airports <span class="op">=</span> create_table_airports(stats_aeroports)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
</div>
</div>
</div>
</section>
<section id="valorisation-3-carte-des-aÃ©roports" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="valorisation-3-carte-des-aÃ©roports"><span class="header-section-number">4.5</span> Valorisation 3: Carte des aÃ©roports</h2>
<p>La troisiÃ¨me valorisation qui sera intÃ©grÃ©e dans lâ€™application web est une carte interactive du trafic de nos aÃ©roports. Cette carte va Ãªtre assez basique. Si vous dÃ©sirez mettre en oeuvre des visualisations plus complexes, vous pouvez tout Ã  fait le faire.</p>
<p>Pour cet exercice, nous allons fixer une date pour prototyper notre code. Cela nous facilitera la transformation ultÃ©rieure en fonction.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-30-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-30-1" role="tab" aria-controls="tabset-30-1" aria-selected="true"><i class="fa-brands fa-r-project" aria-label="r-project"></i></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-30-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-30-2" role="tab" aria-controls="tabset-30-2" aria-selected="false"><i class="fa-brands fa-python" aria-label="python"></i></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-30-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-30-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>month <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>year <span class="ot">&lt;-</span> <span class="dv">2019</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Voici Ã©galement une palette de couleurs qui sera utile Ã  la fin de lâ€™exercice.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>palette <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"green"</span>, <span class="st">"blue"</span>, <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-30-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-30-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>month <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>year <span class="ot">=</span> <span class="dv">2019</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Voici Ã©galement une palette de couleurs qui sera utile Ã  la fin de lâ€™exercice.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>palette <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"green"</span>, <span class="st">"blue"</span>, <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-16-contents" aria-controls="callout-16" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<i class="bi bi-book"></i> Exercice 5: carte aÃ©rienne du trafic aÃ©roportuaire
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-16" class="callout-16-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<ol type="1">
<li>CrÃ©er un <em>dataframe</em> <code>trafic_date</code> en ne conservant que les observations de <code>pax_apt_all</code> Ã©gales Ã  un certain mois et une certaine annÃ©e (vous pouvez vous inspirer dâ€™un filtre fait prÃ©cÃ©demment).</li>
<li>Ajouter ces informations Ã  la table <code>airports_location</code> en faisant une jointure sur les variables <code>Code.OACI</code> et <code>apt</code>, respectivement. Nommer ce <em>dataframe</em> <code>trafic_aeroports</code>.</li>
<li>A partir de lâ€™<a href="https://rstudio.github.io/leaflet/articles/markers.html">exemple de dÃ©marrage de <code>leaflet</code></a> <i class="fa-brands fa-r-project" aria-label="r-project"></i> ou de lâ€™<a href="https://python-visualization.github.io/folium/latest/getting_started.html#Adding-markers">exemple canonique <code>folium</code></a> (<i class="fa-brands fa-python" aria-label="python"></i>), crÃ©er une carte interactive qui affiche, lorsquâ€™on clique sur lâ€™un des marqueurs, le nom de lâ€™aÃ©roport et sa frÃ©quentation.</li>
<li>CrÃ©er une variable nommÃ©e <code>volume</code> qui classe chaque observation dans son <a href="https://fr.wiktionary.org/wiki/tercile">tercile</a> et transforme la valeur en couleur Ã  partir de <code>palette</code>.<br>
</li>
<li>Reproduire une carte similaire Ã  celle prÃ©sentÃ©e plus bas:
<ul>
<li>En <i class="fa-brands fa-r-project" aria-label="r-project"></i>, vous aurez besoin de la <a href="https://rstudio.github.io/leaflet/articles/markers.html#awesome-icons">fonction <code>addAwesomeMarkers</code></a> et de lâ€™exemple de code ci-dessous:</li>
</ul></li>
</ol>
<div class="sourceCode" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Aide pour l'exemple R</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>icons <span class="ot">&lt;-</span> <span class="fu">awesomeIcons</span>(</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">icon =</span> <span class="st">'plane'</span>,</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">iconColor =</span> <span class="st">'black'</span>,</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">library =</span> <span class="st">'fa'</span>,</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">markerColor =</span> trafic_aeroports<span class="sc">$</span>color</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>* En , il vous suffit de modifier les paramÃ¨tres de l'argument `icon`</code></pre>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-15-contents" aria-controls="callout-15" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
SubtilitÃ© par rapport Ã  lâ€™exemple de <a href="https://rstudio.github.io/leaflet/articles/markers.html#awesome-icons">la documentation</a> pour <i class="fa-brands fa-r-project" aria-label="r-project"></i>
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-15" class="callout-15-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Par rapport Ã  lâ€™exemple dans <a href="https://rstudio.github.io/leaflet/articles/markers.html#awesome-icons">la documentation</a>, il faut lÃ©gÃ¨rement modifier le code de sorte Ã  faire <code>icon=icons[]</code> et non <code>icon = icons</code>.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-31-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-31-1" role="tab" aria-controls="tabset-31-1" aria-selected="true"><i class="fa-brands fa-r-project" aria-label="r-project"></i></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-31-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-31-2" role="tab" aria-controls="tabset-31-2" aria-selected="false"><i class="fa-brands fa-python" aria-label="python"></i></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-31-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-31-1-tab">
<div class="cell">
<details>
<summary>Question 1</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>trafic_date <span class="ot">&lt;-</span> pax_apt_all <span class="sc">%&gt;%</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">as.Date</span>(<span class="fu">paste</span>(anmois, <span class="st">"01"</span>, <span class="at">sep=</span><span class="st">""</span>), <span class="at">format =</span> <span class="st">"%Y%m%d"</span>)</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(mois <span class="sc">==</span> month, an <span class="sc">==</span> year)</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>trafic_aeroports <span class="ot">&lt;-</span> airports_location <span class="sc">%&gt;%</span></span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(trafic_date, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"Code.OACI"</span> <span class="ot">=</span> <span class="st">"apt"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Question 2</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a><span class="fu">leaflet</span>(trafic_aeroports) <span class="sc">%&gt;%</span> <span class="fu">addTiles</span>() <span class="sc">%&gt;%</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addMarkers</span>(<span class="at">popup =</span> <span class="sc">~</span><span class="fu">paste0</span>(Nom, <span class="st">": "</span>, trafic)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Question 3</summary>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>trafic_aeroports <span class="ot">&lt;-</span> trafic_aeroports <span class="sc">%&gt;%</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">volume =</span> <span class="fu">ntile</span>(trafic, <span class="dv">3</span>)</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> palette[volume]</span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Question 4</summary>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>icons <span class="ot">&lt;-</span> <span class="fu">awesomeIcons</span>(</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">icon =</span> <span class="st">'plane'</span>,</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">iconColor =</span> <span class="st">'black'</span>,</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">library =</span> <span class="st">'fa'</span>,</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">markerColor =</span> trafic_aeroports<span class="sc">$</span>color</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>carte_interactive <span class="ot">&lt;-</span> <span class="fu">leaflet</span>(trafic_aeroports) <span class="sc">%&gt;%</span> <span class="fu">addTiles</span>() <span class="sc">%&gt;%</span></span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addAwesomeMarkers</span>(</span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">icon=</span>icons[],</span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">label=</span><span class="sc">~</span><span class="fu">paste0</span>(Nom, <span class="st">""</span>, <span class="st">" ("</span>,Code.OACI, <span class="st">") : "</span>, trafic, <span class="st">" voyageurs"</span>)</span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="tabset-31-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-31-2-tab">
<p>Voir la solution de lâ€™exercice suivant</p>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div class="leaflet html-widget html-fill-item" id="htmlwidget-62c4c787f1bc4c9a0ed4" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-62c4c787f1bc4c9a0ed4">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"https://openstreetmap.org/copyright/\">OpenStreetMap<\/a>,  <a href=\"https://opendatacommons.org/licenses/odbl/\">ODbL<\/a>"}]},{"method":"addAwesomeMarkers","args":[[-23.37,-22.59,-22.43,-22.26,-22.01,-21.48,-20.89,-20.77,-20.64,-17.55,-17.49,-16.72,-16.69,-16.44,-16.43,-16.05,-15.12,-14.95,-12.81,-9.77,-8.800000000000001,3.66,4.82,14.59,16.27,17.9,18.1,41.5,41.92,42.52,42.55,42.74,43.1,43.19,43.32,43.38,43.44,43.47,43.56,43.58,43.64,43.67,44.83,44.9,45.04,45.73,45.79,46.76,47.04,47.16,47.31,47.43,47.59,48.07,48.45,48.54,48.72,48.77,48.97,49.01,49.17,49.45,50.56],[-149.52,167.46,-151.36,166.47,166.21,168.04,55.51,167.24,166.57,-149.61,-149.76,-151.47,-151.02,-151.75,-152.24,-145.66,-148.23,-147.66,45.28,-139.01,-140.23,-54.04,-52.36,-61,-61.53,-62.84,-63.05,9.1,8.800000000000001,8.789999999999999,9.48,2.87,6.15,0.01,3.35,-0.42,5.22,-1.53,2.29,3.96,1.37,7.22,-0.72,2.42,1.49,5.08,3.16,-56.17,5.44,-1.61,-2.16,0.72,7.53,-1.73,-4.42,7.63,2.38,4.21,2.44,2.55,-0.45,2.11,3.09],{"icon":"plane","markerColor":["green","blue","green","red","green","blue","blue","blue","blue","red","green","blue","blue","blue","green","green","green","green","blue","green","green","green","blue","red","red","blue","blue","red","red","blue","red","blue","blue","green","green","blue","red","red","green","red","red","red","red","green","green","red","blue","green","green","red","green","green","red","blue","red","blue","red","green","blue","red","blue","red","red"],"iconColor":"black","spin":false,"squareMarker":false,"iconRotate":0,"font":"monospace","prefix":"fa"},null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},null,null,null,null,["TUBUAI MATAURA (NTAT) : 1667 voyageurs","ILE DES PINS (NWWE) : 6986 voyageurs","RURUTU (NTAR) : 1565 voyageurs","NOUMEA MAGENTA (NWWM) : 33611 voyageurs","NOUMEA LA TONTOUTA (NWWW) : 2523 voyageurs","MARE (NWWR) : 7199 voyageurs","LA REUNION-ROLAND GARROS (FMEE) : 26638 voyageurs","LIFOU (NWWL) : 14180 voyageurs","OUVEA (NWWV) : 6076 voyageurs","TAHITI FAA'A (NTAA) : 48915 voyageurs","MOOREA (NTTM) : 1324 voyageurs","RAIATEA (NTTR) : 15164 voyageurs","HUAHINE (NTTH) : 8570 voyageurs","BORA BORA (NTTB) : 11853 voyageurs","MAUPITI (NTTP) : 1636 voyageurs","FAKARAVA (NTGF) : 1812 voyageurs","TIKEHAU (NTGC) : 2472 voyageurs","RANGIROA (NTTG) : 4737 voyageurs","MAYOTTE-DZAOUDZI-PAMANDZI (FMCZ) : 9618 voyageurs","HIVA OA-ATUONA (NTMN) : 2386 voyageurs","NUKU HIVA (NTMD) : 2575 voyageurs","MARIPASOULA (SOOA) : 2333 voyageurs","CAYENNE-FELIX EBOUE (SOCA) : 12828 voyageurs","MARTINIQUE-AIME CESAIRE (TFFF) : 36952 voyageurs","POINTE-A-PITRE-LE RAIZET (TFFR) : 48447 voyageurs","ST-BARTHELEMY (TFFJ) : 10133 voyageurs","ST-MARTIN-GRAND-CASE (TFFG) : 7938 voyageurs","FIGARI-SUD-CORSE (LFKF) : 59538 voyageurs","AJACCIO-NAPOLEON-BONAPARTE (LFKJ) : 106167 voyageurs","CALVI-STE-CATHERINE (LFKC) : 16073 voyageurs","BASTIA-PORETTA (LFKB) : 82308 voyageurs","PERPIGNAN-RIVESALTES (LFMP) : 14174 voyageurs","TOULON-HYERES (LFTH) : 23233 voyageurs","TARBES-LOURDES-PYRENEES (LFBT) : 3233 voyageurs","BEZIERS-VIAS (LFMU) : 2632 voyageurs","PAU-PYRENEES (LFBP) : 15378 voyageurs","MARSEILLE-PROVENCE (LFML) : 223497 voyageurs","BIARRITZ-PAYS-BASQUE (LFBZ) : 29732 voyageurs","CASTRES-MAZAMET (LFCK) : 2209 voyageurs","MONTPELLIER-MEDITERRANEE (LFMT) : 52974 voyageurs","TOULOUSE-BLAGNAC (LFBO) : 168654 voyageurs","NICE-COTE D'AZUR (LFMN) : 323878 voyageurs","BORDEAUX-MERIGNAC (LFBD) : 123750 voyageurs","AURILLAC (LFLW) : 1725 voyageurs","BRIVE-SOUILLAC (LFSL) : 1553 voyageurs","LYON-ST-EXUPERY (LFLL) : 189096 voyageurs","CLERMONT-FERRAND-AUVERGNE (LFLC) : 4757 voyageurs","ST-PIERRE-POINTE BLANCHE (LFVP) : 1214 voyageurs","DOLE-TAVAUX (LFGJ) : 1991 voyageurs","NANTES-ATLANTIQUE (LFRS) : 158624 voyageurs","ST-NAZAIRE-MONTOIR (LFRZ) : 123 voyageurs","TOURS-VAL DE LOIRE (LFOT) : 4033 voyageurs","BALE-MULHOUSE (LFSB) : 143359 voyageurs","RENNES-ST-JACQUES (LFRN) : 18428 voyageurs","BREST-BRETAGNE (LFRB) : 42894 voyageurs","STRASBOURG-ENTZHEIM (LFST) : 29547 voyageurs","PARIS-ORLY (LFPO) : 764711 voyageurs","CHALONS-VATRY (LFOK) : 2347 voyageurs","PARIS-LE BOURGET (LFPB) : 6959 voyageurs","PARIS-CHARLES DE GAULLE (LFPG) : 1121244 voyageurs","CAEN-CARPIQUET (LFRK) : 20166 voyageurs","BEAUVAIS-TILLE (LFOB) : 74030 voyageurs","LILLE-LESQUIN (LFQQ) : 67077 voyageurs"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[-23.37,50.56],"lng":[-152.24,168.04]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Comme prÃ©cÃ©demment, nous proposons de transformer la production de cette carte en fonction, cela nous permettra dâ€™avoir une application lÃ©gÃ¨re. LÃ  encore câ€™est un exercice optionnel mais intÃ©ressant Ã  faire pour dÃ©couvrir la logique de la programmation fonctionnelle.</p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-17-contents" aria-controls="callout-17" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<i class="bi bi-book"></i> Exercice 5b (optionnel): une fonction pour notre carte
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-17" class="callout-17-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<ul>
<li>CrÃ©er une fonction <code>map_leaflet_airport</code> avec les arguments <code>df</code>, <code>airports_location</code>, <code>month</code> et <code>year</code> produisant la carte. InsÃ©rer celle-ci dans le script <code>R/figures.R</code> (dans <code>src/figures.py</code> pour <code>Python</code>).</li>
<li>Mettre Ã  jour <code>main.R</code> ou <code>main.py</code> pour utiliser cette fonction dans votre chaine. Nâ€™oubliez pas de dÃ©finir <code>month</code> et <code>year</code> dans votre script.</li>
</ul>
</div>
</div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-32-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-32-1" role="tab" aria-controls="tabset-32-1" aria-selected="true"><i class="fa-brands fa-r-project" aria-label="r-project"></i></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-32-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-32-2" role="tab" aria-controls="tabset-32-2" aria-selected="false"><i class="fa-brands fa-python" aria-label="python"></i></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-32-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-32-1-tab">
<details>
<summary>
Code de <code>R/figures.R</code> Ã  reprendre
</summary>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>R/figures.R (fin du fichier)</strong></pre>
</div>
<div class="sourceCode" id="cb93" data-startfrom="20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r" style="counter-reset: source-line 19;"><span id="cb93-20"><a href="#cb93-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-21"><a href="#cb93-21" aria-hidden="true" tabindex="-1"></a>map_leaflet_airport <span class="ot">&lt;-</span> <span class="cf">function</span>(df, airports_location, months, years){</span>
<span id="cb93-22"><a href="#cb93-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-23"><a href="#cb93-23" aria-hidden="true" tabindex="-1"></a>  palette <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"green"</span>, <span class="st">"blue"</span>, <span class="st">"red"</span>)</span>
<span id="cb93-24"><a href="#cb93-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-25"><a href="#cb93-25" aria-hidden="true" tabindex="-1"></a>  trafic_date <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb93-26"><a href="#cb93-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb93-27"><a href="#cb93-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">date =</span> <span class="fu">as.Date</span>(<span class="fu">paste</span>(anmois, <span class="st">"01"</span>, <span class="at">sep=</span><span class="st">""</span>), <span class="at">format =</span> <span class="st">"%Y%m%d"</span>)</span>
<span id="cb93-28"><a href="#cb93-28" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb93-29"><a href="#cb93-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(mois <span class="sc">%in%</span> months, an <span class="sc">%in%</span> years)</span>
<span id="cb93-30"><a href="#cb93-30" aria-hidden="true" tabindex="-1"></a>  trafic_aeroports <span class="ot">&lt;-</span> airports_location <span class="sc">%&gt;%</span></span>
<span id="cb93-31"><a href="#cb93-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">inner_join</span>(trafic_date, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"Code.OACI"</span> <span class="ot">=</span> <span class="st">"apt"</span>))</span>
<span id="cb93-32"><a href="#cb93-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-33"><a href="#cb93-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-34"><a href="#cb93-34" aria-hidden="true" tabindex="-1"></a>  trafic_aeroports <span class="ot">&lt;-</span> trafic_aeroports <span class="sc">%&gt;%</span></span>
<span id="cb93-35"><a href="#cb93-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb93-36"><a href="#cb93-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">volume =</span> <span class="fu">ntile</span>(trafic, <span class="dv">3</span>)</span>
<span id="cb93-37"><a href="#cb93-37" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb93-38"><a href="#cb93-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb93-39"><a href="#cb93-39" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> palette[volume]</span>
<span id="cb93-40"><a href="#cb93-40" aria-hidden="true" tabindex="-1"></a>    )  </span>
<span id="cb93-41"><a href="#cb93-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-42"><a href="#cb93-42" aria-hidden="true" tabindex="-1"></a>  icons <span class="ot">&lt;-</span> <span class="fu">awesomeIcons</span>(</span>
<span id="cb93-43"><a href="#cb93-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">icon =</span> <span class="st">'plane'</span>,</span>
<span id="cb93-44"><a href="#cb93-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">iconColor =</span> <span class="st">'black'</span>,</span>
<span id="cb93-45"><a href="#cb93-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">library =</span> <span class="st">'fa'</span>,</span>
<span id="cb93-46"><a href="#cb93-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">markerColor =</span> trafic_aeroports<span class="sc">$</span>color</span>
<span id="cb93-47"><a href="#cb93-47" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb93-48"><a href="#cb93-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-49"><a href="#cb93-49" aria-hidden="true" tabindex="-1"></a>  carte_interactive <span class="ot">&lt;-</span> <span class="fu">leaflet</span>(trafic_aeroports) <span class="sc">%&gt;%</span> <span class="fu">addTiles</span>() <span class="sc">%&gt;%</span></span>
<span id="cb93-50"><a href="#cb93-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">addAwesomeMarkers</span>(</span>
<span id="cb93-51"><a href="#cb93-51" aria-hidden="true" tabindex="-1"></a>      <span class="at">icon=</span>icons[],</span>
<span id="cb93-52"><a href="#cb93-52" aria-hidden="true" tabindex="-1"></a>      <span class="at">label=</span><span class="sc">~</span><span class="fu">paste0</span>(Nom, <span class="st">""</span>, <span class="st">" ("</span>,Code.OACI, <span class="st">") : "</span>, trafic, <span class="st">" voyageurs"</span>)</span>
<span id="cb93-53"><a href="#cb93-53" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb93-54"><a href="#cb93-54" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-55"><a href="#cb93-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(carte_interactive)</span>
<span id="cb93-56"><a href="#cb93-56" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<details>
<summary>
Code de <code>main.R</code> Ã  reprendre
</summary>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>main.R</strong></pre>
</div>
<div class="sourceCode" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"correction/R/import_data.R"</span>)</span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"correction/R/create_data_list.R"</span>)</span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"correction/R/clean_dataframe.R"</span>)</span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"correction/R/divers_functions.R"</span>)</span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"correction/R/tables.R"</span>)</span>
<span id="cb94-15"><a href="#cb94-15" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"correction/R/figures.R"</span>)</span>
<span id="cb94-16"><a href="#cb94-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-17"><a href="#cb94-17" aria-hidden="true" tabindex="-1"></a>YEARS_LIST  <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="dv">2018</span><span class="sc">:</span><span class="dv">2022</span>)</span>
<span id="cb94-18"><a href="#cb94-18" aria-hidden="true" tabindex="-1"></a>MONTHS_LIST <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span></span>
<span id="cb94-19"><a href="#cb94-19" aria-hidden="true" tabindex="-1"></a>year <span class="ot">&lt;-</span> YEARS_LIST[<span class="dv">1</span>]</span>
<span id="cb94-20"><a href="#cb94-20" aria-hidden="true" tabindex="-1"></a>month <span class="ot">&lt;-</span> MONTHS_LIST[<span class="dv">1</span>]</span>
<span id="cb94-21"><a href="#cb94-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-22"><a href="#cb94-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-23"><a href="#cb94-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data ----------------------------------</span></span>
<span id="cb94-24"><a href="#cb94-24" aria-hidden="true" tabindex="-1"></a>urls <span class="ot">&lt;-</span> <span class="fu">create_data_list</span>(<span class="st">"./sources.yml"</span>)</span>
<span id="cb94-25"><a href="#cb94-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-26"><a href="#cb94-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-27"><a href="#cb94-27" aria-hidden="true" tabindex="-1"></a>pax_apt_all <span class="ot">&lt;-</span> <span class="fu">import_airport_data</span>(<span class="fu">unlist</span>(urls<span class="sc">$</span>airports))</span>
<span id="cb94-28"><a href="#cb94-28" aria-hidden="true" tabindex="-1"></a>pax_cie_all <span class="ot">&lt;-</span> <span class="fu">import_compagnies_data</span>(<span class="fu">unlist</span>(urls<span class="sc">$</span>compagnies))</span>
<span id="cb94-29"><a href="#cb94-29" aria-hidden="true" tabindex="-1"></a>pax_lsn_all <span class="ot">&lt;-</span> <span class="fu">import_liaisons_data</span>(<span class="fu">unlist</span>(urls<span class="sc">$</span>liaisons))</span>
<span id="cb94-30"><a href="#cb94-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-31"><a href="#cb94-31" aria-hidden="true" tabindex="-1"></a>airports_location <span class="ot">&lt;-</span> <span class="fu">st_read</span>(urls<span class="sc">$</span>geojson<span class="sc">$</span>airport)</span>
<span id="cb94-32"><a href="#cb94-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-33"><a href="#cb94-33" aria-hidden="true" tabindex="-1"></a>liste_aeroports <span class="ot">&lt;-</span> <span class="fu">unique</span>(pax_apt_all<span class="sc">$</span>apt)</span>
<span id="cb94-34"><a href="#cb94-34" aria-hidden="true" tabindex="-1"></a>default_airport <span class="ot">&lt;-</span> liste_aeroports[<span class="dv">1</span>]</span>
<span id="cb94-35"><a href="#cb94-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-36"><a href="#cb94-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-37"><a href="#cb94-37" aria-hidden="true" tabindex="-1"></a><span class="co"># OBJETS NECESSAIRES A L'APPLICATION ------------------------</span></span>
<span id="cb94-38"><a href="#cb94-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-39"><a href="#cb94-39" aria-hidden="true" tabindex="-1"></a>trafic_aeroports <span class="ot">&lt;-</span> pax_apt_all <span class="sc">%&gt;%</span></span>
<span id="cb94-40"><a href="#cb94-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">trafic =</span> apt_pax_dep <span class="sc">+</span> apt_pax_tr <span class="sc">+</span> apt_pax_arr) <span class="sc">%&gt;%</span></span>
<span id="cb94-41"><a href="#cb94-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(apt <span class="sc">%in%</span> default_airport) <span class="sc">%&gt;%</span></span>
<span id="cb94-42"><a href="#cb94-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb94-43"><a href="#cb94-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">as.Date</span>(<span class="fu">paste</span>(anmois, <span class="st">"01"</span>, <span class="at">sep=</span><span class="st">""</span>), <span class="at">format =</span> <span class="st">"%Y%m%d"</span>)</span>
<span id="cb94-44"><a href="#cb94-44" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb94-45"><a href="#cb94-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-46"><a href="#cb94-46" aria-hidden="true" tabindex="-1"></a>stats_aeroports <span class="ot">&lt;-</span> <span class="fu">summary_stat_airport</span>(</span>
<span id="cb94-47"><a href="#cb94-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">create_data_from_input</span>(pax_apt_all, year, month)</span>
<span id="cb94-48"><a href="#cb94-48" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb94-49"><a href="#cb94-49" aria-hidden="true" tabindex="-1"></a>stats_liaisons  <span class="ot">&lt;-</span> <span class="fu">summary_stat_liaisons</span>(</span>
<span id="cb94-50"><a href="#cb94-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">create_data_from_input</span>(pax_lsn_all, year, month)</span>
<span id="cb94-51"><a href="#cb94-51" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb94-52"><a href="#cb94-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-53"><a href="#cb94-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-54"><a href="#cb94-54" aria-hidden="true" tabindex="-1"></a><span class="co"># VALORISATIONS ----------------------------------------------</span></span>
<span id="cb94-55"><a href="#cb94-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-56"><a href="#cb94-56" aria-hidden="true" tabindex="-1"></a>figure_plotly <span class="ot">&lt;-</span> <span class="fu">plot_airport_line</span>(trafic_aeroports,default_airport)</span>
<span id="cb94-57"><a href="#cb94-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-58"><a href="#cb94-58" aria-hidden="true" tabindex="-1"></a>table_airports <span class="ot">&lt;-</span> <span class="fu">create_table_airports</span>(stats_aeroports)</span>
<span id="cb94-59"><a href="#cb94-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-60"><a href="#cb94-60" aria-hidden="true" tabindex="-1"></a>carte_interactive <span class="ot">&lt;-</span> <span class="fu">map_leaflet_airport</span>(</span>
<span id="cb94-61"><a href="#cb94-61" aria-hidden="true" tabindex="-1"></a>  pax_apt_all, airports_location,</span>
<span id="cb94-62"><a href="#cb94-62" aria-hidden="true" tabindex="-1"></a>  month, year</span>
<span id="cb94-63"><a href="#cb94-63" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
</div>
<div id="tabset-32-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-32-2-tab">
<details>
<summary>
Code de <code>src/figures.py</code> Ã  reprendre
</summary>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>src/figures.py (fin du fichier)</strong></pre>
</div>
<div class="sourceCode" id="cb95" data-start-line="27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<details>
<summary>
Code de <code>main.py</code> Ã  reprendre
</summary>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>main.py</strong></pre>
</div>
<div class="sourceCode" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>import pandas as pd</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>import geopandas as gpd</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>import plotly.express as px</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>import src.import_data as sid</span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>from src.create_data_list import create_data_list</span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>from src.divers_functions <span class="fu">import</span> (</span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>  create_data_from_input,</span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a>  summary_stat_airport</span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a>from src.tables import create_table_airports</span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a>from src.figures import plot_airport_line, map_leaflet_airport</span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-14"><a href="#cb96-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-15"><a href="#cb96-15" aria-hidden="true" tabindex="-1"></a>YEARS_LIST <span class="ot">=</span> [<span class="fu">str</span>(year) <span class="cf">for</span> year <span class="cf">in</span> <span class="fu">range</span>(<span class="dv">2018</span>, <span class="dv">2023</span>)]</span>
<span id="cb96-16"><a href="#cb96-16" aria-hidden="true" tabindex="-1"></a>MONTHS_LIST <span class="ot">=</span> <span class="fu">list</span>(<span class="fu">range</span>(<span class="dv">1</span>, <span class="dv">13</span>))</span>
<span id="cb96-17"><a href="#cb96-17" aria-hidden="true" tabindex="-1"></a>year <span class="ot">=</span> YEARS_LIST[<span class="dv">0</span>]</span>
<span id="cb96-18"><a href="#cb96-18" aria-hidden="true" tabindex="-1"></a>month <span class="ot">=</span> MONTHS_LIST[<span class="dv">0</span>]</span>
<span id="cb96-19"><a href="#cb96-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-20"><a href="#cb96-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data ----------------------------------</span></span>
<span id="cb96-21"><a href="#cb96-21" aria-hidden="true" tabindex="-1"></a>urls <span class="ot">=</span> <span class="fu">create_data_list</span>(<span class="st">"./sources.yml"</span>)</span>
<span id="cb96-22"><a href="#cb96-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-23"><a href="#cb96-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-24"><a href="#cb96-24" aria-hidden="true" tabindex="-1"></a>pax_apt_all <span class="ot">=</span> <span class="fu">sid.import_airport_data</span>(urls[<span class="st">'airports'</span>]<span class="fu">.values</span>())</span>
<span id="cb96-25"><a href="#cb96-25" aria-hidden="true" tabindex="-1"></a>pax_cie_all <span class="ot">=</span> <span class="fu">sid.import_airport_data</span>(urls[<span class="st">'compagnies'</span>]<span class="fu">.values</span>())</span>
<span id="cb96-26"><a href="#cb96-26" aria-hidden="true" tabindex="-1"></a>pax_lsn_all <span class="ot">=</span> <span class="fu">sid.import_airport_data</span>(urls[<span class="st">'liaisons'</span>]<span class="fu">.values</span>())</span>
<span id="cb96-27"><a href="#cb96-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-28"><a href="#cb96-28" aria-hidden="true" tabindex="-1"></a>airports_location <span class="ot">=</span> <span class="fu">gpd.read_file</span>(</span>
<span id="cb96-29"><a href="#cb96-29" aria-hidden="true" tabindex="-1"></a>    urls[<span class="st">'geojson'</span>][<span class="st">'airport'</span>]</span>
<span id="cb96-30"><a href="#cb96-30" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb96-31"><a href="#cb96-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-32"><a href="#cb96-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-33"><a href="#cb96-33" aria-hidden="true" tabindex="-1"></a>liste_aeroports <span class="ot">=</span> pax_apt_all[<span class="st">'apt'</span>]<span class="fu">.unique</span>()</span>
<span id="cb96-34"><a href="#cb96-34" aria-hidden="true" tabindex="-1"></a>default_airport <span class="ot">=</span> liste_aeroports[<span class="dv">0</span>]</span>
<span id="cb96-35"><a href="#cb96-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-36"><a href="#cb96-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-37"><a href="#cb96-37" aria-hidden="true" tabindex="-1"></a><span class="co"># OBJETS NECESSAIRES A L'APPLICATION ------------------------</span></span>
<span id="cb96-38"><a href="#cb96-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-39"><a href="#cb96-39" aria-hidden="true" tabindex="-1"></a>pax_apt_all[<span class="st">'trafic'</span>] <span class="ot">=</span> pax_apt_all[<span class="st">'apt_pax_dep'</span>] <span class="sc">+</span> \</span>
<span id="cb96-40"><a href="#cb96-40" aria-hidden="true" tabindex="-1"></a>  pax_apt_all[<span class="st">'apt_pax_tr'</span>] <span class="sc">+</span> \</span>
<span id="cb96-41"><a href="#cb96-41" aria-hidden="true" tabindex="-1"></a>  pax_apt_all[<span class="st">'apt_pax_arr'</span>]</span>
<span id="cb96-42"><a href="#cb96-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-43"><a href="#cb96-43" aria-hidden="true" tabindex="-1"></a>trafic_aeroports <span class="ot">=</span> (</span>
<span id="cb96-44"><a href="#cb96-44" aria-hidden="true" tabindex="-1"></a>  pax_apt_all</span>
<span id="cb96-45"><a href="#cb96-45" aria-hidden="true" tabindex="-1"></a>  .loc[pax_apt_all[<span class="st">'apt'</span>] <span class="sc">==</span> default_airport]</span>
<span id="cb96-46"><a href="#cb96-46" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb96-47"><a href="#cb96-47" aria-hidden="true" tabindex="-1"></a>trafic_aeroports[<span class="st">'date'</span>] <span class="ot">=</span> <span class="fu">pd.to_datetime</span>(</span>
<span id="cb96-48"><a href="#cb96-48" aria-hidden="true" tabindex="-1"></a>  trafic_aeroports[<span class="st">'anmois'</span>] <span class="sc">+</span> <span class="st">'01'</span>, <span class="at">format=</span><span class="st">'%Y%m%d'</span></span>
<span id="cb96-49"><a href="#cb96-49" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb96-50"><a href="#cb96-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-51"><a href="#cb96-51" aria-hidden="true" tabindex="-1"></a>stats_aeroports <span class="ot">=</span> <span class="fu">summary_stat_airport</span>(</span>
<span id="cb96-52"><a href="#cb96-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">create_data_from_input</span>(pax_apt_all, year, month)</span>
<span id="cb96-53"><a href="#cb96-53" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb96-54"><a href="#cb96-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-55"><a href="#cb96-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-56"><a href="#cb96-56" aria-hidden="true" tabindex="-1"></a><span class="co"># VALORISATIONS ----------------------------------------------</span></span>
<span id="cb96-57"><a href="#cb96-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-58"><a href="#cb96-58" aria-hidden="true" tabindex="-1"></a>figure_plotly <span class="ot">=</span> <span class="fu">plot_airport_line</span>(trafic_aeroports, default_airport)</span>
<span id="cb96-59"><a href="#cb96-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-60"><a href="#cb96-60" aria-hidden="true" tabindex="-1"></a>table_airports <span class="ot">=</span> <span class="fu">create_table_airports</span>(stats_aeroports)</span>
<span id="cb96-61"><a href="#cb96-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-62"><a href="#cb96-62" aria-hidden="true" tabindex="-1"></a>carte_interactive <span class="ot">=</span> <span class="fu">map_leaflet_airport</span>(</span>
<span id="cb96-63"><a href="#cb96-63" aria-hidden="true" tabindex="-1"></a>  pax_apt_all, airports_location,</span>
<span id="cb96-64"><a href="#cb96-64" aria-hidden="true" tabindex="-1"></a>  month, year</span>
<span id="cb96-65"><a href="#cb96-65" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
</div>
</div>
</div>
</section>
</section>
<section id="crÃ©ation-de-lapplication" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> CrÃ©ation de lâ€™application</h1>
<p>Maintenant tous les ingrÃ©dients sont lÃ  pour transformer cette chaÃ®ne en application interactive. Lâ€™architecture de notre application sera la suivante :</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/ui-r.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Architecture de notre application (ici illustrÃ©e par lâ€™exemple <i class="fa-brands fa-r-project" aria-label="r-project"></i>)</figcaption>
</figure>
</div>
<p>Comme toute application <em>web</em>, <code>Shiny</code> ou <code>Streamlit</code> reposent sur deux piliers :</p>
<ul>
<li>lâ€™interface utilisateur (UI) qui prÃ©sente au navigateur des actions possibles et affiche des <em>output</em> adaptÃ©s;</li>
<li>le serveur qui rÃ©pond Ã  ces actions de lâ€™utilisateur, produit les <em>outputs</em> et les envoie Ã  lâ€™interface.</li>
</ul>
<p><code>Shiny</code> ou <code>Streamlit</code> fonctionnent un peu diffÃ©remment dans la maniÃ¨re de faire interagir ces deux Ã©lÃ©ments:</p>
<ul>
<li><code>Shiny</code> nÃ©cessite deux fichiers: un pour lâ€™interface graphique (<code>ui.R</code>) et lâ€™autre pour le serveur (<code>server.R</code>). Lâ€™aller-retour entre ces deux fichiers se fait par des objets communs, les <em>inputs</em> du serveur (qui sont les Ã©lÃ©ments de lâ€™interface graphique) et les <em>outputs</em> du serveur (le rÃ©sultat des calculs, Ã  afficher sur la page web) ;</li>
<li><code>Streamlit</code> propose de tout mettre dans un fichier. Les Ã©lÃ©ments de lâ€™interface graphique sont Ã  la fois des <em>widgets</em> qui seront reprÃ©sentÃ©s sur la page et des objets <code>Python</code> ayant une valeur correspondant Ã  celle sÃ©lectionnÃ©e sur la page.</li>
</ul>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-19-contents" aria-controls="callout-19" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<i class="bi bi-book"></i> Exercice 6: CrÃ©er la structure de lâ€™application
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-19" class="callout-19-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-33-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-33-1" role="tab" aria-controls="tabset-33-1" aria-selected="true"><i class="fa-brands fa-r-project" aria-label="r-project"></i></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-33-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-33-2" role="tab" aria-controls="tabset-33-2" aria-selected="false"><i class="fa-brands fa-python" aria-label="python"></i></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-33-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-33-1-tab">
<ol type="1">
<li>CrÃ©er le fichier <code>global.R</code> Ã  partir de <code>main.R</code> en ne conservant que les lignes jusquâ€™Ã  la crÃ©ation (incluse); de lâ€™objet <code>trafic_aeroports</code>.</li>
</ol>
<details>
<summary>
Le fichier <code>global.R</code> attendu
</summary>
<div class="sourceCode" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Environment ----------------------------------</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bslib)</span>
<span id="cb97-13"><a href="#cb97-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-14"><a href="#cb97-14" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"correction/R/import_data.R"</span>)</span>
<span id="cb97-15"><a href="#cb97-15" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"correction/R/create_data_list.R"</span>)</span>
<span id="cb97-16"><a href="#cb97-16" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"correction/R/clean_dataframe.R"</span>)</span>
<span id="cb97-17"><a href="#cb97-17" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"correction/R/divers_functions.R"</span>)</span>
<span id="cb97-18"><a href="#cb97-18" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"correction/R/tables.R"</span>)</span>
<span id="cb97-19"><a href="#cb97-19" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"correction/R/figures.R"</span>)</span>
<span id="cb97-20"><a href="#cb97-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-21"><a href="#cb97-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Global variables ---------------------------</span></span>
<span id="cb97-22"><a href="#cb97-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-23"><a href="#cb97-23" aria-hidden="true" tabindex="-1"></a>YEARS_LIST <span class="ot">&lt;-</span> <span class="dv">2018</span><span class="sc">:</span><span class="dv">2022</span></span>
<span id="cb97-24"><a href="#cb97-24" aria-hidden="true" tabindex="-1"></a>MONTHS_LIST <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span></span>
<span id="cb97-25"><a href="#cb97-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-26"><a href="#cb97-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data ----------------------------------</span></span>
<span id="cb97-27"><a href="#cb97-27" aria-hidden="true" tabindex="-1"></a>urls <span class="ot">&lt;-</span> <span class="fu">create_data_list</span>(<span class="st">"./sources.yml"</span>)</span>
<span id="cb97-28"><a href="#cb97-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-29"><a href="#cb97-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-30"><a href="#cb97-30" aria-hidden="true" tabindex="-1"></a>pax_apt_all <span class="ot">&lt;-</span> <span class="fu">import_airport_data</span>(<span class="fu">unlist</span>(urls<span class="sc">$</span>airports))</span>
<span id="cb97-31"><a href="#cb97-31" aria-hidden="true" tabindex="-1"></a>pax_cie_all <span class="ot">&lt;-</span> <span class="fu">import_compagnies_data</span>(<span class="fu">unlist</span>(urls<span class="sc">$</span>compagnies))</span>
<span id="cb97-32"><a href="#cb97-32" aria-hidden="true" tabindex="-1"></a>pax_lsn_all <span class="ot">&lt;-</span> <span class="fu">import_liaisons_data</span>(<span class="fu">unlist</span>(urls<span class="sc">$</span>liaisons))</span>
<span id="cb97-33"><a href="#cb97-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-34"><a href="#cb97-34" aria-hidden="true" tabindex="-1"></a>airports_location <span class="ot">&lt;-</span> <span class="fu">st_read</span>(urls<span class="sc">$</span>geojson<span class="sc">$</span>airport)</span>
<span id="cb97-35"><a href="#cb97-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-36"><a href="#cb97-36" aria-hidden="true" tabindex="-1"></a>liste_aeroports <span class="ot">&lt;-</span> <span class="fu">unique</span>(pax_apt_all<span class="sc">$</span>apt)</span>
<span id="cb97-37"><a href="#cb97-37" aria-hidden="true" tabindex="-1"></a>default_airport <span class="ot">&lt;-</span> liste_aeroports[<span class="dv">1</span>]</span>
<span id="cb97-38"><a href="#cb97-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-39"><a href="#cb97-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-40"><a href="#cb97-40" aria-hidden="true" tabindex="-1"></a><span class="co"># OBJETS NECESSAIRES A L'APPLICATION ------------------------</span></span>
<span id="cb97-41"><a href="#cb97-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-42"><a href="#cb97-42" aria-hidden="true" tabindex="-1"></a>trafic_aeroports <span class="ot">&lt;-</span> pax_apt_all <span class="sc">%&gt;%</span></span>
<span id="cb97-43"><a href="#cb97-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">trafic =</span> apt_pax_dep <span class="sc">+</span> apt_pax_tr <span class="sc">+</span> apt_pax_arr) <span class="sc">%&gt;%</span></span>
<span id="cb97-44"><a href="#cb97-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(apt <span class="sc">%in%</span> default_airport) <span class="sc">%&gt;%</span></span>
<span id="cb97-45"><a href="#cb97-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb97-46"><a href="#cb97-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">as.Date</span>(<span class="fu">paste</span>(anmois, <span class="st">"01"</span>, <span class="at">sep=</span><span class="st">""</span>), <span class="at">format =</span> <span class="st">"%Y%m%d"</span>)</span>
<span id="cb97-47"><a href="#cb97-47" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<p>Lâ€™objectif de la suite de lâ€™exercice est de comprendre comment fonctionne une application. Celle-ci sera enrichie ensuite de nos productions graphiques.</p>
<p>CrÃ©er les fichiers <code>ui.R</code> et <code>server.R</code> Ã  partir des modÃ¨les ci-dessous</p>
<details>
<summary>
Code de <code>ui.R</code> Ã  reprendre
</summary>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>ui.R</strong></pre>
</div>
<div class="sourceCode" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>main_color <span class="ot">&lt;-</span> <span class="st">"black"</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>input_date <span class="ot">&lt;-</span> shinyWidgets<span class="sc">::</span><span class="fu">airDatepickerInput</span>(</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"date"</span>,</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="st">"Mois choisi"</span>,</span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">value =</span> <span class="st">"2019-01-01"</span>,</span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">view =</span> <span class="st">"months"</span>,</span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">minView =</span> <span class="st">"months"</span>,</span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">minDate =</span> <span class="st">"2018-01-01"</span>,</span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">maxDate =</span> <span class="st">"2022-12-01"</span>,</span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">dateFormat =</span> <span class="st">"MMMM yyyy"</span>,</span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">language =</span> <span class="st">"fr"</span></span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-15"><a href="#cb98-15" aria-hidden="true" tabindex="-1"></a>input_airport <span class="ot">&lt;-</span> <span class="fu">selectInput</span>(</span>
<span id="cb98-16"><a href="#cb98-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">"select"</span>,</span>
<span id="cb98-17"><a href="#cb98-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">"AÃ©roport choisi"</span>,</span>
<span id="cb98-18"><a href="#cb98-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">choices =</span> liste_aeroports,</span>
<span id="cb98-19"><a href="#cb98-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">selected =</span> default_airport</span>
<span id="cb98-20"><a href="#cb98-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb98-21"><a href="#cb98-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-22"><a href="#cb98-22" aria-hidden="true" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">page_navbar</span>(</span>
<span id="cb98-23"><a href="#cb98-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"Tableau de bord des aÃ©roports franÃ§ais"</span>,</span>
<span id="cb98-24"><a href="#cb98-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">bg =</span> main_color,</span>
<span id="cb98-25"><a href="#cb98-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">inverse =</span> <span class="cn">TRUE</span>,</span>
<span id="cb98-26"><a href="#cb98-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">header =</span> <span class="fu">em</span>(<span class="st">"Projet issu du funathon 2024, organisÃ© par l'Insee et la DGAC"</span>),</span>
<span id="cb98-27"><a href="#cb98-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout_columns</span>(</span>
<span id="cb98-28"><a href="#cb98-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">card</span>(</span>
<span id="cb98-29"><a href="#cb98-29" aria-hidden="true" tabindex="-1"></a>      input_date,</span>
<span id="cb98-30"><a href="#cb98-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">textOutput</span>(<span class="st">"date1"</span>)</span>
<span id="cb98-31"><a href="#cb98-31" aria-hidden="true" tabindex="-1"></a>      <span class="co"># table viendra ici</span></span>
<span id="cb98-32"><a href="#cb98-32" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb98-33"><a href="#cb98-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layout_columns</span>(</span>
<span id="cb98-34"><a href="#cb98-34" aria-hidden="true" tabindex="-1"></a>      <span class="fu">card</span>(</span>
<span id="cb98-35"><a href="#cb98-35" aria-hidden="true" tabindex="-1"></a>        <span class="co"># carte viendra ici</span></span>
<span id="cb98-36"><a href="#cb98-36" aria-hidden="true" tabindex="-1"></a>        <span class="fu">textOutput</span>(<span class="st">"date2"</span>)</span>
<span id="cb98-37"><a href="#cb98-37" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb98-38"><a href="#cb98-38" aria-hidden="true" tabindex="-1"></a>      <span class="fu">card</span>(<span class="fu">card_header</span>(<span class="st">"FrÃ©quentation d'un aÃ©roport"</span>, <span class="at">class =</span> <span class="st">"bg-dark"</span>),</span>
<span id="cb98-39"><a href="#cb98-39" aria-hidden="true" tabindex="-1"></a>           input_airport,</span>
<span id="cb98-40"><a href="#cb98-40" aria-hidden="true" tabindex="-1"></a>           <span class="fu">textOutput</span>(<span class="st">"airport"</span>)</span>
<span id="cb98-41"><a href="#cb98-41" aria-hidden="true" tabindex="-1"></a>           <span class="co"># figure viendra ici</span></span>
<span id="cb98-42"><a href="#cb98-42" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb98-43"><a href="#cb98-43" aria-hidden="true" tabindex="-1"></a>      <span class="at">col_widths =</span> <span class="fu">c</span>(<span class="dv">12</span>,<span class="dv">12</span>)</span>
<span id="cb98-44"><a href="#cb98-44" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb98-45"><a href="#cb98-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols_widths =</span> <span class="fu">c</span>(<span class="dv">12</span>,<span class="dv">12</span>,<span class="dv">12</span>)</span>
<span id="cb98-46"><a href="#cb98-46" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb98-47"><a href="#cb98-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb98-48"><a href="#cb98-48" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<details>
<summary>
Code de <code>server.R</code> Ã  reprendre
</summary>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>server.R</strong></pre>
</div>
<div class="sourceCode" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="cf">function</span>(input, output) {</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>date1 <span class="ot">&lt;-</span> <span class="fu">renderText</span>(input<span class="sc">$</span>date)</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>date2 <span class="ot">&lt;-</span> <span class="fu">renderText</span>(input<span class="sc">$</span>date)</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>airport <span class="ot">&lt;-</span> <span class="fu">renderText</span>(input<span class="sc">$</span>select)</span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<p>Lancer lâ€™application en lanÃ§ant <code>shiny::runApp()</code> depuis la console <code>R</code>. Si <code>firefox</code> affiche un message de blocage de lâ€™ouverture dâ€™une fenÃªtre, autoriser celle-ci.</p>
<ol type="1">
<li>Observer votre console, notamment les messages lors du lancement de lâ€™application</li>
<li>Jouer avec les <em>inputs</em> et observer la maniÃ¨re dont lâ€™affichage sâ€™ajuste</li>
</ol>
<p>Maintenant, se pencher sur le code source et observer lâ€™aller-retour entre les objets du script <code>ui.R</code> et <code>server.R</code>.</p>
<p>Tuer lâ€™application avec le bouton stop de la console.</p>
</div>
<div id="tabset-33-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-33-2-tab">
<ol type="1">
<li>Renommer le fichier <code>main.py</code> en <code>app.py</code></li>
<li>Vous devriez avoir besoin des Ã©lÃ©ments suivants dans lâ€™application, Ã  ajouter en dÃ©but de script:</li>
</ol>
<div class="sourceCode" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> streamlit <span class="im">as</span> st</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> streamlit.components.v1 <span class="im">as</span> components</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> streamlit_folium <span class="im">import</span> st_folium</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Globalement, le fichier <code>app.py</code> va avoir la structure suivante:</p>
<ul>
<li>Import des <em>packages</em> ;</li>
<li>Import et restructuration des donnÃ©es ;</li>
<li>CrÃ©ation de la mise en page (<em>layout</em>) de lâ€™application ;</li>
<li>CrÃ©ation des <em>inputs</em> (les sÃ©lecteurs) et utilisation pour produire nos valorisations graphiques.</li>
</ul>
<ol start="3" type="1">
<li><p>AprÃ¨s la derniÃ¨re ligne de crÃ©ation de base de donnÃ©es, crÃ©er le <em>layout</em> de lâ€™application</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Streamlit Layout --------------------------------------</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>st.set_page_config(</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>  page_title<span class="op">=</span><span class="st">"Tableau de bord des aÃ©roports franÃ§ais"</span>, layout<span class="op">=</span><span class="st">"wide"</span>,</span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>  page_icon<span class="op">=</span><span class="st">"âœˆï¸"</span></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>col1, col2 <span class="op">=</span> st.columns(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Pour le moment, nous proposons de ne pas se prÃ©occuper des deux colonnes, nous remettrons en forme ultÃ©rieurement notre application.</p></li>
<li><p>CrÃ©er un objet <code>selected_date</code> Ã  partir de <a href="https://docs.streamlit.io/develop/api-reference/widgets/st.date_input"><code>st.date_input</code></a> ayant pour Ã©tiquette â€œMois choisiâ€ et prenant par dÃ©faut la valeur <code>pd.to_datetime("2019-01-01")</code>. Lâ€™utiliser pour crÃ©er des objets <code>year</code> et <code>month</code>.</p></li>
<li><p>Utiliser ces objets <code>year</code> et <code>month</code>, qui sont donc maintenant rÃ©actifs et non plus figÃ©s, pour crÃ©er <code>stats_aeroports</code>, puis <code>table_airports</code>. Pour que la table rende bien sur lâ€™application, vous pouvez ajouter, par rapport Ã  prÃ©cÃ©demment, la mÃ©thode <code>as_raw_html</code> aprÃ¨s lâ€™application de la fonction <code>create_table_airports</code>. On va supposer que cette table HTML sâ€™appelle <code>table_airports</code>.</p></li>
<li><p>Pour intÃ©grer cette table dans lâ€™application, insÃ©rer le code suivant dans <code>app.py</code>:</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>components.html(table_airports, height<span class="op">=</span><span class="dv">600</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Faire tourner lâ€™application avec la commande suivante dans un terminal:</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>streamlit run app.py <span class="op">--</span>server.port<span class="op">=</span><span class="dv">5000</span> <span class="op">--</span>server.address<span class="op">=</span><span class="fl">0.0.0.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>La commande suivante devrait sâ€™afficher sur votre terminal:</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>Collecting usage statistics. To deactivate, <span class="bu">set</span> browser.gatherUsageStats to false.</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>  You can now view your Streamlit app <span class="kw">in</span> your browser.</span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>  URL: http:<span class="op">//</span><span class="fl">0.0.0.0</span>:<span class="dv">5000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Et <code>VSCode</code> devrait vous proposer dâ€™ouvrir cette fenÃªtre. Ne le faites pas car une redirection plus persistante vers le <em>localhost</em> de votre service (http://0.0.0.0:5000) va Ãªtre nÃ©cessaire.</p></li>
<li><p>Retourner sur la page <em>â€œMes servicesâ€</em> du <a href="https://datalab.sspcloud.fr/my-services">SSPCloud</a> et cliquer sur le lien du port personnalisÃ©</p></li>
</ol>
<p><img src="img/lien_perso.png" class="img-fluid"></p>
<p>Observer la page web et lâ€™Ã©volution de votre console.</p>
<ol start="9" type="1">
<li><p>Stopper votre application avec <kbd>CTRL</kbd>+<kbd>C</kbd>. Ajouter le code suivant Ã  votre application:</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>st.subheader(<span class="st">"Carte des aÃ©roports"</span>)</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>carte_interactive <span class="op">=</span> map_leaflet_airport(</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>    pax_apt_all, airports_location, month, year</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>st_folium(carte_interactive, height<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Line Plot Output</span></span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a>st.subheader(<span class="st">"FrÃ©quentation d'un aÃ©roport"</span>)</span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a>selected_airport <span class="op">=</span> st.selectbox(</span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"AÃ©roport choisi"</span>, options<span class="op">=</span>liste_aeroports, index<span class="op">=</span><span class="dv">0</span></span>
<span id="cb105-11"><a href="#cb105-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb105-12"><a href="#cb105-12" aria-hidden="true" tabindex="-1"></a>figure_plotly <span class="op">=</span> plot_airport_line(pax_apt_all, selected_airport)</span>
<span id="cb105-13"><a href="#cb105-13" aria-hidden="true" tabindex="-1"></a>st.plotly_chart(figure_plotly)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>ExÃ©cuter Ã  nouveau la commande <code>streamlit run</code> ci-dessus. Observer lâ€™Ã©volution de votre application et jouez avec les paramÃ¨tres de celle-ci. Ajouter, Ã  la fin de celle-ci, un <code>print(year)</code>. Jouer avec le <em>widget</em> de date dans votre application web et observer la valeur affichÃ©e dans lâ€™application et dans votre terminal. Comprenez-vous pourquoi lâ€™annÃ©e ne sâ€™affiche pas dans la page web mais dans la console ?</p></li>
</ol>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-18-contents" aria-controls="callout-18" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Explication
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-18" class="callout-18-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Comme nous lâ€™avons Ã©voquÃ© prÃ©cÃ©demment, il convient de distinguer lâ€™interface utilisateur du serveur. Les commandes <code>Python</code> sont exÃ©cutÃ©es au niveau du serveur, en lâ€™occurrence votre terminal <code>Python</code> dans <code>VSCode</code>. Pour afficher des Ã©lÃ©ments dans lâ€™interface utilisateur, il faut indiquer Ã  <code>Streamlit</code> de les remonter, par exemple par le biais de <code>st.plotly_chart</code>. Sinon, elles restent au niveau du serveur.</p>
<p>En lâ€™occurrence, le <code>print</code> est une commande qui permet dâ€™afficher la valeur au niveau de la console Python. Mais on ne dit pas Ã  <code>Streamlit</code> dâ€™afficher cette valeur sur la page web (lâ€™interface utilisateur).</p>
<p>A noter que cette distinction nâ€™est pas propre Ã  <code>Streamlit</code>. Dans le monde du dÃ©veloppement <code>JavaScript</code>, on distingue aussi lâ€™affichage du <em>widget</em> (sa vue) de sa valeur rÃ©elle. Pour sâ€™y retrouver lorsquâ€™ils dÃ©veloppent, les dÃ©veloppeurs web affichent souvent dans la console <code>Javascript</code> la valeur de lâ€™objet par le biais de <code>console.log</code>. Vous pouvez dâ€™ailleurs retrouver cette console <code>JavaScript</code> dans vos outils de dÃ©veloppement de votre navigateur (par exemple sur <em>Firefox</em> par le biais de <kbd>CTRL</kbd>+<kbd>MAJ</kbd>+<kbd>K</kbd>). Si vous voyez des valeurs sâ€™afficher, câ€™est que les dÃ©veloppeurs du site ont utilisÃ© des <code>console.log</code> de temps en temps.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-20-contents" aria-controls="callout-20" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<i class="bi bi-book"></i> Exercice 7: finaliser lâ€™application
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-20" class="callout-20-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Le sujet le plus difficile, quand on dÃ©couvre le dÃ©veloppement web est la gestion de la rÃ©activitÃ©, câ€™est-Ã -dire de lâ€™aller-retour entre interface utilisateur et serveur. Pour comprendre cela, la maniÃ¨re la plus directe est sans doute de se plonger dans le code de lâ€™application complÃ¨te.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-34-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-34-1" role="tab" aria-controls="tabset-34-1" aria-selected="true"><i class="fa-brands fa-r-project" aria-label="r-project"></i></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-34-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-34-2" role="tab" aria-controls="tabset-34-2" aria-selected="false"><i class="fa-brands fa-python" aria-label="python"></i></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-34-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-34-1-tab">
<details>
<summary>
Code de <code>ui.R</code> Ã  reprendre
</summary>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>ui.R</strong></pre>
</div>
<div class="sourceCode" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>main_color <span class="ot">&lt;-</span> <span class="st">"black"</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>input_date <span class="ot">&lt;-</span> shinyWidgets<span class="sc">::</span><span class="fu">airDatepickerInput</span>(</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"date"</span>,</span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="st">"Mois choisi"</span>,</span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">value =</span> <span class="st">"2019-01-01"</span>,</span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">view =</span> <span class="st">"months"</span>,</span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">minView =</span> <span class="st">"months"</span>,</span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">minDate =</span> <span class="st">"2018-01-01"</span>,</span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">maxDate =</span> <span class="st">"2022-12-01"</span>,</span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">dateFormat =</span> <span class="st">"MMMM yyyy"</span>,</span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">language =</span> <span class="st">"fr"</span></span>
<span id="cb106-13"><a href="#cb106-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb106-14"><a href="#cb106-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-15"><a href="#cb106-15" aria-hidden="true" tabindex="-1"></a>input_airport <span class="ot">&lt;-</span> <span class="fu">selectInput</span>(</span>
<span id="cb106-16"><a href="#cb106-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">"select"</span>,</span>
<span id="cb106-17"><a href="#cb106-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">"AÃ©roport choisi"</span>,</span>
<span id="cb106-18"><a href="#cb106-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">choices =</span> liste_aeroports,</span>
<span id="cb106-19"><a href="#cb106-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">selected =</span> default_airport</span>
<span id="cb106-20"><a href="#cb106-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb106-21"><a href="#cb106-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-22"><a href="#cb106-22" aria-hidden="true" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">page_navbar</span>(</span>
<span id="cb106-23"><a href="#cb106-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">"Tableau de bord des aÃ©roports franÃ§ais"</span>,</span>
<span id="cb106-24"><a href="#cb106-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">bg =</span> main_color,</span>
<span id="cb106-25"><a href="#cb106-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">inverse =</span> <span class="cn">TRUE</span>,</span>
<span id="cb106-26"><a href="#cb106-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">header =</span> <span class="fu">em</span>(<span class="st">"Projet issu du funathon 2024, organisÃ© par l'Insee et la DGAC"</span>),</span>
<span id="cb106-27"><a href="#cb106-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout_columns</span>(</span>
<span id="cb106-28"><a href="#cb106-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">card</span>(</span>
<span id="cb106-29"><a href="#cb106-29" aria-hidden="true" tabindex="-1"></a>      <span class="fu">HTML</span>(</span>
<span id="cb106-30"><a href="#cb106-30" aria-hidden="true" tabindex="-1"></a>        <span class="st">'&lt;a href="https://inseefrlab.github.io/funathon2024_sujet2/"&gt;ğŸ‘‰ï¸ Retourner au tutoriel pour construire cette application&lt;/a&gt;'</span></span>
<span id="cb106-31"><a href="#cb106-31" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb106-32"><a href="#cb106-32" aria-hidden="true" tabindex="-1"></a>      input_date,</span>
<span id="cb106-33"><a href="#cb106-33" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gt_output</span>(<span class="at">outputId =</span> <span class="st">"table"</span>)</span>
<span id="cb106-34"><a href="#cb106-34" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb106-35"><a href="#cb106-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layout_columns</span>(</span>
<span id="cb106-36"><a href="#cb106-36" aria-hidden="true" tabindex="-1"></a>      <span class="fu">card</span>(<span class="fu">leafletOutput</span>(<span class="st">"carte"</span>)),</span>
<span id="cb106-37"><a href="#cb106-37" aria-hidden="true" tabindex="-1"></a>      <span class="fu">card</span>(<span class="fu">card_header</span>(<span class="st">"FrÃ©quentation d'un aÃ©roport"</span>, <span class="at">class =</span> <span class="st">"bg-dark"</span>),</span>
<span id="cb106-38"><a href="#cb106-38" aria-hidden="true" tabindex="-1"></a>           input_airport,</span>
<span id="cb106-39"><a href="#cb106-39" aria-hidden="true" tabindex="-1"></a>           <span class="fu">plotlyOutput</span>(<span class="st">"lineplot"</span>)</span>
<span id="cb106-40"><a href="#cb106-40" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb106-41"><a href="#cb106-41" aria-hidden="true" tabindex="-1"></a>      <span class="at">col_widths =</span> <span class="fu">c</span>(<span class="dv">12</span>,<span class="dv">12</span>)</span>
<span id="cb106-42"><a href="#cb106-42" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb106-43"><a href="#cb106-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols_widths =</span> <span class="fu">c</span>(<span class="dv">12</span>,<span class="dv">12</span>,<span class="dv">12</span>)</span>
<span id="cb106-44"><a href="#cb106-44" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb106-45"><a href="#cb106-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb106-46"><a href="#cb106-46" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb106-47"><a href="#cb106-47" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<details>
<summary>
Code de <code>server.R</code> Ã  reprendre
</summary>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>server.R</strong></pre>
</div>
<div class="sourceCode" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="cf">function</span>(input, output) {</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>  table_liaisons <span class="ot">=</span> <span class="fu">reactive</span>({</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(</span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summary_stat_airport</span>(</span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">create_data_from_input</span>(</span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>          pax_apt_all,</span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>          <span class="fu">year</span>(input<span class="sc">$</span>date),</span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a>          <span class="fu">month</span>(input<span class="sc">$</span>date)</span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb107-12"><a href="#cb107-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb107-13"><a href="#cb107-13" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb107-14"><a href="#cb107-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-15"><a href="#cb107-15" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>table <span class="ot">&lt;-</span> <span class="fu">render_gt</span>(</span>
<span id="cb107-16"><a href="#cb107-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">create_table_airports</span>(<span class="fu">table_liaisons</span>())</span>
<span id="cb107-17"><a href="#cb107-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb107-18"><a href="#cb107-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb107-19"><a href="#cb107-19" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>carte <span class="ot">&lt;-</span> <span class="fu">renderLeaflet</span>(</span>
<span id="cb107-20"><a href="#cb107-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map_leaflet_airport</span>(</span>
<span id="cb107-21"><a href="#cb107-21" aria-hidden="true" tabindex="-1"></a>      pax_apt_all, airports_location,</span>
<span id="cb107-22"><a href="#cb107-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">month</span>(input<span class="sc">$</span>date), <span class="fu">year</span>(input<span class="sc">$</span>date)</span>
<span id="cb107-23"><a href="#cb107-23" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb107-24"><a href="#cb107-24" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb107-25"><a href="#cb107-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb107-26"><a href="#cb107-26" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>lineplot <span class="ot">&lt;-</span> <span class="fu">renderPlotly</span>(</span>
<span id="cb107-27"><a href="#cb107-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_airport_line</span>(pax_apt_all, input<span class="sc">$</span>select)</span>
<span id="cb107-28"><a href="#cb107-28" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb107-29"><a href="#cb107-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-30"><a href="#cb107-30" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<ol type="1">
<li>Observer la maniÃ¨re dont le fichier <code>ui.R</code> a Ã©voluÃ©.</li>
<li>Observer les nouveaux Ã©lÃ©ments dans <code>server.R</code> et la maniÃ¨re dont ceux-ci sont projetÃ©s ensuite dans lâ€™interface utilisateur</li>
</ol>
</div>
<div id="tabset-34-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-34-2-tab">
<p>Lâ€™exercice prÃ©cÃ©dent Ã©tant assez complet, il suffit pour celui-ci de regarder la diffÃ©rence entre le code prÃ©cÃ©dent et la version Ã  deux colonnes que nous proposons</p>
<details>
<summary>
Code de <code>app.py</code> Ã  reprendre
</summary>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>app.py</strong></pre>
</div>
<div class="sourceCode" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>import pandas as pd</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>import geopandas as gpd</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>import streamlit as st</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>import streamlit.components.v1 as components</span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>from streamlit_folium import st_folium</span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a>import src.import_data as sid</span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a>from src.create_data_list import create_data_list</span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a>from src.divers_functions <span class="fu">import</span> (</span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a>  create_data_from_input,</span>
<span id="cb108-12"><a href="#cb108-12" aria-hidden="true" tabindex="-1"></a>  summary_stat_airport</span>
<span id="cb108-13"><a href="#cb108-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb108-14"><a href="#cb108-14" aria-hidden="true" tabindex="-1"></a>from src.tables import create_table_airports</span>
<span id="cb108-15"><a href="#cb108-15" aria-hidden="true" tabindex="-1"></a>from src.figures import plot_airport_line, map_leaflet_airport</span>
<span id="cb108-16"><a href="#cb108-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-17"><a href="#cb108-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Constants --------------------------------------------------</span></span>
<span id="cb108-18"><a href="#cb108-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-19"><a href="#cb108-19" aria-hidden="true" tabindex="-1"></a>YEARS_LIST <span class="ot">=</span> [<span class="fu">str</span>(year) <span class="cf">for</span> year <span class="cf">in</span> <span class="fu">range</span>(<span class="dv">2018</span>, <span class="dv">2023</span>)]</span>
<span id="cb108-20"><a href="#cb108-20" aria-hidden="true" tabindex="-1"></a>MONTHS_LIST <span class="ot">=</span> <span class="fu">list</span>(<span class="fu">range</span>(<span class="dv">1</span>, <span class="dv">13</span>))</span>
<span id="cb108-21"><a href="#cb108-21" aria-hidden="true" tabindex="-1"></a>default_year <span class="ot">=</span> YEARS_LIST[<span class="dv">0</span>]</span>
<span id="cb108-22"><a href="#cb108-22" aria-hidden="true" tabindex="-1"></a>default_month <span class="ot">=</span> MONTHS_LIST[<span class="dv">0</span>]</span>
<span id="cb108-23"><a href="#cb108-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-24"><a href="#cb108-24" aria-hidden="true" tabindex="-1"></a>urls <span class="ot">=</span> <span class="fu">create_data_list</span>(<span class="st">"./sources.yml"</span>)</span>
<span id="cb108-25"><a href="#cb108-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-26"><a href="#cb108-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Data ---------------------------------------------</span></span>
<span id="cb108-27"><a href="#cb108-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-28"><a href="#cb108-28" aria-hidden="true" tabindex="-1"></a>pax_apt_all <span class="ot">=</span> <span class="fu">sid.import_airport_data</span>(urls[<span class="st">'airports'</span>]<span class="fu">.values</span>())</span>
<span id="cb108-29"><a href="#cb108-29" aria-hidden="true" tabindex="-1"></a>pax_cie_all <span class="ot">=</span> <span class="fu">sid.import_airport_data</span>(urls[<span class="st">'compagnies'</span>]<span class="fu">.values</span>())</span>
<span id="cb108-30"><a href="#cb108-30" aria-hidden="true" tabindex="-1"></a>pax_lsn_all <span class="ot">=</span> <span class="fu">sid.import_airport_data</span>(urls[<span class="st">'liaisons'</span>]<span class="fu">.values</span>())</span>
<span id="cb108-31"><a href="#cb108-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-32"><a href="#cb108-32" aria-hidden="true" tabindex="-1"></a>airports_location <span class="ot">=</span> <span class="fu">gpd.read_file</span>(urls[<span class="st">'geojson'</span>][<span class="st">'airport'</span>])</span>
<span id="cb108-33"><a href="#cb108-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-34"><a href="#cb108-34" aria-hidden="true" tabindex="-1"></a>liste_aeroports <span class="ot">=</span> pax_apt_all[<span class="st">'apt'</span>]<span class="fu">.unique</span>()</span>
<span id="cb108-35"><a href="#cb108-35" aria-hidden="true" tabindex="-1"></a>default_airport <span class="ot">=</span> liste_aeroports[<span class="dv">0</span>]</span>
<span id="cb108-36"><a href="#cb108-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-37"><a href="#cb108-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Data Processing ----------------------------------------------</span></span>
<span id="cb108-38"><a href="#cb108-38" aria-hidden="true" tabindex="-1"></a>pax_apt_all[<span class="st">'trafic'</span>] <span class="ot">=</span> pax_apt_all[<span class="st">'apt_pax_dep'</span>] <span class="sc">+</span>\</span>
<span id="cb108-39"><a href="#cb108-39" aria-hidden="true" tabindex="-1"></a>  pax_apt_all[<span class="st">'apt_pax_tr'</span>] <span class="sc">+</span>\</span>
<span id="cb108-40"><a href="#cb108-40" aria-hidden="true" tabindex="-1"></a>  pax_apt_all[<span class="st">'apt_pax_arr'</span>]</span>
<span id="cb108-41"><a href="#cb108-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-42"><a href="#cb108-42" aria-hidden="true" tabindex="-1"></a>trafic_aeroports <span class="ot">=</span> pax_apt_all.loc[</span>
<span id="cb108-43"><a href="#cb108-43" aria-hidden="true" tabindex="-1"></a>  pax_apt_all[<span class="st">'apt'</span>] <span class="sc">==</span> default_airport</span>
<span id="cb108-44"><a href="#cb108-44" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb108-45"><a href="#cb108-45" aria-hidden="true" tabindex="-1"></a>trafic_aeroports[<span class="st">'date'</span>] <span class="ot">=</span> <span class="fu">pd.to_datetime</span>(</span>
<span id="cb108-46"><a href="#cb108-46" aria-hidden="true" tabindex="-1"></a>  trafic_aeroports[<span class="st">'anmois'</span>] <span class="sc">+</span> <span class="st">'01'</span>, <span class="at">format=</span><span class="st">'%Y%m%d'</span></span>
<span id="cb108-47"><a href="#cb108-47" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb108-48"><a href="#cb108-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-49"><a href="#cb108-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Streamlit Layout --------------------------------------</span></span>
<span id="cb108-50"><a href="#cb108-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-51"><a href="#cb108-51" aria-hidden="true" tabindex="-1"></a><span class="fu">st.set_page_config</span>(</span>
<span id="cb108-52"><a href="#cb108-52" aria-hidden="true" tabindex="-1"></a>  <span class="at">page_title=</span><span class="st">"Tableau de bord des aÃ©roports franÃ§ais"</span>, <span class="at">layout=</span><span class="st">"wide"</span>,</span>
<span id="cb108-53"><a href="#cb108-53" aria-hidden="true" tabindex="-1"></a>  <span class="at">page_icon=</span><span class="st">"âœˆï¸"</span></span>
<span id="cb108-54"><a href="#cb108-54" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb108-55"><a href="#cb108-55" aria-hidden="true" tabindex="-1"></a>col1, col2 <span class="ot">=</span> <span class="fu">st.columns</span>(<span class="dv">2</span>)</span>
<span id="cb108-56"><a href="#cb108-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-57"><a href="#cb108-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-58"><a href="#cb108-58" aria-hidden="true" tabindex="-1"></a><span class="co"># MAIN BODY --------------------------------------</span></span>
<span id="cb108-59"><a href="#cb108-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-60"><a href="#cb108-60" aria-hidden="true" tabindex="-1"></a><span class="co"># COLUMN 1 =======================================</span></span>
<span id="cb108-61"><a href="#cb108-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-62"><a href="#cb108-62" aria-hidden="true" tabindex="-1"></a><span class="fu">col1.markdown</span>(<span class="st">"ğŸ‘‰ï¸ [Retourner au tutoriel pour construire cette application](https://inseefrlab.github.io/funathon2024_sujet2/)"</span>)</span>
<span id="cb108-63"><a href="#cb108-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-64"><a href="#cb108-64" aria-hidden="true" tabindex="-1"></a>selected_date <span class="ot">=</span> <span class="fu">col1.date_input</span>(</span>
<span id="cb108-65"><a href="#cb108-65" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Mois choisi"</span>,</span>
<span id="cb108-66"><a href="#cb108-66" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pd.to_datetime</span>(<span class="st">"2019-01-01"</span>),</span>
<span id="cb108-67"><a href="#cb108-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_value=</span><span class="fu">pd.to_datetime</span>(<span class="st">"2018-01-01"</span>),</span>
<span id="cb108-68"><a href="#cb108-68" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_value=</span><span class="fu">pd.to_datetime</span>(<span class="st">"2022-12-01"</span>)</span>
<span id="cb108-69"><a href="#cb108-69" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb108-70"><a href="#cb108-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-71"><a href="#cb108-71" aria-hidden="true" tabindex="-1"></a>year <span class="ot">=</span> selected_date.year</span>
<span id="cb108-72"><a href="#cb108-72" aria-hidden="true" tabindex="-1"></a>month <span class="ot">=</span> selected_date.month</span>
<span id="cb108-73"><a href="#cb108-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-74"><a href="#cb108-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-75"><a href="#cb108-75" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate using input values</span></span>
<span id="cb108-76"><a href="#cb108-76" aria-hidden="true" tabindex="-1"></a>stats_aeroports <span class="ot">=</span> <span class="fu">summary_stat_airport</span>(</span>
<span id="cb108-77"><a href="#cb108-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">create_data_from_input</span>(pax_apt_all, year, month)</span>
<span id="cb108-78"><a href="#cb108-78" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb108-79"><a href="#cb108-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-80"><a href="#cb108-80" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform GT table into HTML</span></span>
<span id="cb108-81"><a href="#cb108-81" aria-hidden="true" tabindex="-1"></a>table_airports <span class="ot">=</span> (</span>
<span id="cb108-82"><a href="#cb108-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">create_table_airports</span>(stats_aeroports)</span>
<span id="cb108-83"><a href="#cb108-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">.as_raw_html</span>()</span>
<span id="cb108-84"><a href="#cb108-84" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb108-85"><a href="#cb108-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-86"><a href="#cb108-86" aria-hidden="true" tabindex="-1"></a>with col1<span class="sc">:</span></span>
<span id="cb108-87"><a href="#cb108-87" aria-hidden="true" tabindex="-1"></a>    <span class="fu">components.html</span>(table_airports, <span class="at">height=</span><span class="dv">600</span>)</span>
<span id="cb108-88"><a href="#cb108-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-89"><a href="#cb108-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-90"><a href="#cb108-90" aria-hidden="true" tabindex="-1"></a><span class="co"># SECOND COLUMN ===========================</span></span>
<span id="cb108-91"><a href="#cb108-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-92"><a href="#cb108-92" aria-hidden="true" tabindex="-1"></a>with col2<span class="sc">:</span></span>
<span id="cb108-93"><a href="#cb108-93" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Map</span></span>
<span id="cb108-94"><a href="#cb108-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st.subheader</span>(<span class="st">"Carte des aÃ©roports"</span>)</span>
<span id="cb108-95"><a href="#cb108-95" aria-hidden="true" tabindex="-1"></a>  carte_interactive <span class="ot">=</span> <span class="fu">map_leaflet_airport</span>(</span>
<span id="cb108-96"><a href="#cb108-96" aria-hidden="true" tabindex="-1"></a>    pax_apt_all, airports_location, month, year</span>
<span id="cb108-97"><a href="#cb108-97" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb108-98"><a href="#cb108-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_folium</span>(carte_interactive, <span class="at">height=</span><span class="dv">300</span>)</span>
<span id="cb108-99"><a href="#cb108-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-100"><a href="#cb108-100" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Line Plot Output</span></span>
<span id="cb108-101"><a href="#cb108-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st.subheader</span>(<span class="st">"FrÃ©quentation d'un aÃ©roport"</span>)</span>
<span id="cb108-102"><a href="#cb108-102" aria-hidden="true" tabindex="-1"></a>  selected_airport <span class="ot">=</span> <span class="fu">st.selectbox</span>(</span>
<span id="cb108-103"><a href="#cb108-103" aria-hidden="true" tabindex="-1"></a>    <span class="st">"AÃ©roport choisi"</span>, <span class="at">options=</span>liste_aeroports, <span class="at">index=</span><span class="dv">0</span></span>
<span id="cb108-104"><a href="#cb108-104" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb108-105"><a href="#cb108-105" aria-hidden="true" tabindex="-1"></a>  figure_plotly <span class="ot">=</span> <span class="fu">plot_airport_line</span>(pax_apt_all, selected_airport)</span>
<span id="cb108-106"><a href="#cb108-106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st.plotly_chart</span>(figure_plotly)</span>
<span id="cb108-107"><a href="#cb108-107" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-21-contents" aria-controls="callout-21" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<i class="bi bi-book"></i> Exercice 8 (optionnel): amusez-vous Ã  enrichir lâ€™application
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-21" class="callout-21-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Cette application Ã©tait un squelette minimal dâ€™application. Nâ€™hÃ©sitez pas Ã  crÃ©er votre propre version. Voici quelques idÃ©es:</p>
<ul>
<li>Changer lâ€™apparence graphique ;</li>
<li>CrÃ©er une application avec plusieurs pages ;</li>
<li>GÃ©rer la mise en forme diffÃ©rente en fonction de la taille de lâ€™Ã©cran (<em>responsive design</em>) ;</li>
<li>Enrichir les productions graphiques sur lâ€™applicationâ€¦</li>
</ul>
</div>
</div>
</div>
</section>
<section id="partager-cette-application-une-ouverture-vers-la-mise-en-production" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Partager cette application : une ouverture vers la mise en production</h1>

<span class="level-button level-expert">Expert</span>

<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
DifficultÃ© technique de cette partie
</div>
</div>
<div class="callout-body-container callout-body">
<p>Cette partie est <strong>plus avancÃ©e</strong> car elle fait appel Ã  des notions techniques assez complexes dont certaines sortent, Ã  proprement parler, du champ de compÃ©tences des <em>data scientists</em>.</p>
<p>Il est nÃ©anmoins fort utile de dÃ©couvrir celles-ci afin dâ€™Ãªtre autonome dans la mise Ã  disposition de ses applications, un format de valorisation de plus en plus commun.</p>
</div>
</div>
<p>Dans cette partie, on propose de dÃ©ployer lâ€™application sur le <code>SSPCloud</code> et de la rendre accessible depuis Internet. Lâ€™exercice constitue une introduction Ã  la mise en production dâ€™applications dans un environnement <em>cloud</em>. Pour aller plus loin, nâ€™hÃ©sitez pas Ã  consulter <a href="https://ensae-reproductibilite.github.io/website/">ce cours de 3e annÃ©e de lâ€™ENSAE</a>.</p>
<section id="conteneurisation-de-lapplication" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="conteneurisation-de-lapplication"><span class="header-section-number">6.1</span> Conteneurisation de lâ€™application</h2>
<p>Pour dÃ©ployer son application, la premiÃ¨re Ã©tape consiste Ã  la <a href="https://ensae-reproductibilite.github.io/website/chapters/portability.html#les-conteneurs">conteneuriser</a>, ce qui signifie la mettre dans une sorte de boÃ®te virtuelle contenant tout ce dont lâ€™application a besoin pour fonctionner. Le conteneur sÃ©pare lâ€™application de son environnement extÃ©rieur, ce qui permet dâ€™Ã©viter les conflits avec dâ€™autres applications ou dÃ©pendances sur le mÃªme systÃ¨me. Puisque le conteneur contient tout ce dont lâ€™application a besoin (comme les bibliothÃ¨ques et les dÃ©pendances), lâ€™application peut Ãªtre dÃ©placÃ©e et exÃ©cutÃ©e sur nâ€™importe quel systÃ¨me qui supporte les conteneurs, sans se soucier des diffÃ©rences entre ces systÃ¨mes.</p>
<p>Ainsi, conteneuriser une application permet de la rendre plus facile Ã  dÃ©ployer, plus fiable et plus portable (en utilisant efficacement les ressources du systÃ¨me). <code>Docker</code> est un outil populaire pour crÃ©er et gÃ©rer des conteneurs. Le fichier <code>Dockerfile</code> contient le code nÃ©cessaire pour construire lâ€™image <code>Docker</code> de lâ€™application finale situÃ©e dans le rÃ©pertoire <code>correction</code>. Vous pouvez consulter la <a href="https://docs.docker.com/build/building/packaging/">documentation <code>Docker</code></a> pour tenter de comprendre comment lâ€™image est construite.</p>
<p>Nous ne vous demandons pas de construire lâ€™image vous-mÃªme, lâ€™image est dÃ©jÃ  publique sur <a href="https://hub.docker.com/r/inseefrlab/funathon2024-sujet2/"><code>Dockerhub</code></a> et peut-Ãªtre utilisÃ©e pour dÃ©ployer lâ€™application. NÃ©anmoins, il est intÃ©ressant, pour comprendre la logique de fonctionnement de Docker, de regarder la recette de construction de cette image</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-35-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-35-1" role="tab" aria-controls="tabset-35-1" aria-selected="true"><i class="fa-brands fa-r-project" aria-label="r-project"></i></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-35-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-35-2" role="tab" aria-controls="tabset-35-2" aria-selected="false"><i class="fa-brands fa-python" aria-label="python"></i></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-35-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-35-1-tab">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Dockerfile</strong></pre>
</div>
<div class="sourceCode" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>FROM inseefrlab<span class="op">/</span>onyxia<span class="op">-</span>rstudio:r4<span class="fl">.3.2</span><span class="op">-</span><span class="fl">2024.02.13</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Add files necessary for the running app</span></span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>ADD correction<span class="op">/</span><span class="kw">global</span>.R .</span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>ADD correction<span class="op">/</span>ui.R .</span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>ADD correction<span class="op">/</span>server.R .</span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a>ADD correction<span class="op">/</span>sources.yml .</span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a>COPY correction<span class="op">/</span>R R<span class="op">/</span></span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a>ADD renv.lock .</span>
<span id="cb109-10"><a href="#cb109-10" aria-hidden="true" tabindex="-1"></a>ADD renv .</span>
<span id="cb109-11"><a href="#cb109-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-12"><a href="#cb109-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-13"><a href="#cb109-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Expose port where shiny app will broadcast</span></span>
<span id="cb109-14"><a href="#cb109-14" aria-hidden="true" tabindex="-1"></a>ARG SHINY_PORT<span class="op">=</span><span class="dv">3838</span></span>
<span id="cb109-15"><a href="#cb109-15" aria-hidden="true" tabindex="-1"></a>EXPOSE $SHINY_PORT</span>
<span id="cb109-16"><a href="#cb109-16" aria-hidden="true" tabindex="-1"></a>RUN echo <span class="st">"local({options(shiny.port = $</span><span class="sc">{SHINY_PORT}</span><span class="st">, shiny.host = '0.0.0.0')})"</span> <span class="op">&gt;&gt;</span> <span class="op">/</span>usr<span class="op">/</span>local<span class="op">/</span>lib<span class="op">/</span>R<span class="op">/</span>etc<span class="op">/</span>Rprofile.site</span>
<span id="cb109-17"><a href="#cb109-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-18"><a href="#cb109-18" aria-hidden="true" tabindex="-1"></a>RUN Rscript <span class="op">-</span>e <span class="st">"renv::restore()"</span></span>
<span id="cb109-19"><a href="#cb109-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-20"><a href="#cb109-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Endpoint</span></span>
<span id="cb109-21"><a href="#cb109-21" aria-hidden="true" tabindex="-1"></a>CMD [<span class="st">"Rscript"</span>, <span class="st">"-e"</span>, <span class="st">"shiny::runApp()"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-35-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-35-2-tab">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Dockerfile</strong></pre>
</div>
<div class="sourceCode" id="cb110"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>FROM inseefrlab<span class="op">/</span>onyxia<span class="op">-</span>jupyter<span class="op">-</span>python:py3<span class="fl">.10.9</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Add files necessary for the running app</span></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>ADD correction<span class="op">/</span>app.py .</span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>ADD correction<span class="op">/</span>sources.yml .</span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>ADD requirements.txt .</span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Move directories to the project root</span></span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a>COPY correction<span class="op">/</span>src src<span class="op">/</span></span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a>COPY correction<span class="op">/</span>.streamlit .streamlit<span class="op">/</span></span>
<span id="cb110-11"><a href="#cb110-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-12"><a href="#cb110-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-13"><a href="#cb110-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Install dependencies</span></span>
<span id="cb110-14"><a href="#cb110-14" aria-hidden="true" tabindex="-1"></a>RUN pip install <span class="op">-</span>r requirements.txt</span>
<span id="cb110-15"><a href="#cb110-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-16"><a href="#cb110-16" aria-hidden="true" tabindex="-1"></a>EXPOSE <span class="dv">8000</span></span>
<span id="cb110-17"><a href="#cb110-17" aria-hidden="true" tabindex="-1"></a>CMD [<span class="st">"streamlit"</span>, <span class="st">"run"</span>, <span class="st">"app.py"</span>, <span class="st">"--server.port=8000"</span>, <span class="st">"--server.address=0.0.0.0"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>Les principales Ã©tapes de cette construction dâ€™image sont les suivantes :</p>
<ul>
<li>1ï¸âƒ£ On part dâ€™une image de base qui correspond Ã  celle dans laquelle on a dÃ©veloppÃ© notre application et qui fonctionnait. On pourrait partir dâ€™un environnement plus minimaliste (une machine Linux avec seulement <code>R</code> installÃ©, comme les images <a href="https://rocker-project.org/"><code>rocker</code></a>) mais nous aurions peut-Ãªtre Ã  installer des librairies systÃ¨me en plus par un processus dâ€™essai-erreur coÃ»teux en temps.</li>
</ul>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-36-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-36-1" role="tab" aria-controls="tabset-36-1" aria-selected="true"><i class="fa-brands fa-r-project" aria-label="r-project"></i></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-36-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-36-2" role="tab" aria-controls="tabset-36-2" aria-selected="false"><i class="fa-brands fa-python" aria-label="python"></i></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-36-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-36-1-tab">
<details>
<summary>
Partie du <code>Dockerfile</code> en question
</summary>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Dockerfile</strong></pre>
</div>
<div class="sourceCode" id="cb111"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>FROM inseefrlab<span class="op">/</span>onyxia<span class="op">-</span>rstudio:r4<span class="fl">.3.2</span><span class="op">-</span><span class="fl">2024.02.13</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
</div>
<div id="tabset-36-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-36-2-tab">
<details>
<summary>
Partie du <code>Dockerfile</code> en question
</summary>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Dockerfile</strong></pre>
</div>
<div class="sourceCode" id="cb112"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>FROM inseefrlab<span class="op">/</span>onyxia<span class="op">-</span>jupyter<span class="op">-</span>python:py3<span class="fl">.10.9</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
</div>
</div>
</div>
<ul>
<li>2ï¸âƒ£ On ajoute dans le conteneur les fichiers indispensables au fonctionnement de notre application. Le conteneur, par dÃ©faut, nâ€™a pas les fichiers de notre projet, on doit donc dire Ã  <code>Docker</code> quels fichiers on dÃ©sire avoir dans notre application.</li>
</ul>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-37-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-37-1" role="tab" aria-controls="tabset-37-1" aria-selected="true"><i class="fa-brands fa-r-project" aria-label="r-project"></i></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-37-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-37-2" role="tab" aria-controls="tabset-37-2" aria-selected="false"><i class="fa-brands fa-python" aria-label="python"></i></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-37-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-37-1-tab">
<details>
<summary>
Partie du <code>Dockerfile</code> en question
</summary>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Dockerfile</strong></pre>
</div>
<div class="sourceCode" id="cb113" data-startfrom="3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r" style="counter-reset: source-line 2;"><span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Add files necessary for the running app</span></span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>ADD correction<span class="sc">/</span>global.R .</span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>ADD correction<span class="sc">/</span>ui.R .</span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>ADD correction<span class="sc">/</span>server.R .</span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a>ADD correction<span class="sc">/</span>sources.yml .</span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a>COPY correction<span class="sc">/</span>R R<span class="sc">/</span></span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a>ADD renv.lock .</span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a>ADD renv .</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
</div>
<div id="tabset-37-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-37-2-tab">
<details>
<summary>
Partie du <code>Dockerfile</code> en question
</summary>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Dockerfile</strong></pre>
</div>
<div class="sourceCode" id="cb114" data-startfrom="3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python" style="counter-reset: source-line 2;"><span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Add files necessary for the running app</span></span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>ADD correction<span class="op">/</span>app.py .</span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>ADD correction<span class="op">/</span>sources.yml .</span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a>ADD requirements.txt .</span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Move directories to the project root</span></span>
<span id="cb114-9"><a href="#cb114-9" aria-hidden="true" tabindex="-1"></a>COPY correction<span class="op">/</span>src src<span class="op">/</span></span>
<span id="cb114-10"><a href="#cb114-10" aria-hidden="true" tabindex="-1"></a>COPY correction<span class="op">/</span>.streamlit .streamlit<span class="op">/</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
</div>
</div>
</div>
<ul>
<li>3ï¸âƒ£ On dÃ©finit des paramÃ¨tres sur le routage de notre application dans le conteneur (seulement nÃ©cessaire pour la solution <i class="fa-brands fa-r-project" aria-label="r-project"></i>). Ces paramÃ¨tres nous seront utiles ultÃ©rieurement, lors du dÃ©ploiement.</li>
</ul>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-38-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-38-1" role="tab" aria-controls="tabset-38-1" aria-selected="true"><i class="fa-brands fa-r-project" aria-label="r-project"></i></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-38-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-38-2" role="tab" aria-controls="tabset-38-2" aria-selected="false"><i class="fa-brands fa-python" aria-label="python"></i></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-38-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-38-1-tab">
<details>
<summary>
Partie du <code>Dockerfile</code> en question
</summary>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Dockerfile</strong></pre>
</div>
<div class="sourceCode" id="cb115" data-startfrom="13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r" style="counter-reset: source-line 12;"><span id="cb115-13"><a href="#cb115-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Expose port where shiny app will broadcast</span></span>
<span id="cb115-14"><a href="#cb115-14" aria-hidden="true" tabindex="-1"></a>ARG SHINY_PORT<span class="ot">=</span><span class="dv">3838</span></span>
<span id="cb115-15"><a href="#cb115-15" aria-hidden="true" tabindex="-1"></a>EXPOSE <span class="sc">$</span>SHINY_PORT</span>
<span id="cb115-16"><a href="#cb115-16" aria-hidden="true" tabindex="-1"></a>RUN echo <span class="st">"local({options(shiny.port = ${SHINY_PORT}, shiny.host = '0.0.0.0')})"</span> <span class="sc">&gt;</span><span class="er">&gt;</span> <span class="er">/</span>usr<span class="sc">/</span>local<span class="sc">/</span>lib<span class="sc">/</span>R<span class="sc">/</span>etc<span class="sc">/</span>Rprofile.site</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
</div>
<div id="tabset-38-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-38-2-tab">
<p>Cette Ã©tape nâ€™est pas nÃ©cessaire.</p>
</div>
</div>
</div>
<ul>
<li>4ï¸âƒ£ On restaure lâ€™environnement avec <code>renv</code> (<i class="fa-brands fa-r-project" aria-label="r-project"></i>) ou <code>pip</code> (<i class="fa-brands fa-python" aria-label="python"></i>). De cette maniÃ¨re, on est assurÃ© que lâ€™application aura le mÃªme environnement que celui que nous avons prÃ©vu lors de la phase de dÃ©veloppement.</li>
</ul>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-39-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-39-1" role="tab" aria-controls="tabset-39-1" aria-selected="true"><i class="fa-brands fa-r-project" aria-label="r-project"></i></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-39-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-39-2" role="tab" aria-controls="tabset-39-2" aria-selected="false"><i class="fa-brands fa-python" aria-label="python"></i></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-39-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-39-1-tab">
<details>
<summary>
Partie du <code>Dockerfile</code> en question
</summary>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Dockerfile</strong></pre>
</div>
<div class="sourceCode" id="cb116" data-startfrom="18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r" style="counter-reset: source-line 17;"><span id="cb116-18"><a href="#cb116-18" aria-hidden="true" tabindex="-1"></a>RUN Rscript <span class="sc">-</span>e <span class="st">"renv::restore()"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
</div>
<div id="tabset-39-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-39-2-tab">
<details>
<summary>
Partie du <code>Dockerfile</code> en question
</summary>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Dockerfile</strong></pre>
</div>
<div class="sourceCode" id="cb117" data-startfrom="13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python" style="counter-reset: source-line 12;"><span id="cb117-13"><a href="#cb117-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Install dependencies</span></span>
<span id="cb117-14"><a href="#cb117-14" aria-hidden="true" tabindex="-1"></a>RUN pip install <span class="op">-</span>r requirements.txt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
</div>
</div>
</div>
<ul>
<li>5ï¸âƒ£ On dÃ©finit la commande qui sera exÃ©cutÃ©e au lancement de notre application. En lâ€™occurrence, câ€™est une ligne de commande Linux pour lancer lâ€™application <code>Shiny</code> ou <code>Streamlit</code></li>
</ul>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-40-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-40-1" role="tab" aria-controls="tabset-40-1" aria-selected="true"><i class="fa-brands fa-r-project" aria-label="r-project"></i></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-40-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-40-2" role="tab" aria-controls="tabset-40-2" aria-selected="false"><i class="fa-brands fa-python" aria-label="python"></i></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-40-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-40-1-tab">
<details>
<summary>
Partie du <code>Dockerfile</code> en question
</summary>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Dockerfile</strong></pre>
</div>
<div class="sourceCode" id="cb118" data-startfrom="20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r" style="counter-reset: source-line 19;"><span id="cb118-20"><a href="#cb118-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Endpoint</span></span>
<span id="cb118-21"><a href="#cb118-21" aria-hidden="true" tabindex="-1"></a>CMD [<span class="st">"Rscript"</span>, <span class="st">"-e"</span>, <span class="st">"shiny::runApp()"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
</div>
<div id="tabset-40-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-40-2-tab">
<details>
<summary>
Partie du <code>Dockerfile</code> en question
</summary>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Dockerfile</strong></pre>
</div>
<div class="sourceCode" id="cb119" data-startfrom="16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python" style="counter-reset: source-line 15;"><span id="cb119-16"><a href="#cb119-16" aria-hidden="true" tabindex="-1"></a>EXPOSE <span class="dv">8000</span></span>
<span id="cb119-17"><a href="#cb119-17" aria-hidden="true" tabindex="-1"></a>CMD [<span class="st">"streamlit"</span>, <span class="st">"run"</span>, <span class="st">"app.py"</span>, <span class="st">"--server.port=8000"</span>, <span class="st">"--server.address=0.0.0.0"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
</div>
</div>
</div>
<p>Si le <code>Dockerfile</code> est la recette pour crÃ©er notre application, oÃ¹ se trouve la cuisine pour prÃ©parer notre plat ? En gÃ©nÃ©ral, on passe par des systÃ¨mes dâ€™intÃ©gration continue, des serveurs mis Ã  disposition en complÃ©ment de forges <code>Git</code> pour tester le <code>Dockerfile</code>. Pour en savoir plus sur lâ€™intÃ©gration continue, vous pouvez consulter le <a href="https://ensae-reproductibilite.github.io/website/chapters/portability.html#les-conteneurs">cours de 3e annÃ©e de lâ€™ENSAE</a>.</p>
<p>Voici le fichier <code>.github/workflows/app.yaml</code> qui contient la suite dâ€™instruction donnÃ©e aux serveurs de <code>Github</code> pour exÃ©cuter notre chaine de production de lâ€™image <code>Docker</code>. Celui-ci est quasiment une reprise mot pour mot de lâ€™exemple de la <a href="https://docs.github.com/en/actions/creating-actions/creating-a-docker-container-action">documentation Github</a>.</p>
<details>
<summary>
Le <em>workflow</em> <code>Github</code> en question (<i class="fa-brands fa-r-project" aria-label="r-project"></i> et <i class="fa-brands fa-python" aria-label="python"></i>)
</summary>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>.github/workflows/app.yaml</strong></pre>
</div>
<div class="sourceCode" id="cb120"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>name: Dockerize</span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>on:</span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>  push:</span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>    tags:</span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a>      <span class="op">-</span> <span class="st">"*"</span></span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a>    branches:</span>
<span id="cb120-8"><a href="#cb120-8" aria-hidden="true" tabindex="-1"></a>      <span class="op">-</span> main</span>
<span id="cb120-9"><a href="#cb120-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-10"><a href="#cb120-10" aria-hidden="true" tabindex="-1"></a>jobs:</span>
<span id="cb120-11"><a href="#cb120-11" aria-hidden="true" tabindex="-1"></a>  docker<span class="op">-</span>shiny:</span>
<span id="cb120-12"><a href="#cb120-12" aria-hidden="true" tabindex="-1"></a>    runs<span class="op">-</span>on: ubuntu<span class="op">-</span>latest</span>
<span id="cb120-13"><a href="#cb120-13" aria-hidden="true" tabindex="-1"></a>    steps:</span>
<span id="cb120-14"><a href="#cb120-14" aria-hidden="true" tabindex="-1"></a>      <span class="op">-</span> uses: actions<span class="op">/</span>checkout<span class="op">@</span>v4</span>
<span id="cb120-15"><a href="#cb120-15" aria-hidden="true" tabindex="-1"></a>      <span class="op">-</span> name: Docker meta</span>
<span id="cb120-16"><a href="#cb120-16" aria-hidden="true" tabindex="-1"></a>        <span class="bu">id</span>: docker_meta</span>
<span id="cb120-17"><a href="#cb120-17" aria-hidden="true" tabindex="-1"></a>        uses: docker<span class="op">/</span>metadata<span class="op">-</span>action<span class="op">@</span>v5</span>
<span id="cb120-18"><a href="#cb120-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span>:</span>
<span id="cb120-19"><a href="#cb120-19" aria-hidden="true" tabindex="-1"></a>          images: inseefrlab<span class="op">/</span>funathon2024<span class="op">-</span>sujet2</span>
<span id="cb120-20"><a href="#cb120-20" aria-hidden="true" tabindex="-1"></a>      <span class="op">-</span> name: Set up QEMU</span>
<span id="cb120-21"><a href="#cb120-21" aria-hidden="true" tabindex="-1"></a>        uses: docker<span class="op">/</span>setup<span class="op">-</span>qemu<span class="op">-</span>action<span class="op">@</span>v3</span>
<span id="cb120-22"><a href="#cb120-22" aria-hidden="true" tabindex="-1"></a>      <span class="op">-</span> name: Set up Docker Buildx</span>
<span id="cb120-23"><a href="#cb120-23" aria-hidden="true" tabindex="-1"></a>        uses: docker<span class="op">/</span>setup<span class="op">-</span>buildx<span class="op">-</span>action<span class="op">@</span>v3</span>
<span id="cb120-24"><a href="#cb120-24" aria-hidden="true" tabindex="-1"></a>      <span class="op">-</span> name: Login to DockerHub</span>
<span id="cb120-25"><a href="#cb120-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>: github.event_name <span class="op">!=</span> <span class="st">'pull_request'</span></span>
<span id="cb120-26"><a href="#cb120-26" aria-hidden="true" tabindex="-1"></a>        uses: docker<span class="op">/</span>login<span class="op">-</span>action<span class="op">@</span>v3</span>
<span id="cb120-27"><a href="#cb120-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span>:</span>
<span id="cb120-28"><a href="#cb120-28" aria-hidden="true" tabindex="-1"></a>          username: ${{ secrets.DOCKERHUB_USERNAME }}</span>
<span id="cb120-29"><a href="#cb120-29" aria-hidden="true" tabindex="-1"></a>          password: ${{ secrets.DOCKERHUB_TOKEN }}</span>
<span id="cb120-30"><a href="#cb120-30" aria-hidden="true" tabindex="-1"></a>      <span class="op">-</span> name: Build <span class="kw">and</span> push</span>
<span id="cb120-31"><a href="#cb120-31" aria-hidden="true" tabindex="-1"></a>        uses: docker<span class="op">/</span>build<span class="op">-</span>push<span class="op">-</span>action<span class="op">@</span>v6</span>
<span id="cb120-32"><a href="#cb120-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span>:</span>
<span id="cb120-33"><a href="#cb120-33" aria-hidden="true" tabindex="-1"></a>          context: .</span>
<span id="cb120-34"><a href="#cb120-34" aria-hidden="true" tabindex="-1"></a>          <span class="bu">file</span>: .<span class="op">/</span>docker<span class="op">/</span>Dockerfile</span>
<span id="cb120-35"><a href="#cb120-35" aria-hidden="true" tabindex="-1"></a>          push: ${{ github.event_name <span class="op">!=</span> <span class="st">'pull_request'</span> }}</span>
<span id="cb120-36"><a href="#cb120-36" aria-hidden="true" tabindex="-1"></a>          tags: <span class="op">|</span></span>
<span id="cb120-37"><a href="#cb120-37" aria-hidden="true" tabindex="-1"></a>            ${{ steps.docker_meta.outputs.tags }}</span>
<span id="cb120-38"><a href="#cb120-38" aria-hidden="true" tabindex="-1"></a>            ${{ github.ref <span class="op">==</span> <span class="st">'refs/heads/main'</span> <span class="op">&amp;&amp;</span> <span class="st">'inseefrlab/funathon2024-sujet2:shiny-test2'</span> <span class="op">||</span> <span class="st">''</span> }}</span>
<span id="cb120-39"><a href="#cb120-39" aria-hidden="true" tabindex="-1"></a>          labels: ${{ steps.docker_meta.outputs.labels }}</span>
<span id="cb120-40"><a href="#cb120-40" aria-hidden="true" tabindex="-1"></a>      <span class="op">-</span> name: Image digest</span>
<span id="cb120-41"><a href="#cb120-41" aria-hidden="true" tabindex="-1"></a>        run: echo ${{ steps.docker_build.outputs.digest }}</span>
<span id="cb120-42"><a href="#cb120-42" aria-hidden="true" tabindex="-1"></a>  docker<span class="op">-</span>streamlit:</span>
<span id="cb120-43"><a href="#cb120-43" aria-hidden="true" tabindex="-1"></a>    runs<span class="op">-</span>on: ubuntu<span class="op">-</span>latest</span>
<span id="cb120-44"><a href="#cb120-44" aria-hidden="true" tabindex="-1"></a>    steps:</span>
<span id="cb120-45"><a href="#cb120-45" aria-hidden="true" tabindex="-1"></a>      <span class="op">-</span> uses: actions<span class="op">/</span>checkout<span class="op">@</span>v4</span>
<span id="cb120-46"><a href="#cb120-46" aria-hidden="true" tabindex="-1"></a>      <span class="op">-</span> name: Docker meta</span>
<span id="cb120-47"><a href="#cb120-47" aria-hidden="true" tabindex="-1"></a>        <span class="bu">id</span>: docker_meta</span>
<span id="cb120-48"><a href="#cb120-48" aria-hidden="true" tabindex="-1"></a>        uses: docker<span class="op">/</span>metadata<span class="op">-</span>action<span class="op">@</span>v5</span>
<span id="cb120-49"><a href="#cb120-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span>:</span>
<span id="cb120-50"><a href="#cb120-50" aria-hidden="true" tabindex="-1"></a>          images: inseefrlab<span class="op">/</span>funathon2024<span class="op">-</span>sujet2</span>
<span id="cb120-51"><a href="#cb120-51" aria-hidden="true" tabindex="-1"></a>      <span class="op">-</span> name: Set up QEMU</span>
<span id="cb120-52"><a href="#cb120-52" aria-hidden="true" tabindex="-1"></a>        uses: docker<span class="op">/</span>setup<span class="op">-</span>qemu<span class="op">-</span>action<span class="op">@</span>v3</span>
<span id="cb120-53"><a href="#cb120-53" aria-hidden="true" tabindex="-1"></a>      <span class="op">-</span> name: Set up Docker Buildx</span>
<span id="cb120-54"><a href="#cb120-54" aria-hidden="true" tabindex="-1"></a>        uses: docker<span class="op">/</span>setup<span class="op">-</span>buildx<span class="op">-</span>action<span class="op">@</span>v3</span>
<span id="cb120-55"><a href="#cb120-55" aria-hidden="true" tabindex="-1"></a>      <span class="op">-</span> name: Login to DockerHub</span>
<span id="cb120-56"><a href="#cb120-56" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>: github.event_name <span class="op">!=</span> <span class="st">'pull_request'</span></span>
<span id="cb120-57"><a href="#cb120-57" aria-hidden="true" tabindex="-1"></a>        uses: docker<span class="op">/</span>login<span class="op">-</span>action<span class="op">@</span>v3</span>
<span id="cb120-58"><a href="#cb120-58" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span>:</span>
<span id="cb120-59"><a href="#cb120-59" aria-hidden="true" tabindex="-1"></a>          username: ${{ secrets.DOCKERHUB_USERNAME }}</span>
<span id="cb120-60"><a href="#cb120-60" aria-hidden="true" tabindex="-1"></a>          password: ${{ secrets.DOCKERHUB_TOKEN }}</span>
<span id="cb120-61"><a href="#cb120-61" aria-hidden="true" tabindex="-1"></a>      <span class="op">-</span> name: Build <span class="kw">and</span> push</span>
<span id="cb120-62"><a href="#cb120-62" aria-hidden="true" tabindex="-1"></a>        uses: docker<span class="op">/</span>build<span class="op">-</span>push<span class="op">-</span>action<span class="op">@</span>v6</span>
<span id="cb120-63"><a href="#cb120-63" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span>:</span>
<span id="cb120-64"><a href="#cb120-64" aria-hidden="true" tabindex="-1"></a>          context: .</span>
<span id="cb120-65"><a href="#cb120-65" aria-hidden="true" tabindex="-1"></a>          <span class="bu">file</span>: .<span class="op">/</span>docker<span class="op">/</span>Dockerfile_python</span>
<span id="cb120-66"><a href="#cb120-66" aria-hidden="true" tabindex="-1"></a>          push: ${{ github.event_name <span class="op">!=</span> <span class="st">'pull_request'</span> }}</span>
<span id="cb120-67"><a href="#cb120-67" aria-hidden="true" tabindex="-1"></a>          tags: <span class="op">|</span></span>
<span id="cb120-68"><a href="#cb120-68" aria-hidden="true" tabindex="-1"></a>            ${{ steps.docker_meta.outputs.tags }}</span>
<span id="cb120-69"><a href="#cb120-69" aria-hidden="true" tabindex="-1"></a>            ${{ github.ref <span class="op">==</span> <span class="st">'refs/heads/main'</span> <span class="op">&amp;&amp;</span> <span class="st">'inseefrlab/funathon2024-sujet2:streamlit-test2'</span> <span class="op">||</span> <span class="st">''</span> }}</span>
<span id="cb120-70"><a href="#cb120-70" aria-hidden="true" tabindex="-1"></a>          labels: ${{ steps.docker_meta.outputs.labels }}</span>
<span id="cb120-71"><a href="#cb120-71" aria-hidden="true" tabindex="-1"></a>      <span class="op">-</span> name: Image digest</span>
<span id="cb120-72"><a href="#cb120-72" aria-hidden="true" tabindex="-1"></a>        run: echo ${{ steps.docker_build.outputs.digest }}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
</section>
<section id="utilisation-de-limage-docker-pour-mettre-Ã -disposition-le-shiny-ou-streamlit" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="utilisation-de-limage-docker-pour-mettre-Ã -disposition-le-shiny-ou-streamlit"><span class="header-section-number">6.2</span> Utilisation de lâ€™image Docker pour mettre Ã  disposition le <code>Shiny</code> ou <code>Streamlit</code></h2>
<p>Nous avons crÃ©Ã© une image Docker qui est disponible sur Dockerhub, le rÃ©seau social de Docker. Pour rendre celle-ci vivante, nous devons la dÃ©ployer dans un conteneur.</p>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-23-contents" aria-controls="callout-23" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<i class="bi bi-book"></i> Exercice 7 : DÃ©ploiement de lâ€™application Shiny
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-23" class="callout-23-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Lâ€™image peut Ã  prÃ©sent Ãªtre rÃ©cupÃ©rÃ©e et dÃ©ployÃ©e. Dans notre cas, on va la dÃ©ployer sur un cluster Kubernetes, lâ€™infrastructure sous-jacente du SSP Cloud. Le fonctionnement de Kubernetes est technique et nous ne rentrerons pas dans les dÃ©tails ici. Les fichiers nÃ©cessaires au dÃ©ploiement se trouvent dans un dÃ©pÃ´t sÃ©parÃ© (https://github.com/InseeFrLab/funathon2024_sujet2_cd), nommÃ© dÃ©pÃ´t <a href="https://docs.github.com/en/actions/creating-actions/creating-a-docker-container-action">Git-ops</a>.</p>
<p>Afin de dÃ©ployer lâ€™application, suivre les instructions suivantes :</p>
<ul>
<li>Ouvrir un <code>Terminal</code>;</li>
<li>ClÃ´ner le dÃ©pÃ´t (<code>git clone https://github.com/InseeFrLab/funathon2024_sujet2_cd</code>)</li>
<li>Se placer Ã  la racine du projet (<code>cd funathon2024_sujet2_cd</code>);</li>
<li>Inspecter les fichiers <code>shiny/deployment.yml</code>, <code>shiny/service.yml</code> et <code>shiny/ingress.yml</code> (parcours <i class="fa-brands fa-r-project" aria-label="r-project"></i>) ou <code>streamlit/deployment.yml</code>, <code>streamlit/service.yml</code> et <code>streamlit/ingress.yml</code> (parcours <i class="fa-brands fa-python" aria-label="python"></i>) et repÃ©rer les Ã©lÃ©ments suivants :
<ul>
<li>Lâ€™emplacement oÃ¹ est spÃ©cifiÃ© lâ€™image Ã  dÃ©ployer;</li>
<li>Lâ€™emplacement oÃ¹ sont spÃ©cifiÃ©es les ressources computationnelles allouÃ©es;</li>
<li>Lâ€™emplacement oÃ¹ est spÃ©cifiÃ©e lâ€™URL Ã  laquelle sera exposÃ©e lâ€™application sur Internet. La modifier (Ã  2 reprises) pour y indiquer une adresse personalisÃ©e pour le dÃ©ploiement. Seule contrainte, elle doit Ãªtre de la forme <code>*.lab.sspcloud.fr</code>;</li>
</ul></li>
<li>Appliquer les contrats Kubernetes avec la commande <code>kubectl apply -f shiny/</code> ou <code>kubectl apply -f streamlit/</code> selon le langage utilisÃ© ;</li>
<li>VÃ©rifier le lancement du conteneur avec la commande <code>kubectl get pods</code>. Le nom associÃ© devrait Ãªtre de la forme <code>funathon2024-sujet2-deployment-*</code>;</li>
<li>Attendre que le conteneur obtienne le statut <code>Running</code>.</li>
<li>Copier le nom associÃ© Ã  votre service et faire <code>kubectl logs &lt;nom_copiÃ©&gt;</code>.</li>
</ul>
<ol start="3" type="1">
<li>Entrer dans un navigateur lâ€™URL spÃ©cifiÃ©e dans le fichier <code>streamlit/ingress.yaml</code> ou <code>shiny/ingress.yaml</code>, et vÃ©rifier que lâ€™application fonctionne correctement ! Jouer avec et observer, dans le terminal que vous aviez ouvert, lâ€™Ã©volution de vos <em>logs</em> quand vous faites une action.</li>
</ol>
</div>
</div>
</div>


</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Pour le crÃ©er, vous pouvez taper <kbd>F1</kbd> et dans la barre qui sâ€™ouvre, taper <em>notebook</em> et cliquer sur <code>Create: New Jupyter Notebook</code>. Enregistrer le fichier<a href="#fnref1" class="footnote-back" role="doc-backlink">â†©ï¸</a></p></li>
<li id="fn2"><p>Ces fichiers ne sont pas gÃ©nÃ©rÃ©s manuellement. Ce sont des outils adaptÃ©s (<code>renv</code> pour <code>R</code>, <code>pip</code> pour <code>Python</code>) qui font ce travail de versionnage de lâ€™environnement.<a href="#fnref2" class="footnote-back" role="doc-backlink">â†©ï¸</a></p></li>
<li id="fn3"><p>Si vous utilisez <code>renv</code> dans vos futurs projets, ce que nous vous recommandons, cette commande nâ€™est pas Ã  inscrire dans vos scripts. Vous pouvez indiquer que cette commande est nÃ©cessaire dans le <code>README</code> de votre projet.<a href="#fnref3" class="footnote-back" role="doc-backlink">â†©ï¸</a></p></li>
<li id="fn4"><p>Si vous Ãªtes peu familier avec ce type de fichiers, vous pouvez consulter la <a href="https://book.utilitr.org/03_Fiches_thematiques/Fiche_import_fichiers_plats.html">fiche <code>utilitR</code></a> sur le sujet (<i class="fa-brands fa-r-project" aria-label="r-project"></i>)<a href="#fnref4" class="footnote-back" role="doc-backlink">â†©ï¸</a></p></li>
<li id="fn5"><p>Si vous Ãªtes peu familier avec les donnÃ©es gÃ©ographiques, vous pouvez retenir lâ€™idÃ©e quâ€™il sâ€™agit de donnÃ©es traditionnelles auxquelles sâ€™ajoute une dimension spatiale. Cette derniÃ¨re vise Ã  localiser les donnÃ©es sur la terre. La localisation se fait dans un espace Ã  deux dimensions (espace cartÃ©sien) alors que notre planÃ¨te est une sphÃ¨re en trois dimensions. Le principe dâ€™un systÃ¨me de projection est de faire ce passage en deux dimensions des positions. Le plus connu est le systÃ¨me GPS, qui est un hÃ©ritier lointain de la reprÃ©sentation du monde par <a href="https://fr.wikipedia.org/wiki/G%C3%A9rard_Mercator">Mercator</a>. Ce systÃ¨me est connu sous le nom de WGS 84 et porte le code EPSG 4326. Lâ€™autre systÃ¨me Ã  retenir est le Lambert 93 (code EPSG 2154) qui est la projection lÃ©gale en France (celle-ci, <em>a contrario</em> du Mercator, ne dÃ©forme pas la France sur une carte). Pour en savoir plus sur les systÃ¨mes de reprÃ©sentation, les avantages et inconvÃ©nients de chacun, il existe de nombreuses ressources en ligne. Des Ã©lÃ©ments introductifs, et des dÃ©monstrations interactives, en lien avec la librairie <code>Geopandas</code> de <code>Python</code> sont disponibles <a href="https://pythonds.linogaliana.fr/content/manipulation/03_geopandas_intro.html#principe">ici</a>.<a href="#fnref5" class="footnote-back" role="doc-backlink">â†©ï¸</a></p></li>
<li id="fn6"><p>Vous perdrez la mise en forme du <em>header</em> du tableau qui nâ€™est pas conciliable avec lâ€™interactivitÃ©.<a href="#fnref6" class="footnote-back" role="doc-backlink">â†©ï¸</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>