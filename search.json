[
  {
    "objectID": "old/RTraffic.html",
    "href": "old/RTraffic.html",
    "title": "RTraffic",
    "section": "",
    "text": "1 Param√®tres\n\nif (!requireNamespace(\"DT\")){install.packages(\"DT\")} #install.packages(\"DT\")#if necessary install package\nt0 = Sys.time()\n\n#stocke les chemins vers les donn√©es de trafic dans l'objet \"paths\"\nyear_num = 2018:2022 #to be modified eg c(2019,2022,2023) \nyear_char = as.list(as.character(year_num))\nmonth_char = c(paste0(\"0\", 1:9),10:12)\npaths = data.frame(year_num, c(\"https://www.data.gouv.fr/fr/datasets/r/3b7646ea-276c-4c9b-8151-1e96af2adbf9\", \"https://www.data.gouv.fr/fr/datasets/r/e8efa154-045e-4f8f-a1d7-76a39fa03b7b\", \"https://www.data.gouv.fr/fr/datasets/r/6717f107-be00-4b4b-9706-fa0e5190fb69\", \"https://www.data.gouv.fr/fr/datasets/r/2f9f6e54-e2d7-4e85-b811-2e5e68fa5bca\", \"https://www.data.gouv.fr/fr/datasets/r/f1bd931e-c99e-41ce-865e-9e9785c903ec\"),#url donn√©es trafic apt-a√©roports sur data.gouv.fr\nc(\"https://www.data.gouv.fr/fr/datasets/r/9c5354ad-31cb-4217-bc88-fb7c9be22655\", \"https://www.data.gouv.fr/fr/datasets/r/0c0a451e-983b-4f06-9627-b5ff1bccd2fc\", \"https://www.data.gouv.fr/fr/datasets/r/dad30bed-7276-4a67-a1ab-a856e6e01788\", \"https://www.data.gouv.fr/fr/datasets/r/bbf6492d-86ac-43a0-9260-7df2ffdb5a77\", \"https://www.data.gouv.fr/fr/datasets/r/af8950bc-e90a-4b7e-bb81-70c79d4c3846\" ),#url donn√©es trafic lsn-liaisons sur data.gouv.fr\nc(\"https://www.data.gouv.fr/fr/datasets/r/ddfea6a0-df7e-4402-99fc-165f573f2e10\", \"https://www.data.gouv.fr/fr/datasets/r/8421e029-c8c7-410d-b38c-54455ac3265d\", \"https://www.data.gouv.fr/fr/datasets/r/818eec10-6122-4788-8233-482e779ab837\", \"https://www.data.gouv.fr/fr/datasets/r/0b954774-ccd1-43ec-9b5a-f958fba03e87\", \"https://www.data.gouv.fr/fr/datasets/r/bcec3e1e-940a-4772-bc28-0d7b2b53c718\")#url donn√©es trafic cie-compagnies sur data.gouv.fr\n)\nnames(paths) = c(\"year\",\"apt\",\"lsn\",\"cie\")\n\n#charge les fonctions utiles----\nsimplify_text = function(texte){#fonction qui simplifie le texte en retirant la ponctuation et les accents\n  texte=tolower(texte)\n  texte=str_replace_all(texte,\"[:punct:]\",\"\")\n  texte=str_replace_all(texte,\"[:space:]\",\"\")\n  texte=str_replace_all(texte,\"[√†√¢√§]\",\"a\")\n  texte=str_replace_all(texte,\"[√ß]\",\"c\")\n  texte=str_replace_all(texte,\"[√©√®√™√´]\",\"e\")\n  texte=str_replace_all(texte,\"[√Æ√Ø]\",\"i\")\n  texte=str_replace_all(texte,\"[√¥√∂]\",\"o\")\n  texte=str_replace_all(texte,\"[√π√ª√º]\",\"u\")\n  return(texte)}\n    \nload_data = function(data_typ){#fonction qui charge les donn√©es dans un dataframe\n  df = NULL\n  for (i in paths[[1]]){\n    print(paste0(data_typ,\" \",i))\n    x = paths %&gt;%\n      select(\"year\", all_of(data_typ)) %&gt;% \n      filter(year == i) #filtre sur l'ann√©e s√©lectionn√©e\n    df = rbind(df,read.csv(x[[2]], sep = \";\", dec = \",\")) #empile le dataframe sur le pr√©c√©dent\n    }\n  df = df %&gt;% \n    mutate(an = str_sub(ANMOIS,1,4)) %&gt;%\n    mutate(mois = str_sub(ANMOIS,5,6))\n  names(df)=simplify_text(names(df))\n  rm(x,i)\n  return(df)\n  }\n\n#charge les donn√©es avec la fonction load_data----\npax_apt = load_data(\"apt\")\npax_cie = load_data(\"cie\")\npax_lsn = load_data(\"lsn\")\ndata_already_loaded = TRUE\nprint(Sys.time()-t0) #mesure le temps machine----\n\n\n\n2 ui\n\nui &lt;- function() {\nfluidPage(\n  verbatimTextOutput(outputId = \"texte\"),\n  checkboxGroupInput(\"mon\", \"Mois : \",\n                     month_char,\n                     inline = T),\n  radioButtons(\"yea\", \"Ann√©e : \",\n                     year_char,\n                     inline = T),\n  DT::dataTableOutput(\"table1\"),\n  DT::dataTableOutput(\"table2\")\n)\n}\n\n\n\n3 server\n\nserver &lt;- function(input, output, session) {\n  output$texte &lt;- renderText({\n    paste0(\"Pax in France - DGAC on data.gouv.fr\")\n  })\n  #cr√©√© de la r√©activit√©----\n  dfapt = reactive({\n    return(pax_apt %&gt;% filter((mois %in% input$mon)&(an == input$yea)))\n  })\n  dflsn = reactive({\n    return(pax_lsn %&gt;% filter((mois %in% input$mon)&(an == input$yea)))\n  })\n  \n  #cr√©√© une table1 de stat par faisceau √† partir des donn√©es par lsn-liaisons----\n  output$table1 &lt;- DT::renderDataTable(DT::datatable({\n    data = bind_cols(\n      bind_rows(\n        dflsn() %&gt;% summarise(paxloc = round(sum(lsnpaxloc, na.rm = T)/1000000,3)),\n        dflsn() %&gt;%\n          group_by(lsnfsc) %&gt;%\n          summarise(paxloc = round(sum(lsnpaxloc, na.rm = T)/1000000,3)) %&gt;%\n          ungroup\n      )\n    )\n  }, class = \"cell-border compact hover stripe\",\n  options = list(\n    autoWidth = T,\n    columnDefs = list(list(width = '20px', targets = c(0,1,2))),\n    dom = \"Bfrtip\", \n    scrollY = 145, scrollX = 400, scroller = TRUE,\n    fixedColumns = list(leftColumns = 1),\n    select = list(style = 'os', items = 'row'),\n    buttons = c(\n      'copy', 'csv',\n      'colvis',\n      'selectAll', 'selectNone', 'selectRows', 'selectColumns', 'selectCells'\n    )\n  )))\n  \n  #cr√©√© une table2 de stat par a√©roport √† partir des donn√©es par apt-a√©roports----\n  output$table2 = DT::renderDataTable(DT::datatable({\n    data = bind_rows(\n      dfapt() %&gt;%\n        group_by(apt, aptnom) %&gt;%\n        summarise(paxdep = round(sum(aptpaxdep, na.rm = T)/1000000,3), paxarr = round(sum(aptpaxarr, na.rm = T)/1000000,3), paxtra = round(sum(aptpaxtr, na.rm = T)/1000000,3)) %&gt;%\n        arrange(desc(paxdep)) %&gt;%\n        ungroup\n    )\n  }, class = \"cell-border compact hover stripe\",\n  extensions = c(\"Scroller\", \"FixedColumns\", \"Buttons\", \"Select\"), \n  selection = \"none\",\n  options = list(\n    autoWidth = T,\n    columnDefs = list(list(width = '20px', targets = c(0,1,2))),\n    dom = \"Bfrtip\", \n    scrollY = 145, scrollX = 400, scroller = TRUE,\n    fixedColumns = list(leftColumns = 1),\n    select = list(style = 'os', items = 'row'),\n    buttons = c(\n      'copy', 'csv',\n      'colvis',\n      'selectAll', 'selectNone', 'selectRows', 'selectColumns', 'selectCells'\n    )\n  )))\n  }\n\n\n\n4 shiny\n\nshinyApp(ui, server)#lance le tableau de bord en shiny"
  },
  {
    "objectID": "index.html#objectif",
    "href": "index.html#objectif",
    "title": "Un tableau de bord du trafic a√©rien avec  ou ",
    "section": "0.1 Objectif",
    "text": "0.1 Objectif\nL‚Äôobjectif de ce tutoriel est d‚Äôamener, pas √† pas, √† la conception voire √† la mise √† disposition d‚Äôun tableau de bord (dashboard) du trafic a√©rien avec . Une d√©monstration de cette application est disponible √† l‚Äôadresse https://rplane-dashboard.kub.sspcloud.fr/.\nAfin de se concentrer sur la d√©marche, cette application interactive pr√©sentera un nombre limit√© de fonctionnalit√©s limit√©es. L‚Äôobjectif est de construire progressivement celle-ci en suivant les √©tapes logiques du d√©roulement d‚Äôun projet de d√©veloppement d‚Äôapplication interactive: d√©couverte et exploration des donn√©es, cr√©ation de statistiques descriptives et de visualisations simples sur un jeu de donn√©es, extension du nombre de visualisations accessibles par la cr√©ation d‚Äôune application. Ce tutoriel est √©galement l‚Äôoccasion de d√©couvrir quelques bonnes pratiques de programmation avec  afin de rendre les projets plus fiables, √©volutifs et lisibles.\nLes exercices de conception pas √† pas de l‚Äôapplication s‚Äôadressent aussi bien √† des d√©butants qu‚Äô√† des utilisateurs plus experts. La mise √† disposition, c‚Äôest-√†-dire la mise en production de cette application, fait appel √† des concepts et outils plus avanc√©s et est donc moins accessible √† des d√©butants.\n\n\n\n\n\n\nTip\n\n\n\nSi vous d√©sirez aller plus loin sur certaines dimensions de ce projet, vous pouvez tout √† fait essayer de vous-m√™mes d‚Äôintroduire de nouveaux ingr√©dients dans l‚Äôapplication que vous d√©veloppez."
  },
  {
    "objectID": "index.html#pourquoi-faire-une-application-interactive",
    "href": "index.html#pourquoi-faire-une-application-interactive",
    "title": "Un tableau de bord du trafic a√©rien avec  ou ",
    "section": "0.2 Pourquoi faire une application interactive ?",
    "text": "0.2 Pourquoi faire une application interactive ?\nCette question peut appara√Ætre naive. Pourtant, elle m√©rite d‚Äô√™tre pos√©e car elle permet de r√©fl√©chir √† la cible de l‚Äôapplication,\nElle est n√©anmoins fondamentale car elle d√©finit la nature de la"
  },
  {
    "objectID": "index.html#pr√©liminaire-r√©cup√©rer-le-projet-squelette-avec-git-fa-brands-git-alt",
    "href": "index.html#pr√©liminaire-r√©cup√©rer-le-projet-squelette-avec-git-fa-brands-git-alt",
    "title": "Un tableau de bord du trafic a√©rien avec  ou ",
    "section": "1.1 Pr√©liminaire: r√©cup√©rer le projet squelette avec Git ",
    "text": "1.1 Pr√©liminaire: r√©cup√©rer le projet squelette avec Git \nSi vous disposez d‚Äôun compte sur le sspcloud, la m√©thode recommand√©e pour se lancer dans ce tutoriel est de cliquer sur le bouton suivant\n\n\n\n\nSi vous avez utilis√© le lien de lancement rapide mis √† disposition sur la page inseefrlab.github.io/funathon2024/ ou ci-dessus, vous pouvez sauter l‚Äô√©tape de r√©cup√©ration du mod√®le de projet avec Git, cela a √©t√© fait automatiquement lors de la cr√©ation de votre environnement RStudio.\n\n\n\n\n\n\nR√©cup√©rer le projet si vous n‚Äôavez pas utilis√© le bouton propos√©\n\n\n\n\n\n\nInterface graphiqueDepuis le terminal\n\n\nLa fiche utilitR sur l‚Äôutilisation de Git explicite la d√©marche g√©n√©rale pour r√©cup√©rer du code gr√¢ce √† Git. Il est recommand√© de lire celle-ci si vous n‚Äô√™tes pas familier de Git.\nLes √©tapes suivantes permettront de r√©cup√©rer le projet:\n1Ô∏è‚É£ En premier lieu, dans RStudio, cr√©er un nouveau projet et s√©lectionner Version Control.\n\n2Ô∏è‚É£ Choisir Git, ce qui devrait ouvrir une fen√™tre similaire √† celle ci-dessous:\n\n3Ô∏è‚É£ Dans la fen√™tre Repository URL, passer la valeur\nhttps://github.com/inseefrlab/funathon2024_sujet2.git\nlaisser les valeurs par d√©faut qui viennent ensuite et cr√©er le projet.\n\n\nApr√®s avoir ouvert un terminal dans RStudio, faire\ngit clone https://github.com/inseefrlab/funathon2024_sujet2.git\npuis, dans l‚Äôexplorateur de fichiers (fen√™tre en bas √† droite), cliquer sur le fichier RTraffic.Rproj pour ouvrir le projet.\n\n\n\n\n\n\nLe projet r√©cup√©r√© comporte de nombreux fichiers. Nous allons progressivement les d√©couvrir dans ce tutoriel. A l‚Äôheure actuelle, on peut se concentrer sur les fichiers suivants:\n|- renv.lock\n|- global.R\n|- server.R\n|- ui.R\nLe premier fichier correspond √† la liste des packages n√©cessaires pour reproduire l‚Äôenvironnement. Il a √©t√© g√©n√©r√© automatiquement gr√¢ce √† un √©cosyst√®me renv particuli√®rement adapt√© pour assurer la reproductibilit√© de projets R (voir la suite).\nLes fichiers server.R et ui.R constituent le coeur de notre application Shiny. Ils repr√©sentent, respectivement, le moteur de calcul (le serveur) et l‚Äôinterface utilisateur de notre application. Le fichier global.R stocke un certain nombre d‚Äôobjets utiles √† l‚Äôapplication mais qui n‚Äôont pas besoin d‚Äô√™tre recalcul√© √† chaque action sur l‚Äôinterface graphique."
  },
  {
    "objectID": "index.html#installer-les-packages-n√©cessaires-pour-ce-tutoriel",
    "href": "index.html#installer-les-packages-n√©cessaires-pour-ce-tutoriel",
    "title": "Un tableau de bord du trafic a√©rien avec  ou ",
    "section": "1.2 Installer les packages n√©cessaires pour ce tutoriel",
    "text": "1.2 Installer les packages n√©cessaires pour ce tutoriel\n\n1.2.1 Principe\nPour progresser dans ce tutoriel, un certain nombre de packages doivent √™tre install√©s. Sans eux, m√™me avec le code de l‚Äôapplication, vous ne serez pas en mesure de reproduire celle-ci.\nLes bonnes pratiques pour la gestion de l‚Äôenvironnement sont assez proches en  et . Le principal g√©n√©ral est qu‚Äôil existe des outils qui permettent √† un utilisateur de lister l‚Äôensemble des packages dans son environnement avec leur version. Gr√¢ce √† cette liste, d‚Äôautres personnes pourront reproduire l‚Äôapplication si elles disposent des m√™mes inputs (le code, les donn√©es‚Ä¶).\nEn effet, il est important de voir l‚Äôapplication comme le r√©sultat de la combinaison de plusieurs ingr√©dients. Dans notre cas, nous en avons trois:\n\nDu code R ou Python : celui-ci a √©t√© r√©cup√©r√© par le biais de Git\nDes √©l√©ments de configuration:\n\nle fichier renv.lock (R) ou requirements.txt (Python) qui permettra de reconstruire notre environnement √† l‚Äôidentique gr√¢ce √† des outils adapt√©s1\nle fichier sources.yaml qui liste l‚Äôemplacement des sources sur le site data.gouv\n\nDes donn√©es: nous √©voquerons celles-ci lors de la prochaine partie.\n\n\n\n\nIllustration du principe de s√©paration du code, des donn√©es et de la configuration\n\n\nDe mani√®re g√©n√©rale, c‚Äôest une bonne pratique de structurer son projet comme une combinaison de ces facteurs. Cela vous am√®nera √† faire des projets plus reproductible mais aussi √† la structure plus lisible.\nPour les utilisateurs de R, la formation de l‚ÄôInsee aux bonnes pratiques consacre une partie aux environnements reproductibles avec renv. Pour les utilisateurs de Python, le cours de mise en production de projets data science consacre un chapitre au sujet.\n\n\n1.2.2 Cr√©er l‚Äôenvironnement\nL‚Äôint√©r√™t d‚Äôutiliser renv est que recr√©er l‚Äôenvironnement n√©cessaire au bon fonctionnement de l‚Äôapplication est tr√®s simple avec la commande:\nrenv::restore()\nIl est tout √† fait possible, ensuite, d‚Äôinstaller des packages suppl√©mentaires par le biais de install.packages. L‚Äôenvironnement propos√© par notre fichier renv.lock est le minimum requis pour reproduire l‚Äôapplication mais ce n‚Äôest pas un environnement fig√©. Si vous ajoutez des packages utiles pour votre application, avant la phase de mise en production, n‚Äôoubliez pas de faire renv::snapshot() pour mettre √† jour le fichier renv.lock.\nMaintenant que nous disposons d‚Äôun environnement fonctionnel, nous pouvons avancer sur la conception du projet. La premi√®re √©tape est d‚Äôexplorer les jeux de donn√©es que nous utiliserons dans l‚Äôapplication"
  },
  {
    "objectID": "index.html#importer-la-liste-des-sources-disponibles",
    "href": "index.html#importer-la-liste-des-sources-disponibles",
    "title": "Un tableau de bord du trafic a√©rien avec  ou ",
    "section": "2.1 Importer la liste des sources disponibles",
    "text": "2.1 Importer la liste des sources disponibles\n\n\n\n\n\n\n Exercice 1: lire les sources dans \n\n\n\n\n\n\nLe package yaml comporte une fonction read_yaml pour transformer un fichier YAML en liste imbriqu√©e. Tester cette fonction sur le fichier sources.yml.\nTransformer ce bout de code en une fonction create_data_list prenant un argument source_file et renvoyant cette liste.\n\n\n\n\n\n\nVoir la solution\n\n#' Creates a 2-levels list of urls, pointing to open source data\n#' \n#' @param source_file yaml file containing data urls \n#' @return list (level 1 = concepts, level 2 = year).\n#'\n#' @examples\n#'  create_data_list(\"sources.yml\")\n#'  \ncreate_data_list &lt;- function(source_file){\n  catalogue &lt;- yaml::read_yaml(source_file)\n  return(catalogue)\n}\n\nLa solution est dans le fichier R/create_data_list.R. Elle peut √™tre import√©e dans l‚Äôenvironnement global gr√¢ce √† la commande:\n\nsource(\"R/create_data_list.R\")"
  },
  {
    "objectID": "index.html#importer-les-premi√®res-bases",
    "href": "index.html#importer-les-premi√®res-bases",
    "title": "Un tableau de bord du trafic a√©rien avec  ou ",
    "section": "2.2 Importer les premi√®res bases",
    "text": "2.2 Importer les premi√®res bases\n\nurls &lt;- create_data_list(\"sources.yml\")\n\n\n\n\n\n\n\n Exercice 2: d√©couvrir les diff√©rentes sources\n\n\n\n\n\nCet exercice est, en apparence, un peu long. N√©anmoins la premi√®re partie de celui-ci permet la construction d‚Äôune fonction g√©n√©rique d‚Äôimport des donn√©es qui permet ensuite de gagner du temps et d‚Äô√©viter la redondance de code.\n\nDonn√©es a√©roports\n\nComme les donn√©es sont des CSV europ√©ens (s√©parateur ;), utiliser read_csv2 du package readr pour lire les donn√©es √† partir de la liste de fichiers unlist(urls$airports)2.\nIl est recommand√© de ne pas laisser les types par d√©faut des colonnes mais de figer ceux-ci avec l‚Äôargument suivant:\n\ncol_types = cols(\n  ANMOIS = col_character(),\n  APT = col_character(),\n  APT_NOM = col_character(),\n  APT_ZON = col_character(),\n  .default = col_double()\n)\n\nA partir de la variable ANMOIS, cr√©er les variables an et mois.\n\n\n\nAide si vous √™tes bloqu√© sur cette question\n\nPour extraire des √©l√©ments d‚Äôune chaine de caract√®re √† partir de la position, il est recommand√© d‚Äôutiliser la fonction str_sub du package stringr. Pour cr√©er de nouvelles colonnes, il est recommand√© d‚Äôutiliser la fonction mutate du package dplyr.\n\n\n\n\n\n\nConseil pour se faciliter la vie ult√©rieurement\n\n\n\nIl est recommand√© d‚Äôutiliser str_remove pour retirer les z√©ros en d√©but de mois qui pourront nous cr√©er des difficult√©s ult√©rieurement\n\n\nSi vous √™tes toujours bloqu√©, la solution est donn√©e plus bas üëá\n\n\nCr√©er une fonction clean_dataframe qui reprend le code de cr√©ation des variables an et mois, ajoute une √©tape de passage des noms de colonne en minuscule et renvoie le dataframe en sortie\n\n\n\nSolution\n\nclean_dataframe &lt;- function(df){\n  \n  # Create an et mois columns\n  df &lt;- df %&gt;% \n    mutate(\n      an = str_sub(ANMOIS,1,4),\n      mois = str_sub(ANMOIS,5,6)\n    ) %&gt;%\n    mutate(\n      mois = str_remove(mois, \"^0+\")\n    )\n  \n  # lower case for variable names\n  colnames(df) &lt;- tolower(colnames(df))\n  \n  return(df)\n\n}\n\n\nCr√©er une fonction import_airport_data qui prend en input list_files et int√®gre les deux √©tapes pr√©c√©dentes: la lecture des donn√©es, le nettoyage avec clean_dataframe.\n\n\n\nSolution\n\nimport_airport_data &lt;- function(list_files){\n  \n  pax_apt_all &lt;- readr::read_csv2(\n    list_files, \n    col_types = cols(\n      ANMOIS = col_character(),\n      APT = col_character(),\n      APT_NOM = col_character(),\n      APT_ZON = col_character(),\n      .default = col_double()\n    )\n  ) %&gt;% \n    clean_dataframe()\n  \n  return(pax_apt_all)\n  \n}\n\nReporter cette fonction dans un fichier R/clean_dataframe.R et faire\n\nsource(\"R/clean_dataframe.R\")\n\n\n\nDonn√©es compagnies\nSur le m√™me principe, cr√©er une fonction import_compagnies_data qui effectue la m√™me suite d‚Äôop√©rations. Faire n√©anmoins attention aux types des colonnes.\n\n\nRecommandation de param√®tre pour read_csv pour l‚Äôimport de ces fichiers\ncol_types = cols(\n  ANMOIS = col_character(),\n  CIE = col_character(),\n  CIE_NOM = col_character(),\n  CIE_NAT = col_character(),\n  CIE_PAYS = col_character(),\n  .default = col_double()\n)\n\n\n\n\nSolution\n\nimport_compagnies_data &lt;- function(list_files){\n  \n  pax_cie_all &lt;- readr::read_csv2(\n    file = list_files,\n    col_types = cols(\n      ANMOIS = col_character(),\n      CIE = col_character(),\n      CIE_NOM = col_character(),\n      CIE_NAT = col_character(),\n      CIE_PAYS = col_character(),\n      .default = col_double()\n    )\n  ) %&gt;% \n    clean_dataframe()\n  \n  return(pax_cie_all)\n  \n  \n}\n\n\n\nDonn√©es liaisons\nSur le m√™me principe, cr√©er une fonction import_liaisons_data qui effectue la m√™me suite d‚Äôop√©rations. Faire n√©anmoins attention aux types des colonnes.\n\n\nRecommandation de param√®tre pour read_csv pour l‚Äôimport de ces fichiers\ncol_types = cols(\n  ANMOIS = col_character(),\n  LSN = col_character(),\n  LSN_DEP_NOM = col_character(),\n  LSN_ARR_NOM = col_character(),\n  LSN_SCT = col_character(),\n  LSN_FSC = col_character(),\n  .default = col_double()\n)\n\n\n\n\nSolution\n\nimport_liaisons_data &lt;- function(list_files){\n  \n  pax_lsn_all &lt;- readr::read_csv2(\n    file = list_files,\n    col_types = cols(\n      ANMOIS = col_character(),\n      LSN = col_character(),\n      LSN_DEP_NOM = col_character(),\n      LSN_ARR_NOM = col_character(),\n      LSN_SCT = col_character(),\n      LSN_FSC = col_character(),\n      .default = col_double()\n    ) \n  ) %&gt;% \n    clean_dataframe()\n  \n  return(pax_lsn_all)\n  \n  \n}\n\n\n\nLocalisations des a√©roports\nIl s‚Äôagit d‚Äôun jeu de donn√©es spatial. Pour en savoir plus sur ce type de donn√©es, il est recommand√© de consulter la fiche utilitR sur le sujet ou ce cours introductif\n\nUtiliser la fonction st_read du package sf pour lire ces donn√©es (dont la localisation est stock√©e dans la variable urls$geojson$aiport). Stocker l‚Äôobjet obtenu sous le nom airports_location\nV√©rifier que les donn√©es sont bien dans le syst√®me de repr√©sentation WGS 843\n\n\n\nAide\n\nLa fonction √† utiliser est sf_crs\n\n\nIl est toujours utile de v√©rifier que nos donn√©es sont bien localis√©es o√π on les attend. Pour cela, il est pertinent de faire une carte avec un fond de carte contextuel, m√™me si celle-ci n‚Äôest pas tr√®s soign√©e. Pour faire ceci, le plus simple est d‚Äôutiliser la fonction addMarkers du package leaflet. Essayez de faire cette carte vous-m√™mes ou consultez l‚Äôaide ci-dessous\n\n\n\nCode pour faire une carte leaflet minimale\n\nleaflet(airports_location) %&gt;%\n  addTiles() %&gt;%\n  addMarkers(popup = ~Nom)\n\nReporter toutes ces fonctions dans un fichier R/import_data.R.\n\n\n\n\nA l‚Äôissue de cet exercice, vous devriez avoir le fichier R/import_data.R suivant\n\n\nLe fichier R/import_data.R attendu\n\nimport_airport_data &lt;- function(list_files){\n  \n  pax_apt_all &lt;- readr::read_csv2(\n    list_files, \n    col_types = cols(\n      ANMOIS = col_character(),\n      APT = col_character(),\n      APT_NOM = col_character(),\n      APT_ZON = col_character(),\n      .default = col_double()\n    )\n  ) %&gt;% \n    clean_dataframe()\n  \n  return(pax_apt_all)\n  \n}\n\n\nimport_compagnies_data &lt;- function(list_files){\n  \n  pax_cie_all &lt;- readr::read_csv2(\n    file = list_files,\n    col_types = cols(\n      ANMOIS = col_character(),\n      CIE = col_character(),\n      CIE_NOM = col_character(),\n      CIE_NAT = col_character(),\n      CIE_PAYS = col_character(),\n      .default = col_double()\n    )\n  ) %&gt;% \n    clean_dataframe()\n  \n  return(pax_cie_all)\n  \n  \n}\n\n\nimport_liaisons_data &lt;- function(list_files){\n  \n  pax_lsn_all &lt;- readr::read_csv2(\n    file = list_files,\n    col_types = cols(\n      ANMOIS = col_character(),\n      LSN = col_character(),\n      LSN_DEP_NOM = col_character(),\n      LSN_ARR_NOM = col_character(),\n      LSN_SCT = col_character(),\n      LSN_FSC = col_character(),\n      .default = col_double()\n    ) \n  ) %&gt;% \n    clean_dataframe()\n  \n  return(pax_lsn_all)\n  \n  \n}\n\nLa carte leaflet que vous devriez avoir obtenue √† la fin de l‚Äôexercice est la suivante:\n\nleaflet(airports_location) %&gt;%\n  addTiles() %&gt;%\n  addMarkers(popup = ~Nom)\n\n\n\n\n\nA l‚Äôissue de l‚Äôexercice, le code centralis√© dans le script R/import_data.R peut √™tre import√© via le code suivant\n\nsource(\"R/import_data.R\")  \n\nVous pouvez initier un script nomm√© main.R avec les lignes suivante:\nMONTHS_LIST = 1:12\n\n# Load data ----------------------------------\nurls &lt;- create_data_list(\"./sources.yml\")\n\n\npax_apt_all &lt;- import_airport_data(unlist(urls$airports))\npax_cie_all &lt;- import_compagnies_data(unlist(urls$compagnies))\npax_lsn_all &lt;- import_liaisons_data(unlist(urls$liaisons))\n\nairports_location &lt;- st_read(urls$geojson$airport)\nen les faisant pr√©c√©der de l‚Äôimport des scripts que nous avons d√©j√† cr√©√© dans le dossier R:\nsource(\"R/create_data_list.R\")\nsource(\"R/import_data.R\")  \nsource(\"R/clean_dataframe.R\")\nUne bonne pratique est de tester son script dans une session vierge. Cela am√®ne √† construire pas √† pas une chaine plus reproductible. Pour cela,\n\nAller dans les options de R via Tools &gt; Global Options et d√©cocher la case Restore .RData into workspace at setup\nRed√©marrer votre session R via le menu Session &gt; Restart R ou le raccourci CTRL+SHIFT+F10\n\nEt ex√©cuter votre fichier main.R. Vous devriez rencontrer des erreurs car nous n‚Äôavons pas g√©r√© les import de librairies dans ce script puisque notre session actuelle ne b√©n√©ficie plus des import ant√©rieurs.\nUne bonne pratique pour comprendre cette exigence de reproductibilit√© est d‚Äôit√©rativement ajouter les librairies utiles √† mesure qu‚Äôon rencontre des erreurs (notre code √©tant tr√®s rapide √† tourner, cette logique d‚Äôessai-erreur n‚Äôest pas tr√®s co√ªteuse). Si vous ne d√©sirez pas faire ceci (dommage, c‚Äôest un bon exercice), vous pouvez trouver les imports de packages √† faire pour que notre script soit reproductible.\n\n\nL‚Äôenvironnement minimal de reproductibilit√© pour que le script main.R fonctionne\n\nlibrary(readr)\nlibrary(dplyr)\nlibrary(stringr)\nlibrary(sf)\n\nCes librairies sont √† √©crire au d√©but de main.R."
  },
  {
    "objectID": "index.html#le-trafic-par-a√©roport",
    "href": "index.html#le-trafic-par-a√©roport",
    "title": "Un tableau de bord du trafic a√©rien avec  ou ",
    "section": "3.1 Le trafic par a√©roport",
    "text": "3.1 Le trafic par a√©roport\nPour commencer, nous allons prototyper la production d‚Äôune figure sur le trafic a√©rien au niveau d‚Äôun a√©roport. Cela nous facilitera ensuite l‚Äôint√©gration dans une application interactive.\nPour cela, nous allons cr√©er les deux objets temporaires suivants\n\nliste_aeroports &lt;- unique(pax_apt_all$apt)\ndefault_airport &lt;- liste_aeroports[1]\ndefault_airport\n\n[1] \"FMCZ\"\n\n\n\n\n\n\n\n\n Exercice 3: graphiques de fr√©quentation des a√©roports\n\n\n\n\n\n\nCr√©er une variable trafic √©gale apt_pax_dep + apt_pax_tr + apt_pax_arr\nNe conserver que les donn√©es relatives √† l‚Äôa√©roport default_airport\nCr√©er une variable date qui utilise les colonnes an et mois. Cette variable de date doit √™tre au format date, pas au format chr\n\n\nEncha√Ænement des op√©rations attendues √† cette √©tape\n\n\nlibrary(readr)\nlibrary(dplyr)\nlibrary(stringr)\nlibrary(sf)\nlibrary(plotly)\n\nsource(\"R/import_data.R\")\nsource(\"R/create_data_list.R\")\nsource(\"R/clean_dataframe.R\")\nsource(\"R/figures.R\")\n\n\n# Load data ----------------------------------\nurls &lt;- create_data_list(\"./sources.yml\")\n\n\npax_apt_all &lt;- import_airport_data(unlist(urls$airports))\npax_cie_all &lt;- import_compagnies_data(unlist(urls$compagnies))\npax_lsn_all &lt;- import_liaisons_data(unlist(urls$liaisons))\n\nairports_location &lt;- st_read(urls$geojson$airport)\n\nliste_aeroports &lt;- unique(pax_apt_all$apt)\ndefault_airport &lt;- liste_aeroports[1]\n\n\ntrafic_aeroports &lt;- pax_apt_all %&gt;%\n  mutate(trafic = apt_pax_dep + apt_pax_tr + apt_pax_arr) %&gt;%\n  filter(apt %in% default_airport) %&gt;%\n  mutate(\n    date = as.Date(paste(anmois, \"01\", sep=\"\"), format = \"%Y%m%d\")\n  )\n\n\nFaire une figure ggplot toute simple pour voir la dynamique des donn√©es afin d‚Äôobtenir une figure similaire √† celle-ci\n\n\nfigure_ggplot\n\n\n\n\nNous allons faire une application interactive par la suite. Il est donc plus int√©ressant d‚Äôavoir une figure un minimum r√©active pour impliquer l‚Äôutilisateur de l‚Äôapplication.\n\nIl est donc plus pertinent de faire une figure avec la librairie plotly. Pour cela, vous pouvez vous inspirer de cette page\n\n\n\n\n\n\n\n\n\nLe code pour g√©n√©rer la figure\n\n\n\npax_apt_all &lt;- import_airport_data(unlist(urls$airports))\npax_cie_all &lt;- import_compagnies_data(unlist(urls$compagnies))\npax_lsn_all &lt;- import_liaisons_data(unlist(urls$liaisons))\n\nairports_location &lt;- st_read(urls$geojson$airport)\n\nliste_aeroports &lt;- unique(pax_apt_all$apt)\ndefault_airport &lt;- liste_aeroports[1]\n\n\ntrafic_aeroports &lt;- pax_apt_all %&gt;%\n  mutate(trafic = apt_pax_dep + apt_pax_tr + apt_pax_arr) %&gt;%\n  filter(apt %in% default_airport) %&gt;%\n  mutate(\n    date = as.Date(paste(anmois, \"01\", sep=\"\"), format = \"%Y%m%d\")\n  )\n\n\n# VALORISATIONS ----------------------------------------------\n\nfigure_ggplot &lt;- trafic_aeroports %&gt;%\n  ggplot(.) + geom_line(aes(x = date, y = trafic))\n\nfigure_plotly &lt;- plot_airport_line(trafic_aeroports,default_airport)\n\n\n\n\nLe code complet pour r√©pliquer cet exercice est donn√© ci-dessous.\n\n\nCode de l‚Äôexercice\n\nlibrary(readr)\nlibrary(dplyr)\nlibrary(stringr)\nlibrary(sf)\nlibrary(plotly)\n\nsource(\"R/import_data.R\")\nsource(\"R/create_data_list.R\")\nsource(\"R/clean_dataframe.R\")\nsource(\"R/figures.R\")\n\n\n# Load data ----------------------------------\nurls &lt;- create_data_list(\"./sources.yml\")\n\n\npax_apt_all &lt;- import_airport_data(unlist(urls$airports))\npax_cie_all &lt;- import_compagnies_data(unlist(urls$compagnies))\npax_lsn_all &lt;- import_liaisons_data(unlist(urls$liaisons))\n\nairports_location &lt;- st_read(urls$geojson$airport)\n\nliste_aeroports &lt;- unique(pax_apt_all$apt)\ndefault_airport &lt;- liste_aeroports[1]\n\n\ntrafic_aeroports &lt;- pax_apt_all %&gt;%\n  mutate(trafic = apt_pax_dep + apt_pax_tr + apt_pax_arr) %&gt;%\n  filter(apt %in% default_airport) %&gt;%\n  mutate(\n    date = as.Date(paste(anmois, \"01\", sep=\"\"), format = \"%Y%m%d\")\n  )\n\n\n# VALORISATIONS ----------------------------------------------\n\nfigure_ggplot &lt;- trafic_aeroports %&gt;%\n  ggplot(.) + geom_line(aes(x = date, y = trafic))\n\nfigure_plotly &lt;- plot_airport_line(trafic_aeroports,default_airport)\n\nNous proposons de le transformer en fonction, ce sera plus simple √† int√©grer ult√©rieurement dans notre application\n\n\n\n\n\n\n Exercice 3b: une fonction de production graphique\n\n\n\n\n\nTransformer le code ci-dessus en une fonction afin que\n\nles inputs soient les suivants: un dataframe, un a√©roport √† s√©lectionner\nla sortie soit notre figure plotly\n\nTester la fonction sur d‚Äôautres a√©roports de la liste. Quand vous √™tes satisfaits de celle-ci, d√©placer la d√©finition de cette fonction dans R/figures.R\n\n\n\n\n\nFichier R/figures.R √† l‚Äôissue de cet exercice\n\n\n\nR/figures.R\n\n\nplot_airport_line &lt;- function(df, selected_airport){\n  trafic_aeroports &lt;- df %&gt;%\n    mutate(trafic = apt_pax_dep + apt_pax_tr + apt_pax_arr) %&gt;%\n    filter(apt %in% selected_airport) %&gt;%\n    mutate(\n      date = as.Date(paste(anmois, \"01\", sep=\"\"), format = \"%Y%m%d\")\n    )\n  \n  figure_plotly &lt;- trafic_aeroports %&gt;%\n    plot_ly(\n      x = ~date, y = ~trafic,\n      text = ~apt_nom,\n      hovertemplate = paste(\"&lt;i&gt;A√©roport:&lt;/i&gt; %{text}&lt;br&gt;Trafic: %{y}\") ,\n      type = 'scatter', mode = 'lines+markers')\n  \n  return(figure_plotly)\n}\n\n\nPar la suite, nous pouvons ajouter la ligne suivante √† notre fichier main.R\n\nsource(\"R/figures.R\")\n\net utiliser cette fonction √† la fin du fichier.\n\n\nFichier main.R √† l‚Äôissue de cet exercice\n\n\n\nmain.R\n\nlibrary(readr)\nlibrary(dplyr)\nlibrary(stringr)\nlibrary(sf)\nlibrary(plotly)\n\nsource(\"R/import_data.R\")\nsource(\"R/create_data_list.R\")\nsource(\"R/clean_dataframe.R\")\nsource(\"R/figures.R\")\n\n\n# Load data ----------------------------------\nurls &lt;- create_data_list(\"./sources.yml\")\n\n\npax_apt_all &lt;- import_airport_data(unlist(urls$airports))\npax_cie_all &lt;- import_compagnies_data(unlist(urls$compagnies))\npax_lsn_all &lt;- import_liaisons_data(unlist(urls$liaisons))\n\nairports_location &lt;- st_read(urls$geojson$airport)\n\nliste_aeroports &lt;- unique(pax_apt_all$apt)\ndefault_airport &lt;- liste_aeroports[1]\n\n\ntrafic_aeroports &lt;- pax_apt_all %&gt;%\n  mutate(trafic = apt_pax_dep + apt_pax_tr + apt_pax_arr) %&gt;%\n  filter(apt %in% default_airport) %&gt;%\n  mutate(\n    date = as.Date(paste(anmois, \"01\", sep=\"\"), format = \"%Y%m%d\")\n  )\n\n\n# VALORISATIONS ----------------------------------------------\n\nfigure_ggplot &lt;- trafic_aeroports %&gt;%\n  ggplot(.) + geom_line(aes(x = date, y = trafic))\n\nfigure_plotly &lt;- plot_airport_line(trafic_aeroports,default_airport)"
  },
  {
    "objectID": "index.html#tableau-html-pour-afficher-des-donn√©es",
    "href": "index.html#tableau-html-pour-afficher-des-donn√©es",
    "title": "Un tableau de bord du trafic a√©rien avec  ou ",
    "section": "3.2 Tableau HTML pour afficher des donn√©es",
    "text": "3.2 Tableau HTML pour afficher des donn√©es\nLa premi√®re valorisation que nous int√©grerons dans notre application est le mod√®le de figure ci-dessus. La deuxi√®me sera un tableau permettant de visualiser certaines donn√©es directement dans le dashboard.\nPour le prochain exercice, vous pourrez utiliser ces objets\n\nYEARS_LIST  &lt;- as.character(2018:2022)\nMONTHS_LIST &lt;- 1:12\n\n\n\n\n\n\n\n Exercice 4a: pr√©parer les donn√©es avant de faire un beau tableau\n\n\n\n\n\nNous allons int√©grer dans notre application deux tableaux de statistiques descriptives.\n\nChoisir un mois et une ann√©e √† partir des objets YEARS_LIST et MONTHS_LIST pour faire un filtre sur le dataframe pax_apt_all. Une fois que vous √™tes satisfaits, transformer cela en fonction create_data_from_input prenant en argument un dataframe, une ann√©e et un mois\n\n\n\nCode de l‚Äôexercice\n\ncreate_data_from_input &lt;- function(data, years, months){\n  data &lt;- data %&gt;%\n    filter(mois %in% months, an %in% years)\n  return(data)\n}\n\n\n\nPour chaque a√©roport, calculer le nombre total de passager. Rapporter cette statistique en million de personnes. Puis classer les a√©rports du plus fr√©quent√© au moins fr√©quent√©. Une fois que vous √™tes satisfaits de votre chaine d‚Äôop√©ration, cr√©er une fonction summary_stat_airport.\n\n\n\nCode de l‚Äôexercice\n\n  table2 &lt;- data %&gt;%\n    group_by(apt, apt_nom) %&gt;%\n    summarise(\n      paxdep = round(sum(apt_pax_dep, na.rm = T),3),\n      paxarr = round(sum(apt_pax_arr, na.rm = T),3),\n      paxtra = round(sum(apt_pax_tr, na.rm = T),3)) %&gt;%\n    arrange(desc(paxdep)) %&gt;%\n    ungroup()\n  \n  return(table2)\n}\n\n\n\nVoici une fonction pour faire le m√™me type d‚Äôop√©ration sur la base des liaisons.\n\n\n\nCode de l‚Äôexercice\n\n  agg_data &lt;- data %&gt;%\n    group_by(lsn_fsc) %&gt;%\n    summarise(\n      paxloc = round(sum(lsn_pax_loc, na.rm = TRUE)*1e-6,3)\n    ) %&gt;%\n    ungroup()\n  return(agg_data)\n}\n\n\nReporter les fonctions cr√©√©es dans cet exercice dans un script divers_functions.R. Enrichir le script main.R pour utiliser celles-ci en cr√©ant les dataframes ad√©quats (correction ci-dessous)\n\n\n\nVoici une proposition de script main.R √† l‚Äôissue de cet exercice\n\n\nCode de l‚Äôexercice\n\nlibrary(readr)\nlibrary(dplyr)\nlibrary(stringr)\nlibrary(sf)\nlibrary(ggplot2)\nlibrary(plotly)\nlibrary(leaflet)\n\nsource(\"R/import_data.R\")\nsource(\"R/create_data_list.R\")\nsource(\"R/clean_dataframe.R\")\nsource(\"R/divers_functions.R\")\nsource(\"R/figures.R\")\n\nYEARS_LIST  &lt;- as.character(2018:2022)\nMONTHS_LIST &lt;- 1:12\nyear &lt;- YEARS_LIST[1]\nmonth &lt;- MONTHS_LIST[1]\n\n\n# Load data ----------------------------------\nurls &lt;- create_data_list(\"./sources.yml\")\n\n\npax_apt_all &lt;- import_airport_data(unlist(urls$airports))\npax_cie_all &lt;- import_compagnies_data(unlist(urls$compagnies))\npax_lsn_all &lt;- import_liaisons_data(unlist(urls$liaisons))\n\nairports_location &lt;- st_read(urls$geojson$airport)\n\nliste_aeroports &lt;- unique(pax_apt_all$apt)\ndefault_airport &lt;- liste_aeroports[1]\n\n# OBJETS NECESSAIRES A L'APPLICATION ------------------------\n\ntrafic_aeroports &lt;- pax_apt_all %&gt;%\n  mutate(trafic = apt_pax_dep + apt_pax_tr + apt_pax_arr) %&gt;%\n  filter(apt %in% default_airport) %&gt;%\n  mutate(\n    date = as.Date(paste(anmois, \"01\", sep=\"\"), format = \"%Y%m%d\")\n  )\n\nstats_aeroports &lt;- summary_stat_airport(\n  create_data_from_input(pax_apt_all, year, month)\n)\nstats_liaisons  &lt;- summary_stat_liaisons(\n  create_data_from_input(pax_lsn_all, year, month)\n)\n\n\n# VALORISATIONS ----------------------------------------------\n\nfigure_plotly &lt;- plot_airport_line(trafic_aeroports,default_airport)\n\n\nNous avons maintenant tous les ingr√©dients pour faire un tableau de statistiques descriptives lisible et esth√©tique. Pour cela, nous allons utiliser le package GT. Avant de cr√©er cette table, nous allons cr√©er une colonne suppl√©mentaire:\n\nstats_aeroports_table &lt;- stats_aeroports %&gt;%\n  mutate(name_clean = paste0(str_to_sentence(apt_nom), \" _(\", apt, \")_\")\n) %&gt;%\nselect(name_clean, everything())\n\nCelle-ci nous permettra, une fois mise en forme, d‚Äôavoir une colonne plus esth√©tique.\n\n\n\n\n\n\n Exercice 4b: un beau tableau (enfin !)\n\n\n\n\n\nLes diff√©rentes questions vont permettre de construire et formatter progressivement notre tableau. Si vous √™tes bloqu√©s, les r√©ponses sont ci-dessous dans des menus d√©roulants.\n\nEn premier lieu, utiliser GT pour faire un tableau basique sur le dataframe stats_aeroports_table. N‚Äôutiliser aucune option, celles-ci vont √™tre progressivement ajout√©es.\nRetirer les colonnes apt et apt_nom de notre table.\n\n\n\nIl y a plusieurs mani√®res de faire, voici un indice sur la ‚Äúmeilleure‚Äù\n\nIl est possible d‚Äôutiliser des fonctions de s√©lection de colonnes issues du tidyverse dans gt, notamment la fonction starts_with (√† ne pas confondre avec celle de stringr)\n\n\nFormatter les colonnes num√©riques (pour la s√©lection des colonnes num√©riques, voir l‚Äôindice ci-dessus). En consultant la documentation de gt, appliquer l‚Äôoption qui permet de rendre plus concise la notation des milliers (K) et millions (M).\nUtiliser fmt_markdown pour appliquer une mise en forme adapt√©e √† la colonne name_clean\nMettre en forme les noms de colonne (cols_labels), le titre (tab_header) et la couleur de la partie sup√©rieure du tableau (tab_style), les notes (tab_source_note) pour avoir un tableau esth√©thique et informatif\nTransformer la table en tableau interactif avec opt_interactive4\n\n\n\n\nLes r√©ponses aux diff√©rentes questions sont donn√©es de mani√®re successives ci-dessous. La table finale, obtenue √† l‚Äôissue de l‚Äôexercice est la suivante:\n\n\nR√©ponse question 1\nlibrary(gt)\ntable_aeroports &lt;- gt(stats_aeroports_table)\ntable_aeroports\n\n\n\n\nR√©ponse question 2\ntable_aeroports &lt;- table_aeroports %&gt;%\n  cols_hide(columns = starts_with(\"apt\"))\ntable_aeroports\n\n\n\n\nR√©ponse question 3\ntable_aeroports &lt;- table_aeroports %&gt;%\n  fmt_number(columns = starts_with(\"pax\"), suffixing = TRUE)\ntable_aeroports\n\n\n\n\nR√©ponse question 4\ntable_aeroports &lt;- table_aeroports %&gt;%\n  fmt_markdown(columns = \"name_clean\")\ntable_aeroports\n\n\n\n\nR√©ponse question 5\ntable_aeroports &lt;- table_aeroports %&gt;%\n  cols_label(\n    name_clean = md(\"**A√©roport**\"),\n    paxdep = md(\"**D√©parts**\"),\n    paxarr = md(\"**Arriv√©e**\"),\n    paxtra = md(\"**Transit**\")\n  ) %&gt;%\n  tab_header(\n    title = md(\"**Statistiques de fr√©quentation**\"),\n    subtitle = md(\"Classement des a√©roports\")\n  ) %&gt;%\n  tab_style(\n    style = cell_fill(color = \"powderblue\"),\n    locations = cells_title()\n  ) %&gt;%\n  tab_source_note(source_note = md(\"_Source: DGAC, √† partir des donn√©es sur data.gouv.fr_\"))\n  \ntable_aeroports\n\n\n\n\nR√©ponse question 6\ntable_aeroports &lt;- table_aeroports %&gt;%\n  opt_interactive()\ntable_aeroports\n\n\n\n\n\n\nStatistiques de fr√©quentation\nClassement des a√©roports\n\n\n\n\n\n\nSource: DGAC, √† partir des donn√©es sur data.gouv.fr\n\n\n\n\n\n\n\n\n\nNous proposons de transformer ce code en fonction, cela facilitera l‚Äôutilisation ult√©rieure de celui-ci dans notre application.\n\n\n\n\n\n\n Exercice 4c (optionnel): transformer en fonction notre cha√Æne gt\n\n\n\n\n\nCet exercice est optionnel. Transformer le code ci-dessus en fonction. Mettre √† jour main.R pour utiliser ceci dans votre application.\n\n\n\n\n\nCode de R/tables.R\n\n\n\nR/tables.R\n\ncreate_table_airports &lt;- function(stats_aeroports){\n\n  stats_aeroports_table &lt;- stats_aeroports %&gt;%\n    mutate(name_clean = paste0(str_to_sentence(apt_nom), \" _(\", apt, \")_\")\n    ) %&gt;%\n    select(name_clean, everything())\n    \n  table_aeroports &lt;- gt(stats_aeroports_table)\n  \n  table_aeroports &lt;- table_aeroports %&gt;%\n    cols_hide(columns = starts_with(\"apt\"))\n  \n  table_aeroports &lt;- table_aeroports %&gt;%\n    fmt_number(columns = starts_with(\"pax\"), suffixing = TRUE)\n  \n  table_aeroports &lt;- table_aeroports %&gt;%\n    fmt_markdown(columns = \"name_clean\")\n  \n  table_aeroports &lt;- table_aeroports %&gt;%\n    cols_label(\n      name_clean = md(\"**A√©roport**\"),\n      paxdep = md(\"**D√©parts**\"),\n      paxarr = md(\"**Arriv√©e**\"),\n      paxtra = md(\"**Transit**\")\n    ) %&gt;%\n    tab_header(\n      title = md(\"**Statistiques de fr√©quentation**\"),\n      subtitle = md(\"Classement des a√©roports\")\n    ) %&gt;%\n    tab_style(\n      style = cell_fill(color = \"powderblue\"),\n      locations = cells_title()\n    ) %&gt;%\n    tab_source_note(source_note = md(\"_Source: DGAC, √† partir des donn√©es sur data.gouv.fr_\"))\n  \n  table_aeroports &lt;- table_aeroports %&gt;%\n    opt_interactive()\n  \n  return(table_aeroports)\n\n}\n\n\n\n\nCode de main.R\n\n\n\nmain.R\n\nlibrary(readr)\nlibrary(dplyr)\nlibrary(stringr)\nlibrary(sf)\nlibrary(ggplot2)\nlibrary(plotly)\nlibrary(gt)\nlibrary(leaflet)\n\nsource(\"R/import_data.R\")\nsource(\"R/create_data_list.R\")\nsource(\"R/clean_dataframe.R\")\nsource(\"R/divers_functions.R\")\nsource(\"R/tables.R\")\nsource(\"R/figures.R\")\n\nYEARS_LIST  &lt;- as.character(2018:2022)\nMONTHS_LIST &lt;- c(paste0(\"0\", 1:9), 10:12)\nyear &lt;- YEARS_LIST[1]\nmonth &lt;- MONTHS_LIST[1]\n\n\n# Load data ----------------------------------\nurls &lt;- create_data_list(\"./sources.yml\")\n\n\npax_apt_all &lt;- import_airport_data(unlist(urls$airports))\npax_cie_all &lt;- import_compagnies_data(unlist(urls$compagnies))\npax_lsn_all &lt;- import_liaisons_data(unlist(urls$liaisons))\n\nairports_location &lt;- st_read(urls$geojson$airport)\n\nliste_aeroports &lt;- unique(pax_apt_all$apt)\ndefault_airport &lt;- liste_aeroports[1]\n\n# OBJETS NECESSAIRES A L'APPLICATION ------------------------\n\ntrafic_aeroports &lt;- pax_apt_all %&gt;%\n  mutate(trafic = apt_pax_dep + apt_pax_tr + apt_pax_arr) %&gt;%\n  filter(apt %in% default_airport) %&gt;%\n  mutate(\n    date = as.Date(paste(anmois, \"01\", sep=\"\"), format = \"%Y%m%d\")\n  )\n\nstats_aeroports &lt;- summary_stat_airport(\n  create_data_from_input(pax_apt_all, year, month)\n)\nstats_liaisons  &lt;- summary_stat_liaisons(\n  create_data_from_input(pax_lsn_all, year, month)\n)\n\n\n# VALORISATIONS ----------------------------------------------\n\nfigure_plotly &lt;- plot_airport_line(trafic_aeroports,default_airport)\n\ntable_airports &lt;- create_table_airports(stats_aeroports)"
  },
  {
    "objectID": "index.html#carte-des-a√©roports",
    "href": "index.html#carte-des-a√©roports",
    "title": "Un tableau de bord du trafic a√©rien avec  ou ",
    "section": "3.3 Carte des a√©roports",
    "text": "3.3 Carte des a√©roports\nLa derni√®re valorisation que nous allons int√©grer est une carte interactive du trafic de nos a√©roports. Cette carte va √™tre assez basique. Si vous d√©sirez mettre en oeuvre des visualisations plus complexes, vous pouvez tout √† fait le faire.\nPour cet exercice, nous allons fixer une date pour prototyper notre code. Cela nous facilitera la transformation ult√©rieure en fonction.\n\nmonths &lt;- 1\nyears &lt;- 2019\n\nVoici √©galement une palette de couleurs qui sera utile √† la fin de l‚Äôexercice.\n\npalette &lt;- c(\"green\", \"blue\", \"red\")\n\n\n\n\n\n\n\n Exercice 5: carte a√©rienne du trafic a√©roportuaire\n\n\n\n\n\n\nCr√©er un dataframe trafic_date en ne conservant que les observations de pax_apt_all √©gales √† un certain mois et ann√©e (vous pouvez vous inspirer d‚Äôun filter fait pr√©c√©demment). Utiliser celui-ci en faisant une jointure avec airports_location par le biais des variables, respectivement, Code.OACI et apt. Nommer ce dataframe trafic_aeroports\nA partir de l‚Äôexemple de d√©marrage de leaflet, cr√©er une carte interactive qui affiche, lorsqu‚Äôon clique sur l‚Äôun des marqueurs, le nom de l‚Äôa√©roport et sa fr√©quentation.\nCr√©er une variable nomm√©e volume qui classe chaque observation dans son tercile et transforme la valeur en couleur √† partir de palette.\n\nA partir du code suivant et de la fonction addAwesomeMarkers, reproduire une carte similaire √† celle pr√©sent√©e plus bas.\n\nicons &lt;- awesomeIcons(\n  icon = 'plane',\n  iconColor = 'black',\n  library = 'fa',\n  markerColor = trafic_aeroports$color\n)\n\n\n\n\n\n\nSubtilit√© par rapport √† l‚Äôexemple de la documentation\n\n\n\n\n\nPar rapport √† l‚Äôexemple dans la documentation, il faut l√©g√®rement modifier le code de sorte √† faire icon=icons[] et non icon = icons.\n\n\n\n\n\n\n\n\nQuestion 1\ntrafic_date &lt;- pax_apt_all %&gt;%\n  mutate(\n    date = as.Date(paste(anmois, \"01\", sep=\"\"), format = \"%Y%m%d\")\n  ) %&gt;%\n  filter(mois %in% months, an %in% years)\ntrafic_aeroports &lt;- airports_location %&gt;%\n  inner_join(trafic_date, by = c(\"Code.OACI\" = \"apt\"))\n\n\n\n\nQuestion 2\nlibrary(leaflet)\n  \nleaflet(trafic_aeroports) %&gt;% addTiles() %&gt;%\n  addMarkers(popup = ~paste0(Nom, \": \", trafic)) \n\n\n\n\nQuestion 3\ntrafic_aeroports &lt;- trafic_aeroports %&gt;%\n  mutate(\n    volume = ntile(trafic, 3)\n) %&gt;%\n  mutate(\n    color = palette[volume]\n  )\n\n\n\n\nQuestion 3\nicons &lt;- awesomeIcons(\n  icon = 'plane',\n  iconColor = 'black',\n  library = 'fa',\n  markerColor = trafic_aeroports$color\n)\n\n\ncarte_interactive &lt;- leaflet(trafic_aeroports) %&gt;% addTiles() %&gt;%\n  addAwesomeMarkers(\n  icon=icons[],\n  label=~paste0(Nom, \"\", \" (\",Code.OACI, \") : \", trafic, \" voyageurs\")\n)\ncarte_interactive\n\n\n\n\n\n\nComme pr√©c√©demment, nous proposons de transformer la production de cette carte en fonction, cela nous permettra d‚Äôavoir une application l√©g√®re. L√† encore c‚Äôest un exercice optionnel mais int√©ressant √† faire pour d√©couvrir la logique de la programmation fonctionnelle.\n\n\n\n\n\n\n Exercice 5b (optionnel): une fonction pour notre carte\n\n\n\n\n\n\nCr√©er une fonction map_leaflet_airport avec les arguments df, airports_location et selected_date produisant la carte. Ins√©rer celle-ci dans le script R/figures.R\nMettre √† jour main.R pour utiliser cette fonction dans votre chaine. N‚Äôoubliez pas de d√©finir selected_date dans votre script.\n\n\n\n\n\n\nCode de R/figures.R √† reprendre\n\n\n\nR/figures.R (fin du fichier)\n\n\nmap_leaflet_airport &lt;- function(df, airports_location, months, years){\n  \n  palette &lt;- c(\"green\", \"blue\", \"red\")\n\n  trafic_date &lt;- df %&gt;%\n    mutate(\n      date = as.Date(paste(anmois, \"01\", sep=\"\"), format = \"%Y%m%d\")\n    ) %&gt;%\n    filter(mois %in% months, an %in% years)\n  trafic_aeroports &lt;- airports_location %&gt;%\n    inner_join(trafic_date, by = c(\"Code.OACI\" = \"apt\"))\n  \n  \n  trafic_aeroports &lt;- trafic_aeroports %&gt;%\n    mutate(\n      volume = ntile(trafic, 3)\n    ) %&gt;%\n    mutate(\n      color = palette[volume]\n    )  \n  \n  icons &lt;- awesomeIcons(\n    icon = 'plane',\n    iconColor = 'black',\n    library = 'fa',\n    markerColor = trafic_aeroports$color\n  )\n  \n  carte_interactive &lt;- leaflet(trafic_aeroports) %&gt;% addTiles() %&gt;%\n    addAwesomeMarkers(\n      icon=icons[],\n      label=~paste0(Nom, \"\", \" (\",Code.OACI, \") : \", trafic, \" voyageurs\")\n    )\n  \n  return(carte_interactive)\n}\n\n\n\n\nCode de intermediates/exo5.R √† reprendre\n\n\n\nmain.R\n\nmonth &lt;- MONTHS_LIST[1]\n\n\n# Load data ----------------------------------\nurls &lt;- create_data_list(\"./sources.yml\")\n\n\npax_apt_all &lt;- import_airport_data(unlist(urls$airports))\npax_cie_all &lt;- import_compagnies_data(unlist(urls$compagnies))\npax_lsn_all &lt;- import_liaisons_data(unlist(urls$liaisons))\n\nairports_location &lt;- st_read(urls$geojson$airport)\n\nliste_aeroports &lt;- unique(pax_apt_all$apt)\ndefault_airport &lt;- liste_aeroports[1]\n\n\n# OBJETS NECESSAIRES A L'APPLICATION ------------------------\n\ntrafic_aeroports &lt;- pax_apt_all %&gt;%\n  mutate(trafic = apt_pax_dep + apt_pax_tr + apt_pax_arr) %&gt;%\n  filter(apt %in% default_airport) %&gt;%\n  mutate(\n    date = as.Date(paste(anmois, \"01\", sep=\"\"), format = \"%Y%m%d\")\n  )\n\nstats_aeroports &lt;- summary_stat_airport(\n  create_data_from_input(pax_apt_all, year, month)\n)\nstats_liaisons  &lt;- summary_stat_liaisons(\n  create_data_from_input(pax_lsn_all, year, month)\n)\n\n\n# VALORISATIONS ----------------------------------------------\n\nfigure_plotly &lt;- plot_airport_line(trafic_aeroports,default_airport)\n\ntable_airports &lt;- create_table_airports(stats_aeroports)\n\ncarte_interactive &lt;- map_leaflet_airport(\n  pax_apt_all, airports_location,\n  month, year\n)\n\n\nAppli5 Pr√©parer un premier shiny sans plotly & leaflet\nAppli6 Ajouter √† l‚ÄôUI le plotly & leaflet\nAppli7 Contr√¥le de l‚Äôenvironnement avec renv"
  },
  {
    "objectID": "index.html#footnotes",
    "href": "index.html#footnotes",
    "title": "Un tableau de bord du trafic a√©rien avec  ou ",
    "section": "Footnotes",
    "text": "Footnotes\n\n\nCes fichiers ne sont pas g√©n√©r√©s manuellement. Ce sont des outils adapt√©s (renv pour R, pip pour Python) qui font ce travail de versionnage de l‚Äôenvironnement.‚Ü©Ô∏é\nSi vous √™tes peu familier avec ce type de fichiers, vous pouvez consulter la fiche utilitR sur le sujet‚Ü©Ô∏é\nSi vous √™tes peu familier avec les donn√©es g√©ographiques, vous pouvez retenir l‚Äôid√©e qu‚Äôil s‚Äôagit de donn√©es traditionnelles auxquelles s‚Äôajoute une dimension spatiale. Cette derni√®re vise √† localiser les donn√©es sur la terre. La localisation se fait dans un espace √† deux dimensions (espace cart√©sien) alors que notre plan√®te est une sph√®re en trois dimensions. Le principe d‚Äôun syst√®me de projection est de faire ce passage en deux dimensions des positions. Le plus connu est le syst√®me GPS, qui est un h√©ritier lointain de la repr√©sentation du monde par Mercator. Ce syst√®me est connu sous le nom de WGS 84 et porte le code EPSG 4326. L‚Äôautre syst√®me √† retenir est le Lambert 93 (code EPSG 2154) qui est la projection l√©gale en France (celle-ci, a contrario du Mercator, ne d√©forme pas la France sur une carte). Pour en savoir plus sur les syst√®mes de repr√©sentation, les avantages et inconv√©nients de chacun, il existe de nombreuses ressources en ligne. Des √©l√©ments introductifs, et des d√©monstrations interactives, en lien avec la librairie Geopandas de Python sont disponibles ici.‚Ü©Ô∏é\nVous perdrez la mise en forme du header du tableau qui n‚Äôest pas conciliable avec l‚Äôinteractivit√©.‚Ü©Ô∏é"
  }
]